<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NDSFXGM3');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>MeinRechner24 - Deutschlands große Rechner-Zentrale (Kostenlos & Aktuell 2025)</title>
    <meta name="title" content="MeinRechner24 - Deutschlands große Rechner-Zentrale (Kostenlos & Aktuell 2025)">
    <meta name="description" content="Nutzen Sie 15+ kostenlose Online-Rechner für Finanzen, Gesundheit & Alltag. Präzise & werbefrei: Brutto-Netto Rechner 2025, Kreditrechner, BMI, Inflation & mehr. Jetzt berechnen auf MeinRechner24.">
    <meta name="keywords" content="Online Rechner, Brutto Netto Rechner 2025, Kreditrechner, Tilgungsplan erstellen, BMI Rechner Frau Mann, Inflationsrechner Deutschland, Währungsrechner Euro Dollar, Einheiten umrechnen, MeinRechner24">
    <meta name="author" content="MeinRechner24">
    <meta name="robots" content="index, follow">
    <meta name="language" content="German">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://meinrechner24.de/" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://meinrechner24.de/">
    <meta property="og:site_name" content="MeinRechner24">
    <meta property="og:title" content="Finanzen & Gesundheit einfach berechnen | MeinRechner24">
    <meta property="og:description" content="Der moderne, dunkle Mode-Rechner für alles, was zählt. Von Gehalt bis Kalorien.">
    <meta property="og:image" content="https://meinrechner24.de/assets/preview.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="de_DE">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://meinrechner24.de/">
    <meta name="twitter:title" content="Finanzen & Gesundheit einfach berechnen | MeinRechner24">
    <meta name="twitter:description" content="Der moderne, dunkle Mode-Rechner für alles, was zählt. Von Gehalt bis Kalorien.">
    <meta name="twitter:image" content="https://meinrechner24.de/assets/preview.png">
    
    <!-- Structured Data (JSON-LD) for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "MeinRechner24",
      "url": "https://meinrechner24.de",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "EUR"
      },
      "description": "Eine Sammlung von präzisen Online-Rechnern für deutsche Steuergesetze (2025), Gesundheit und Finanzplanung.",
      "featureList": "Brutto Netto Rechner, Kreditrechner mit Tilgungsplan, BMI Rechner mit Alterskorrektur, Inflationsrechner, Währungsrechner, Einheiten-Umrechner, Kalorienrechner, Promillerechner, Altersrechner, Kleidergrößen Umrechner, Flächenrechner, Geschwindigkeitsumrechner, Benzinpreis Rechner",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "1250"
      },
      "screenshot": "https://meinrechner24.de/assets/preview.png"
    }
    </script>
    
    <!-- Additional Structured Data: WebSite -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "MeinRechner24",
      "url": "https://meinrechner24.de",
      "description": "Deutschlands große Rechner-Zentrale mit 15+ kostenlosen Online-Rechnern für Finanzen, Gesundheit und Alltag",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://meinrechner24.de/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <!-- Additional Structured Data: Organization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "MeinRechner24",
      "url": "https://meinrechner24.de",
      "logo": "https://meinrechner24.de/assets/logo.png",
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "tooslforbusiness333@gmail.com",
        "contactType": "customer service"
      }
    }
    </script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        /* Modern Dark Glow / Glassmorphism Design System */
        body {
            background: #020617; /* slate-950 */
            color: #cbd5e1; /* slate-300 */
            min-height: 100vh;
        }
        
        /* Custom styles for smooth transitions */
        .page-transition {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Ensure touch targets are at least 44px on mobile */
        @media (max-width: 640px) {
            .touch-target {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Mobile-specific responsive adjustments */
            .mobile-padding {
                padding: 1rem;
            }
            
            /* Ensure tables are scrollable on mobile */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* Responsive text sizes */
            h2 {
                font-size: 1.5rem;
            }
            
            /* Ensure inputs don't overflow */
            input, select, textarea {
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
        }
        
        /* Glow effects */
        .glow-teal {
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.5), 0 0 40px rgba(20, 184, 166, 0.3);
        }
        
        .glow-purple {
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5), 0 0 40px rgba(168, 85, 247, 0.3);
        }
        
        .glow-red {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5), 0 0 40px rgba(239, 68, 68, 0.3);
        }
        
        .glow-blue {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 0.3);
        }
        
        .glow-orange {
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.5), 0 0 40px rgba(249, 115, 22, 0.3);
        }
        
        .text-glow-teal {
            text-shadow: 0 0 10px rgba(20, 184, 166, 0.8), 0 0 20px rgba(20, 184, 166, 0.5);
        }
        
        .text-glow-purple {
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.8), 0 0 20px rgba(168, 85, 247, 0.5);
        }
        
        .text-glow-red {
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.8), 0 0 20px rgba(239, 68, 68, 0.5);
        }
        
        .text-glow-blue {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.8), 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .text-glow-orange {
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.8), 0 0 20px rgba(249, 115, 22, 0.5);
        }
        
        /* Category color schemes with glow */
        .category-teal {
            border-left: 4px solid #14b8a6;
            background: rgba(20, 184, 166, 0.05);
            box-shadow: 0 0 15px rgba(20, 184, 166, 0.3);
        }
        
        .category-purple {
            border-left: 4px solid #a855f7;
            background: rgba(168, 85, 247, 0.05);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
        }
        
        .category-red {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.05);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }
        
        .category-blue {
            border-left: 4px solid #3b82f6;
            background: rgba(59, 130, 246, 0.05);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }
        
        .category-orange {
            border-left: 4px solid #f97316;
            background: rgba(249, 115, 22, 0.05);
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.3);
        }
        
        /* Glassmorphism Input Fields */
        .dark-input {
            background: rgba(2, 6, 23, 0.5); /* slate-950/50 */
            border: 1px solid rgba(51, 65, 85, 0.5); /* slate-700 */
            color: #ffffff;
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        
        .dark-input:focus {
            outline: none;
            border-color: rgba(20, 184, 166, 0.6); /* teal-500 */
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2), 0 0 20px rgba(20, 184, 166, 0.3);
            background: rgba(2, 6, 23, 0.7);
        }
        
        /* Glassmorphism Select */
        .dark-select {
            background: rgba(2, 6, 23, 0.5); /* slate-950/50 */
            border: 1px solid rgba(51, 65, 85, 0.5); /* slate-700 */
            color: #ffffff;
            backdrop-filter: blur(12px);
            transition: all 0.3s ease;
        }
        
        .dark-select:focus {
            outline: none;
            border-color: rgba(20, 184, 166, 0.6);
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2), 0 0 20px rgba(20, 184, 166, 0.3);
            background: rgba(2, 6, 23, 0.7);
        }
        
        /* Glowing buttons */
        .btn-glow-teal {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.6), 0 4px 15px rgba(20, 184, 166, 0.4);
        }
        
        .btn-glow-teal:hover {
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.8), 0 6px 20px rgba(20, 184, 166, 0.6);
            transform: translateY(-2px);
        }
        
        /* Glassmorphism Card Hover Effects with Category Glows */
        .card-hover-teal {
            transition: all 0.3s ease;
        }
        .card-hover-teal:hover {
            box-shadow: 0 0 30px -5px rgba(45, 212, 191, 0.3), 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: rgba(45, 212, 191, 0.5);
            transform: translateY(-4px);
        }
        
        .card-hover-purple {
            transition: all 0.3s ease;
        }
        .card-hover-purple:hover {
            box-shadow: 0 0 30px -5px rgba(168, 85, 247, 0.3), 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: rgba(168, 85, 247, 0.5);
            transform: translateY(-4px);
        }
        
        .card-hover-red {
            transition: all 0.3s ease;
        }
        .card-hover-red:hover {
            box-shadow: 0 0 30px -5px rgba(239, 68, 68, 0.3), 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: rgba(239, 68, 68, 0.5);
            transform: translateY(-4px);
        }
        
        .card-hover-blue {
            transition: all 0.3s ease;
        }
        .card-hover-blue:hover {
            box-shadow: 0 0 30px -5px rgba(59, 130, 246, 0.3), 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-4px);
        }
        
        .card-hover-orange {
            transition: all 0.3s ease;
        }
        .card-hover-orange:hover {
            box-shadow: 0 0 30px -5px rgba(249, 115, 22, 0.3), 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: rgba(249, 115, 22, 0.5);
            transform: translateY(-4px);
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.3s ease;
        }
        
        /* Signature Website Animation - Berechnen Button */
        @keyframes signatureGlow {
            0% {
                box-shadow: 0 0 20px rgba(20, 184, 166, 0.6), 0 4px 15px rgba(20, 184, 166, 0.4);
            }
            50% {
                box-shadow: 0 0 40px rgba(20, 184, 166, 1), 0 8px 30px rgba(20, 184, 166, 0.8), 
                           0 0 60px rgba(20, 184, 166, 0.5);
            }
            100% {
                box-shadow: 0 0 20px rgba(20, 184, 166, 0.6), 0 4px 15px rgba(20, 184, 166, 0.4);
            }
        }
        
        @keyframes signatureShimmer {
            0% {
                background-position: -200% center;
            }
            100% {
                background-position: 200% center;
            }
        }
        
        @keyframes signaturePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes signatureSparkle {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0) rotate(0deg);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-30px) scale(1.5) rotate(360deg);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn-calculate {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.6), 0 4px 15px rgba(20, 184, 166, 0.4);
        }
        
        .btn-calculate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            transition: left 0.5s;
        }
        
        .btn-calculate:hover::before {
            left: 100%;
        }
        
        .btn-calculate.animating {
            animation: signatureGlow 1.5s ease-in-out infinite,
                       signaturePulse 1.5s ease-in-out infinite;
            pointer-events: none;
        }
        
        .btn-calculate.animating::after {
            content: '⚡';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            animation: signatureSparkle 1.5s ease-in-out infinite;
        }
        
        /* Sparkle particles */
        .sparkle-container {
            position: relative;
            overflow: hidden;
        }
        
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(20, 184, 166, 0.8);
            border-radius: 50%;
            pointer-events: none;
            animation: signatureSparkle 1.5s ease-out forwards;
        }
        
        /* Loading overlay for calculation */
        .calculating-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .calculating-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .calculating-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(20, 184, 166, 0.2);
            border-top-color: #14b8a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.6);
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .calculating-text {
            position: absolute;
            top: 100%;
            margin-top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #14b8a6;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(20, 184, 166, 0.8);
            animation: fadeInUp 0.5s ease;
            white-space: nowrap;
        }
        
        /* Result fade-in animation */
        /* Chart container heights */
        #capital-growth-chart,
        #deposits-interest-chart {
            height: 250px !important;
        }
        
        #tax-impact-chart {
            height: 300px !important;
        }
        
        #currency-history-chart {
            height: 300px !important;
        }
        
        #brutto-netto-retirement-chart {
            height: 350px !important;
        }
        
        #debt-development-chart,
        #interest-amortization-chart,
        #mortgage-debt-development-chart,
        #mortgage-interest-amortization-chart {
            height: 250px !important;
        }
        
        #inflation-chart {
            height: 300px !important;
        }

        #aktien-growth-chart {
            height: 300px !important;
        }

        .result-fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        /* MWST Rate Selection Radio Buttons */
        input[type="radio"]:checked + div {
            background-color: #14b8a6;
            color: white;
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.5), 0 0 40px rgba(20, 184, 166, 0.3);
            border-color: #14b8a6;
        }
        
        /* Mode Button Active State */
        .mode-btn.active {
            background-color: #14b8a6;
            color: white;
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.5), 0 0 40px rgba(20, 184, 166, 0.3);
        }
    </style>
 </head>
 <body class="min-h-screen bg-slate-950 text-slate-300">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NDSFXGM3"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Fixed Navigation Bar (shown only on calculator views) -->
     <nav id="nav" class="hidden fixed top-0 left-0 right-0 bg-slate-950/80 backdrop-blur-md border-b border-white/10 z-50 px-2 sm:px-4 py-2 sm:py-3">
        <div class="max-w-6xl mx-auto flex items-center justify-between gap-2 sm:gap-4">
             <h2 id="nav-title" class="text-sm sm:text-lg font-semibold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 truncate flex-1 min-w-0 mr-2"></h2>
             <button 
                 onclick="showPage('dashboard')" 
                 class="bg-slate-900/60 backdrop-blur-xl border border-white/10 text-white px-2 sm:px-4 py-2 rounded-lg font-medium touch-target hover:shadow-[0_0_30px_-5px_rgba(45,212,191,0.3)] hover:border-teal-500/50 transition-all duration-300 text-xs sm:text-base whitespace-nowrap flex-shrink-0"
             >
                <span class="hidden sm:inline">Zurück zum Dashboard</span>
                <span class="sm:hidden">Zurück</span>
            </button>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-6xl mx-auto px-4 py-6 md:py-8">
        
        <!-- Dashboard Page -->
        <div id="dashboard-view" class="page-transition">
            <!-- Header -->
            <header class="text-center mb-8 md:mb-12">
                 <h1 class="text-3xl md:text-4xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                     MeinRechner24
                 </h1>
                 <p class="text-slate-400 text-lg">
                     Deutschlands große Rechner-Zentrale - Kostenlos & Aktuell 2025
                 </p>
            </header>

            <!-- Category 1: Finanzen & Steuern (Teal) -->
            <section class="mb-8">
                 <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6">
                     <h2 class="text-2xl font-bold mb-4 flex items-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                         <span class="w-3 h-3 bg-teal-500 rounded-full mr-3 drop-shadow-lg"></span>
                         Finanzen & Steuern
                     </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                         <button 
                             onclick="showPage('brutto-netto')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-teal transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Brutto Netto Rechner</h3>
                             <p class="text-sm text-slate-400">Berechnen Sie Ihr Nettoeinkommen</p>
                         </button>
                         <button 
                             onclick="showPage('darlehen')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-teal transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Darlehen Rechner</h3>
                             <p class="text-sm text-slate-400">Annuitätendarlehen & Immobiliendarlehen</p>
                         </button>
                         <button 
                             onclick="showPage('zins')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-teal transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Zinsrechner</h3>
                             <p class="text-sm text-slate-400">Zinsen und Rendite berechnen</p>
                         </button>
                    </div>
                </div>
            </section>

            <!-- Category 2: Währung & Markt (Purple) -->
            <section class="mb-8">
                 <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6">
                     <h2 class="text-2xl font-bold mb-4 flex items-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                         <span class="w-3 h-3 bg-purple-500 rounded-full mr-3 drop-shadow-lg"></span>
                         Währung & Markt
                     </h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                         <button 
                             onclick="showPage('waehrung')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-purple transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Währungsrechner</h3>
                             <p class="text-sm text-slate-400">Währungen umrechnen</p>
                         </button>
                         <button 
                             onclick="showPage('inflation')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-purple transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Inflationsrechner</h3>
                             <p class="text-sm text-slate-400">Inflation berechnen</p>
                         </button>
                         <button 
                             onclick="showPage('aktien')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-purple transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Aktien Rendite</h3>
                             <p class="text-sm text-slate-400">Aktienrendite berechnen</p>
                         </button>
                    </div>
                </div>
            </section>

            <!-- Category 3: Gesundheit & Fitness (Red) -->
            <section class="mb-8">
                 <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6">
                     <h2 class="text-2xl font-bold mb-4 flex items-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                         <span class="w-3 h-3 bg-red-500 rounded-full mr-3 drop-shadow-lg"></span>
                         Gesundheit & Fitness
                     </h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                         <button 
                             onclick="showPage('bmi')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-red transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">BMI Rechner</h3>
                             <p class="text-sm text-slate-400">Body Mass Index berechnen</p>
                         </button>
                         <button 
                             onclick="showPage('kalorien')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-red transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Kalorienrechner</h3>
                             <p class="text-sm text-slate-400">Tagesbedarf an Kalorien</p>
                         </button>
                         <button 
                             onclick="showPage('promille')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-red transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Promillerechner</h3>
                             <p class="text-sm text-slate-400">Blutalkoholkonzentration</p>
                         </button>
                    </div>
                </div>
            </section>

            <!-- Category 4: Maße & Einheiten (Blue) -->
            <section class="mb-8">
                 <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6">
                     <h2 class="text-2xl font-bold mb-4 flex items-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                         <span class="w-3 h-3 bg-blue-500 rounded-full mr-3 drop-shadow-lg"></span>
                         Maße & Einheiten
                     </h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                         <button 
                             onclick="showPage('units')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-blue transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Einheiten-Umrechner</h3>
                             <p class="text-sm text-slate-400">Verschiedene Einheiten umrechnen</p>
                         </button>
                         <button 
                             onclick="showPage('speed')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-blue transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Geschwindigkeitsumrechner</h3>
                             <p class="text-sm text-slate-400">Geschwindigkeiten umrechnen</p>
                         </button>
                         <button 
                             onclick="showPage('flaeche')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-blue transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Flächenrechner</h3>
                             <p class="text-sm text-slate-400">Flächeneinheiten umrechnen</p>
                         </button>
                    </div>
                </div>
            </section>

            <!-- Category 5: Shopping & Alltag (Orange) -->
            <section class="mb-8">
                 <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6">
                     <h2 class="text-2xl font-bold mb-4 flex items-center text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                         <span class="w-3 h-3 bg-orange-500 rounded-full mr-3 drop-shadow-lg"></span>
                         Shopping & Alltag
                     </h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                         <button 
                             onclick="showPage('groessen')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-orange transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Kleidergrößen Umrechner</h3>
                             <p class="text-sm text-slate-400">Internationale Kleidergrößen</p>
                         </button>
                         <button 
                             onclick="showPage('benzin')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-orange transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Benzinpreis Rechner</h3>
                             <p class="text-sm text-slate-400">Tankkosten berechnen</p>
                         </button>
                         <button 
                             onclick="showPage('alter')" 
                             class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 text-left touch-target card-hover-orange transition-all duration-300 hover:-translate-y-1"
                         >
                             <h3 class="font-semibold text-white mb-1">Altersrechner</h3>
                             <p class="text-sm text-slate-400">Alter berechnen</p>
                         </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Calculator Views -->
        
        <!-- Brutto Netto Rechner (Fully Functional) -->
        <div id="brutto-netto-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Brutto Netto Rechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Ihr Nettoeinkommen 2025 präzise mit unserem kostenlosen Brutto-Netto-Rechner. Berücksichtigt alle deutschen Steuern, Sozialabgaben (Krankenversicherung, Rentenversicherung, Arbeitslosenversicherung), Solidaritätszuschlag und Kirchensteuer. Ideal für Steuerklassen I-VI, mit oder ohne Kinder, PKV oder GKV. Aktuell für 2025 mit neuesten Steuersätzen.</p>
                
                <form id="brutto-netto-form" class="space-y-6">
                    <div>
                        <label for="brutto" class="block text-sm font-medium text-slate-300 mb-2">
                            Bruttolohn
                        </label>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input 
                                type="number" 
                                id="brutto" 
                                name="brutto"
                                step="0.01"
                                min="0"
                                required
                                class="flex-1 px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="5000.00"
                            />
                            <select 
                                id="brutto_period" 
                                name="brutto_period"
                                required
                                class="px-4 py-3 dark-select rounded-lg text-base sm:text-lg w-full sm:w-auto"
                                style="min-width: 140px;"
                            >
                                <option value="monthly">Monatlich</option>
                                <option value="yearly">Jährlich</option>
                                <option value="weekly">Wöchentlich</option>
                                <option value="daily">Täglich</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label for="steuerklasse" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Steuerklasse
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    <p class="mb-1"><strong>I:</strong> Ledig, getrennt lebend oder verwitwet</p>
                                    <p class="mb-1"><strong>II:</strong> Alleinerziehend mit Anspruch auf Entlastungsbetrag</p>
                                    <p class="mb-1"><strong>III:</strong> Verheiratet (höherer Verdienst), Ehepartner in SK V</p>
                                    <p class="mb-1"><strong>IV:</strong> Verheiratet, beide verdienen (Standard)</p>
                                    <p class="mb-1"><strong>V:</strong> Verheiratet (niedrigerer Verdienst), Ehepartner in SK III</p>
                                    <p><strong>VI:</strong> Zweit- oder Nebenjob</p>
                                </div>
                            </span>
                        </label>
                        <select 
                            id="steuerklasse" 
                            name="steuerklasse"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="1">Steuerklasse I</option>
                            <option value="2">Steuerklasse II</option>
                            <option value="3">Steuerklasse III</option>
                            <option value="4">Steuerklasse IV</option>
                            <option value="5">Steuerklasse V</option>
                            <option value="6">Steuerklasse VI</option>
                        </select>
                    </div>

                    <div>
                        <label for="age" class="block text-sm font-medium text-slate-300 mb-2">
                            Alter
                        </label>
                        <input 
                            type="number" 
                            id="age" 
                            name="age"
                            min="16"
                            max="100"
                            value="30"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                        />
                    </div>

                    <div>
                        <label for="num_children" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Anzahl Kinder (0-5)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Kinder reduzieren die Pflegeversicherung (-0,25% pro Kind ab dem 2., max. 1% insgesamt) und erhöhen den Kinderfreibetrag (6.384€ pro Kind/Jahr).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="num_children" 
                            name="num_children"
                            min="0"
                            max="5"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                        />
                    </div>

                    <div>
                        <label for="state_kirchensteuer" class="block text-sm font-medium text-slate-300 mb-2">
                            Bundesland (für Kirchensteuer)
                        </label>
                        <select 
                            id="state_kirchensteuer" 
                            name="state_kirchensteuer"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="BW">Baden-Württemberg (8%)</option>
                            <option value="BY">Bayern (8%)</option>
                            <option value="BE">Berlin (9%)</option>
                            <option value="BB">Brandenburg (9%)</option>
                            <option value="HB">Bremen (9%)</option>
                            <option value="HH">Hamburg (9%)</option>
                            <option value="HE">Hessen (9%)</option>
                            <option value="MV">Mecklenburg-Vorpommern (9%)</option>
                            <option value="NI">Niedersachsen (9%)</option>
                            <option value="NW">Nordrhein-Westfalen (9%)</option>
                            <option value="RP">Rheinland-Pfalz (9%)</option>
                            <option value="SL">Saarland (9%)</option>
                            <option value="SN">Sachsen (9%)</option>
                            <option value="ST">Sachsen-Anhalt (9%)</option>
                            <option value="SH">Schleswig-Holstein (9%)</option>
                            <option value="TH">Thüringen (8%)</option>
                        </select>
                    </div>

                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="church_member" 
                            name="church_member"
                            class="w-5 h-5 text-teal-500 border-gray-600 rounded focus:ring-teal-500 bg-gray-900"
                        />
                        <label for="church_member" class="ml-2 text-sm font-medium text-slate-300">
                            Kirchensteuerpflichtig
                        </label>
                    </div>

                    <div>
                        <label for="kv_status" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Krankenversicherung Status
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    <p class="mb-1"><strong>Regulär:</strong> Normalbeitrag 14,6%, Arbeitnehmer zahlt 7,3% zzgl. Hälfte des Zusatzbeitrags</p>
                                    <p class="mb-1"><strong>Ermäßigt:</strong> Reduzierter Beitrag 14,0%, Arbeitnehmer zahlt 7,0% zzgl. Hälfte des Zusatzbeitrags (ohne Krankengeldanspruch)</p>
                                    <p><strong>Privat:</strong> Keine gesetzliche KV, Arbeitgeberzuschuss wird berechnet</p>
                                </div>
                            </span>
                        </label>
                        <select 
                            id="kv_status" 
                            name="kv_status"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                            onchange="togglePKVFields()"
                        >
                            <option value="general">Regulär (14,6%)</option>
                            <option value="reduced">Ermäßigt (14,0%)</option>
                            <option value="private">Privat versichert</option>
                        </select>
                    </div>

                    <div id="kv_zusatzbeitrag_container">
                        <label for="krankenkasse_zusatzbeitrag" class="block text-sm font-medium text-slate-300 mb-2">
                            Krankenkasse Zusatzbeitrag (z.B. 1.7%)
                        </label>
                        <input 
                            type="number" 
                            id="krankenkasse_zusatzbeitrag" 
                            name="krankenkasse_zusatzbeitrag"
                            step="0.1"
                            min="0"
                            max="5"
                            value="1.7"
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="1.7"
                        />
                        <p class="text-xs text-slate-400 mt-1">Geben Sie den individuellen Zusatzbeitrag Ihrer Krankenkasse ein</p>
                    </div>

                    <div id="pkv_fields_container" class="hidden space-y-4">
                        <div>
                            <label for="pkv_monthly_contribution" class="block text-sm font-medium text-slate-300 mb-2">
                                Monatlicher PKV-Beitrag (gesamt) (€)
                            </label>
                            <input 
                                type="number" 
                                id="pkv_monthly_contribution" 
                                name="pkv_monthly_contribution"
                                step="0.01"
                                min="0"
                                value="0"
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="0.00"
                            />
                        </div>
                        <div>
                            <label for="pkv_contribution_eligible_for_subsidy" class="block text-sm font-medium text-slate-300 mb-2">
                                Zuschussfähiger PKV-Beitragsanteil (€)
                            </label>
                            <input 
                                type="number" 
                                id="pkv_contribution_eligible_for_subsidy" 
                                name="pkv_contribution_eligible_for_subsidy"
                                step="0.01"
                                min="0"
                                value="0"
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="0.00"
                            />
                            <p class="text-xs text-slate-400 mt-1">Anteil des PKV-Beitrags, der für Arbeitgeberzuschuss berechtigt ist</p>
                        </div>
                    </div>

                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="is_pension_exempt" 
                            name="is_pension_exempt"
                            class="w-5 h-5 text-teal-500 border-gray-600 rounded focus:ring-teal-500 bg-gray-900"
                        />
                        <label for="is_pension_exempt" class="ml-2 text-sm font-medium text-slate-300">
                            Von Rentenversicherung befreit (z.B. Beamter)
                        </label>
                    </div>

                    <div>
                        <label for="steuerfreibetrag_monthly" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Monatlicher Steuerfreibetrag (optional, z.B. für Fahrtkosten)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Ein optionaler monatlicher Freibetrag reduziert Ihr zu versteuerndes Einkommen. Beispiele: hohe Fahrtkosten, außergewöhnliche Belastungen.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="steuerfreibetrag_monthly" 
                            name="steuerfreibetrag_monthly"
                            step="0.01"
                            min="0"
                            value="0"
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.00"
                        />
                    </div>

                    <button 
                        type="submit"
                        id="calculate-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <div id="brutto-netto-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-teal backdrop-blur-sm">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-teal">Ergebnis (Monatlich)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-slate-400">Bruttolohn</p>
                                <p id="result-brutto" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400">Nettolohn</p>
                                <p id="result-netto" class="text-2xl font-bold text-teal-400 text-glow-teal"></p>
                            </div>
                        </div>
                        <div class="border-t border-gray-700 pt-4">
                            <h4 class="text-lg font-semibold text-red-400 mb-3">Abzüge im Detail</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Lohnsteuer</span>
                                    <span id="result-lohnsteuer" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Solidaritätszuschlag</span>
                                    <span id="result-soli" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Kirchensteuer</span>
                                    <span id="result-kirchensteuer" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Krankenversicherung (KV)</span>
                                    <span id="result-kv" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div id="result-pkv-container" class="hidden">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-slate-400">PKV Beitrag (privat)</span>
                                        <span id="result-pkv" class="text-base font-semibold text-red-400">-</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-slate-400">AG-Zuschuss PKV</span>
                                        <span id="result-ag-zuschuss" class="text-base font-semibold text-green-400"></span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Pflegeversicherung (PV)</span>
                                    <span id="result-pv" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Rentenversicherung (RV)</span>
                                    <span id="result-rv" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-slate-400">Arbeitslosenversicherung (AV)</span>
                                    <span id="result-av" class="text-base font-semibold text-red-400">-</span>
                                </div>
                                <div class="border-t border-gray-700 pt-2 mt-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-semibold text-slate-300">Gesamte Abzüge</span>
                                        <span id="result-total-deductions" class="text-lg font-bold text-red-400"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Time Worked Statistics -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Arbeitszeit-Analyse: Für wen arbeiten Sie?</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-teal-900/30 rounded-lg p-4 border border-teal-500/30 text-center">
                                    <p class="text-sm text-teal-300 mb-2">Für sich selbst gearbeitet</p>
                                    <p id="time-for-self" class="text-2xl font-bold text-teal-400"></p>
                                    <p id="time-for-self-breakdown" class="text-xs text-teal-200 mt-1"></p>
                                </div>
                                <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30 text-center">
                                    <p class="text-sm text-red-300 mb-2">Für den Staat gearbeitet</p>
                                    <p id="time-for-state" class="text-2xl font-bold text-red-400"></p>
                                    <p id="time-for-state-breakdown" class="text-xs text-red-200 mt-1"></p>
                                </div>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                                <p class="text-sm text-slate-300 mb-1">Anteil der Arbeitszeit</p>
                                <div class="flex items-center justify-center gap-2">
                                    <div class="flex-1 bg-gray-700 rounded-full h-6 relative overflow-hidden">
                                        <div id="work-for-self-bar" class="h-full bg-teal-500 transition-all duration-500 flex items-center justify-center">
                                            <span id="self-percentage" class="text-xs font-bold text-white"></span>
                                        </div>
                                        <div id="work-for-state-bar" class="absolute top-0 right-0 h-full bg-red-500 transition-all duration-500 flex items-center justify-end pr-2">
                                            <span id="state-percentage" class="text-xs font-bold text-white"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Retirement Chart -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Bis zur Rente: Geld in der Hand vs. Abgaben an den Staat</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <canvas id="brutto-netto-retirement-chart"></canvas>
                            </div>
                            <p id="retirement-chart-info" class="text-xs text-slate-400 text-center mt-3">
                                Visualisierung bis zum Rentenalter
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Darlehen Rechner Selection Page -->
        <div id="darlehen-view" class="hidden page-transition">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center text-glow-teal">Darlehen Rechner</h2>
                <p class="text-slate-300 text-center mb-8">Wählen Sie den passenden Rechner für Ihre Bedürfnisse</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Annuitätendarlehen Rechner Card -->
                    <button 
                        onclick="showPage('mwst')"
                        class="bg-gray-800/90 rounded-lg shadow-lg p-8 text-left touch-target card-hover-teal border-2 border-teal-500/50 hover:border-teal-400 transition-all"
                    >
                        <div class="flex items-center justify-center mb-4">
                            <div class="w-16 h-16 bg-teal-600 rounded-full flex items-center justify-center glow-teal">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-5m-5 5h.01M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v14a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2 text-glow-teal">Annuitätendarlehen Rechner</h3>
                        <p class="text-slate-300 text-sm mb-4">Berechnen Sie die monatliche Rate, Zinsen und Tilgung für ein Darlehen mit konstanter Annuität.</p>
                        <ul class="text-slate-400 text-xs space-y-1">
                            <li>✓ Konstante monatliche Rate</li>
                            <li>✓ Vollständiger Tilgungsplan</li>
                            <li>✓ Bis zur vollständigen Tilgung</li>
                        </ul>
                    </button>

                    <!-- Immobiliendarlehen Rechner Card -->
                    <button 
                        onclick="showPage('immobilien')"
                        class="bg-gray-800/90 rounded-lg shadow-lg p-8 text-left touch-target card-hover-teal border-2 border-teal-500/50 hover:border-teal-400 transition-all"
                    >
                        <div class="flex items-center justify-center mb-4">
                            <div class="w-16 h-16 bg-teal-600 rounded-full flex items-center justify-center glow-teal">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2 text-glow-teal">Immobiliendarlehen Rechner</h3>
                        <p class="text-slate-300 text-sm mb-4">Berechnen Sie die kompletten Kosten für eine Immobilienfinanzierung inklusive aller Nebenkosten.</p>
                        <ul class="text-slate-400 text-xs space-y-1">
                            <li>✓ Nebenkosten (Grunderwerbsteuer, Notar, etc.)</li>
                            <li>✓ Benötigtes Darlehen</li>
                            <li>✓ Effektivzins-Berechnung</li>
                        </ul>
                    </button>
                </div>
            </div>
        </div>

        <!-- Annuitätendarlehen Rechner (Fully Functional) -->
        <div id="mwst-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Annuitätendarlehen Rechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Erstellen Sie einen detaillierten Tilgungsplan für Ihr Annuitätendarlehen. Berechnen Sie monatliche Raten, Zins- und Tilgungsanteile, Restschuld und Gesamtzinsen. Ideal für Baufinanzierung, Immobilienkredit und Kreditvergleich. Mit Sondertilgungsoption und vollständigem Amortisationsplan für die gesamte Zinsbindungsdauer.</p>
                
                <form id="loan-form" class="space-y-6">
                    <div>
                        <label for="loan_amount" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Nettodarlehensbetrag (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der Betrag, den Sie als Darlehen erhalten (ohne Nebenkosten).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="loan_amount" 
                            name="loan_amount"
                            step="1000"
                            min="1000"
                            value="300000"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="300000"
                        />
                    </div>

                    <div>
                        <label for="interest_rate_nominal_pa" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Nominalzinssatz pro Jahr (%)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der Sollzins (Nominalzins) pro Jahr, den die Bank berechnet (z.B. 3.5 für 3,5%).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="interest_rate_nominal_pa" 
                            name="interest_rate_nominal_pa"
                            step="0.01"
                            min="0.01"
                            max="20"
                            value="3.5"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="3.5"
                        />
                    </div>

                    <div>
                        <label for="initial_amortization_rate" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Anfänglicher Tilgungssatz (% pro Jahr)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der anfängliche Tilgungssatz in Prozent pro Jahr (z.B. 2 für 2%). Zusammen mit dem Zinssatz bestimmt er die monatliche Annuität.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="initial_amortization_rate" 
                            name="initial_amortization_rate"
                            step="0.1"
                            min="0.1"
                            max="20"
                            value="2"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="2"
                        />
                    </div>

                    <div>
                        <label for="zinsbindung_years" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Zinsbindung (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Die Laufzeit der Zinsbindung in Jahren (z.B. 10 oder 15 Jahre). Nach Ablauf kann der Zinssatz neu verhandelt werden.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="zinsbindung_years" 
                            name="zinsbindung_years"
                            step="1"
                            min="1"
                            max="30"
                            value="10"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="10"
                        />
                    </div>

                    <div>
                        <label for="extra_payment_annual" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Jährliche Sondertilgung (€, optional)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Optionale jährliche Sondertilgung, die zusätzlich zur regulären Tilgung gezahlt wird. Reduziert die Restschuld und damit die Zinslast. Geben Sie 0 ein, wenn keine Sondertilgung gewünscht ist.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="extra_payment_annual" 
                            name="extra_payment_annual"
                            step="100"
                            min="0"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0"
                        />
                    </div>

                    <button 
                        type="submit"
                        id="calculate-loan-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative"
                    >
                        Berechnen
                    </button>
                </form>

                <!-- Results Section -->
                <div id="loan-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-teal backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-teal">Ergebnis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Monatliche Annuität</p>
                                <p id="result-monthly-annuity" class="text-2xl font-bold text-teal-400 text-glow-teal"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Restschuld nach Zinsbindung</p>
                                <p id="result-remaining-debt" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Gesamte Zinsen gezahlt</p>
                                <p id="result-total-interest" class="text-xl font-semibold text-red-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Gesamte Tilgung</p>
                                <p id="result-total-amortized" class="text-xl font-semibold text-green-400"></p>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Visualisierung</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Restschuld-Entwicklung</h5>
                                    <canvas id="debt-development-chart"></canvas>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Zinsen vs. Tilgung</h5>
                                    <canvas id="interest-amortization-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Tilgungsplan -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Tilgungsplan (Amortization Schedule)</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4 max-h-96 overflow-y-auto table-container">
                                  <table class="w-full text-sm min-w-full">
                                    <thead class="sticky top-0 bg-gray-900">
                                        <tr class="text-left border-b border-gray-700">
                                            <th class="pb-2 text-slate-300 font-semibold">Jahr</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Zinsen (Jahr)</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Tilgung (Jahr)</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Restschuld (Ende Jahr)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tilgungsplan-body">
                                        <!-- Tilgungsplan will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <p class="text-xs text-slate-400 text-center italic">
                                <span id="disclaimer-note"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Immobiliendarlehen Rechner (Fully Functional) -->
        <div id="immobilien-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Immobiliendarlehen Rechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie die kompletten Kosten für Ihre Immobilienfinanzierung inklusive aller Nebenkosten. Grunderwerbsteuer nach Bundesland, Notar- und Grundbuchkosten, Maklerprovision, Disagio und Effektivzins. Perfekt für Hauskauf, Wohnungskauf und Immobilieninvestitionen. Mit Tilgungsplan und Restschuldberechnung.</p>
                
                <form id="mortgage-form" class="space-y-6">
                    <!-- Property Purchase Details -->
                    <div class="border-b border-gray-700 pb-4">
                        <h3 class="text-lg font-semibold text-teal-400 mb-4">Kaufdetails</h3>
                        
                        <div>
                            <label for="purchase_price" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Kaufpreis der Immobilie (€)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Der vereinbarte Kaufpreis der Immobilie ohne Nebenkosten.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="purchase_price" 
                                name="purchase_price"
                                step="1000"
                                min="10000"
                                value="400000"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="400000"
                            />
                        </div>

                        <div>
                            <label for="equity" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Eigenkapital (€)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Das vorhandene Eigenkapital, das Sie für den Kauf verwenden können.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="equity" 
                                name="equity"
                                step="1000"
                                min="0"
                                value="80000"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="80000"
                            />
                        </div>

                        <div>
                            <label for="state_grunderwerbsteuer" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Bundesland (für Grunderwerbsteuer)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Das Bundesland, in dem sich die Immobilie befindet, bestimmt den Grunderwerbsteuersatz.
                                    </div>
                                </span>
                            </label>
                            <select 
                                id="state_grunderwerbsteuer" 
                                name="state_grunderwerbsteuer"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            >
                                <option value="BW">Baden-Württemberg (5.0%)</option>
                                <option value="BY">Bayern (3.5%)</option>
                                <option value="BE">Berlin (6.0%)</option>
                                <option value="BB">Brandenburg (6.5%)</option>
                                <option value="HB">Bremen (5.0%)</option>
                                <option value="HH">Hamburg (4.5%)</option>
                                <option value="HE" selected>Hessen (6.0%)</option>
                                <option value="MV">Mecklenburg-Vorpommern (6.0%)</option>
                                <option value="NI">Niedersachsen (5.0%)</option>
                                <option value="NW">Nordrhein-Westfalen (6.5%)</option>
                                <option value="RP">Rheinland-Pfalz (5.0%)</option>
                                <option value="SL">Saarland (6.5%)</option>
                                <option value="SN">Sachsen (3.5%)</option>
                                <option value="ST">Sachsen-Anhalt (5.0%)</option>
                                <option value="SH">Schleswig-Holstein (6.5%)</option>
                                <option value="TH">Thüringen (6.5%)</option>
                            </select>
                        </div>

                        <div>
                            <label for="notary_cost_percent" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Notar- und Grundbuchkosten (%)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Notar- und Grundbuchkosten in Prozent des Kaufpreises. Standard: 2.0%
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="notary_cost_percent" 
                                name="notary_cost_percent"
                                step="0.1"
                                min="0"
                                max="10"
                                value="2.0"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="2.0"
                            />
                        </div>

                        <div>
                            <label for="broker_commission_percent" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Maklerprovision (%)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Maklerprovision in Prozent des Kaufpreises. Kann 0 sein, Standard: 3.57%
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="broker_commission_percent" 
                                name="broker_commission_percent"
                                step="0.01"
                                min="0"
                                max="10"
                                value="3.57"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="3.57"
                            />
                        </div>
                    </div>

                    <!-- Loan Terms -->
                    <div class="border-b border-gray-700 pb-4">
                        <h3 class="text-lg font-semibold text-teal-400 mb-4">Darlehenskonditionen</h3>
                        
                        <div>
                            <label for="mortgage_nominal_interest_rate_pa" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Nominalzinssatz pro Jahr (%)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Der Sollzins (Nominalzins) pro Jahr, den die Bank berechnet.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="mortgage_nominal_interest_rate_pa" 
                                name="mortgage_nominal_interest_rate_pa"
                                step="0.01"
                                min="0.01"
                                max="20"
                                value="3.5"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="3.5"
                            />
                        </div>

                        <div>
                            <label for="mortgage_zinsbindung_years" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Zinsbindung (Jahre)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Die Laufzeit der Zinsbindung in Jahren.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="mortgage_zinsbindung_years" 
                                name="mortgage_zinsbindung_years"
                                step="1"
                                min="1"
                                max="30"
                                value="10"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="10"
                            />
                        </div>

                        <div>
                            <label for="mortgage_initial_amortization_rate" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Anfänglicher Tilgungssatz (% pro Jahr)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Der anfängliche Tilgungssatz in Prozent pro Jahr (z.B. 2 für 2%).
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="mortgage_initial_amortization_rate" 
                                name="mortgage_initial_amortization_rate"
                                step="0.1"
                                min="0.1"
                                max="20"
                                value="2"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="2"
                            />
                        </div>

                        <div>
                            <label for="mortgage_extra_payment_annual" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Jährliche Sondertilgung (€, optional)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Optionale jährliche Sondertilgung. Geben Sie 0 ein, wenn keine Sondertilgung gewünscht ist.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="mortgage_extra_payment_annual" 
                                name="mortgage_extra_payment_annual"
                                step="100"
                                min="0"
                                value="0"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="0"
                            />
                        </div>

                        <div>
                            <label for="disagio_percent" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Disagio (%)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-teal-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Disagio (Abgeld) in Prozent. Reduziert den Auszahlungsbetrag und damit den Effektivzins. Standard: 0%
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="disagio_percent" 
                                name="disagio_percent"
                                step="0.1"
                                min="0"
                                max="10"
                                value="0"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="0"
                            />
                        </div>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-mortgage-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative"
                    >
                        Berechnen
                    </button>
                </form>

                <!-- Results Section -->
                <div id="mortgage-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-teal backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-teal">Ergebnis</h3>
                        
                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Gesamtinvestition</p>
                                <p id="result-total-investment" class="text-2xl font-bold text-teal-400 text-glow-teal"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Benötigtes Darlehen</p>
                                <p id="result-required-loan" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Monatliche Annuität</p>
                                <p id="result-mortgage-monthly-annuity" class="text-xl font-semibold text-teal-300"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Effektiver Jahreszins</p>
                                <p id="result-effective-rate" class="text-xl font-semibold text-yellow-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Restschuld nach Zinsbindung</p>
                                <p id="result-mortgage-remaining-debt" class="text-xl font-semibold text-white"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Gesamte Nebenkosten</p>
                                <p id="result-total-ancillary-costs" class="text-xl font-semibold text-red-400"></p>
                            </div>
                        </div>

                        <!-- Cost Breakdown -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Nebenkosten-Übersicht</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <p class="text-slate-400 mb-1">Grunderwerbsteuer</p>
                                        <p id="result-grunderwerbsteuer" class="text-lg font-semibold text-red-400"></p>
                                    </div>
                                    <div>
                                        <p class="text-slate-400 mb-1">Notar & Grundbuch</p>
                                        <p id="result-notary-grundbuch" class="text-lg font-semibold text-red-400"></p>
                                    </div>
                                    <div>
                                        <p class="text-slate-400 mb-1">Maklerprovision</p>
                                        <p id="result-broker-commission" class="text-lg font-semibold text-red-400"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Charts -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Visualisierung</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Restschuld-Entwicklung</h5>
                                    <canvas id="mortgage-debt-development-chart"></canvas>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Zinsen vs. Tilgung</h5>
                                    <canvas id="mortgage-interest-amortization-chart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Tilgungsplan Summary -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Tilgungsplan (Jahresübersicht für die Zinsbindung)</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4 max-h-96 overflow-y-auto table-container">
                                  <table class="w-full text-sm min-w-full">
                                    <thead class="sticky top-0 bg-gray-900">
                                        <tr class="text-left border-b border-gray-700">
                                            <th class="pb-2 text-slate-300 font-semibold">Jahr</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Zinsen (Jahr)</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Tilgung (Jahr)</th>
                                            <th class="pb-2 text-slate-300 font-semibold text-right">Restschuld (Ende Jahr)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="mortgage-tilgungsplan-body">
                                        <!-- Tilgungsplan will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <p class="text-xs text-slate-400 text-center italic">
                                Die tatsächlichen Effektivzinsen sind bankindividuell und können abweichen (PAngV). Die Nebenkosten können je nach Region und Situation variieren.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zinsrechner (Fully Functional) -->
        <div id="zins-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Zinsrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Zinserträge, Zinseszins und Endkapital für Sparpläne und Geldanlagen. Mit Steuerberechnung (Abgeltungssteuer 25%, Soli, Kirchensteuer), Sparer-Pauschbetrag, Gebühren und jährlicher Dynamik. Ideal für Tagesgeld, Festgeld, Sparbuch und Zinsanlagen. Jährliche Aufschlüsselung und Visualisierung inklusive.</p>
                
                <form id="zins-form" class="space-y-6">
                    <div>
                        <label for="initial_capital" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Anfangskapital (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Das Anfangskapital ist der Betrag, mit dem Sie starten (z.B. bereits vorhandene Ersparnisse).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="initial_capital" 
                            name="initial_capital"
                            step="0.01"
                            min="0"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.00"
                        />
                    </div>

                    <div>
                        <label for="monthly_rate" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Monatliche Sparrate (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der monatliche Betrag, den Sie regelmäßig sparen. Kann jährlich erhöht werden (Dynamik).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="monthly_rate" 
                            name="monthly_rate"
                            step="0.01"
                            min="0"
                            value="100"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="100.00"
                        />
                    </div>

                    <div>
                        <label for="interest_rate_pa" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Jährlicher Zinssatz (%)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der jährliche Zinssatz in Prozent (z.B. 3.5 für 3,5%). Die Zinsen werden jährlich verzinst (Zinseszins).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="interest_rate_pa" 
                            name="interest_rate_pa"
                            step="0.1"
                            min="0"
                            max="100"
                            value="3.5"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="3.5"
                        />
                    </div>

                    <div>
                        <label for="duration_years" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Laufzeit (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Die Gesamtlaufzeit des Sparplans in Jahren.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="duration_years" 
                            name="duration_years"
                            step="1"
                            min="1"
                            max="100"
                            value="10"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="10"
                        />
                    </div>

                    <div>
                        <label for="rate_increase_annual_percent" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Jährliche Dynamik (%)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Jährliche Erhöhung der Sparrate in Prozent (z.B. 2% bedeutet, die monatliche Rate steigt jährlich um 2%). Setzen Sie 0 ein, wenn keine Dynamik gewünscht ist.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="rate_increase_annual_percent" 
                            name="rate_increase_annual_percent"
                            step="0.1"
                            min="0"
                            max="50"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0"
                        />
                    </div>

                    <div>
                        <label for="sparer_pauschbetrag_used" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Bereits genutzter Sparer-Pauschbetrag (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der bereits genutzte Sparer-Pauschbetrag (max. 1.000€ für Alleinstehende). Zinserträge bis zu diesem Betrag sind steuerfrei. Geben Sie an, wie viel bereits verbraucht wurde.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="sparer_pauschbetrag_used" 
                            name="sparer_pauschbetrag_used"
                            step="0.01"
                            min="0"
                            max="1000"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.00"
                        />
                    </div>

                    <div>
                        <label for="fees_percent_pa" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Gebühren in % pro Jahr
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Geben Sie bitte hier die Höhe eventuell anfallender jährlicher Gebühren für die Verwaltung des Kapitals in Prozent an. Mittels Management- oder Verwaltungsgebühren werden z.B. die Kosten für die Verwaltung eines Fonds abgedeckt. Zu diesen Kosten zählen die Gehälter und Gebühren für das Analyse- und Research-Team, das Fondsmanagement, den Kauf und die Verwaltung von Wertpapieren und ähnliche Punkte.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="fees_percent_pa" 
                            name="fees_percent_pa"
                            step="0.01"
                            min="0"
                            max="10"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.00"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Steuer berücksichtigen</label>
                        <div class="flex gap-4">
                            <label class="flex items-center cursor-pointer">
                                <input 
                                    type="radio" 
                                    name="include_tax" 
                                    value="yes"
                                    id="include_tax_yes"
                                    checked
                                    class="w-5 h-5 text-teal-500 border-gray-600 focus:ring-teal-500 bg-gray-900"
                                />
                                <span class="ml-2 text-slate-300">Ja</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input 
                                    type="radio" 
                                    name="include_tax" 
                                    value="no"
                                    id="include_tax_no"
                                    class="w-5 h-5 text-teal-500 border-gray-600 focus:ring-teal-500 bg-gray-900"
                                />
                                <span class="ml-2 text-slate-300">Nein</span>
                            </label>
                        </div>
                    </div>

                    <div id="tax_rate_container">
                        <label for="tax_rate_percent" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Steuersatz in %
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-teal-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 border border-teal-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Geben Sie bitte den Steuersatz ein, um den die Kapitalerträge nach Abzug des Steuerfreibetrags gemindert werden.<br><br>
                                    Seit 2009 gilt auf Kapitalerträge eine Abgeltungssteuer von 25% zuzüglich Soli von 5,5% (von diesen 25%), so dass sich ein Steuersatz von 26,375% ergibt.<br><br>
                                    Bei zusätzlicher Berücksichtigung von 8% Kirchensteuer (Baden-Württemberg, Bayern) ergibt sich ein Steuersatz von 27,8186%, bei 9% Kirchensteuer (übrige Bundesländer) sind es 27,9951%.<br><br>
                                    Falls Ihr persönlicher Steuersatz unterhalb von 25% liegt, können die Kapitalerträge zu diesem geringeren Satz versteuert werden. Auch hier sind Soli und Kirchensteuer zu berücksichtigen.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="tax_rate_percent" 
                            name="tax_rate_percent"
                            step="0.0001"
                            min="0"
                            max="50"
                            value="26.375"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="26.375"
                        />
                    </div>

                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="zins_church_member" 
                            name="zins_church_member"
                            class="w-5 h-5 text-teal-500 border-gray-600 rounded focus:ring-teal-500 bg-gray-900"
                        />
                        <label for="zins_church_member" class="ml-2 text-sm font-medium text-slate-300">
                            Kirchensteuerpflichtig (für Abgeltungssteuer)
                        </label>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-zins-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <div id="zins-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-teal backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-teal">Ergebnis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Endkapital</p>
                                <p id="result-final-capital" class="text-2xl font-bold text-teal-400 text-glow-teal"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Gesamteinzahlungen</p>
                                <p id="result-total-deposits" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Brutto-Zinserträge</p>
                                <p id="result-gross-interest" class="text-xl font-semibold text-gray-200"></p>
                            </div>
                            <div id="result-fees-container" class="hidden">
                                <p class="text-sm text-slate-400 mb-1">Gebühren gezahlt</p>
                                <p id="result-fees-deducted" class="text-xl font-semibold text-yellow-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Steuern gezahlt</p>
                                <p id="result-tax-deducted" class="text-xl font-semibold text-red-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Netto-Zinserträge</p>
                                <p id="result-net-interest" class="text-xl font-semibold text-green-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-slate-400 mb-1">Rendite (Netto)</p>
                                <p id="result-net-return" class="text-xl font-semibold text-teal-300"></p>
                            </div>
                        </div>
                        <div class="border-t border-gray-700 pt-4 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Jährliche Aufschlüsselung</h4>
                            <div id="zins-breakdown" class="space-y-2 max-h-96 overflow-y-auto">
                                <!-- Annual breakdown will be inserted here -->
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4">Visualisierung</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Kapitalentwicklung</h5>
                                    <canvas id="capital-growth-chart"></canvas>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Einzahlungen vs. Zinsen</h5>
                                    <canvas id="deposits-interest-chart"></canvas>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4 md:col-span-2">
                                    <h5 class="text-md font-medium text-slate-300 mb-3">Steuerauswirkung</h5>
                                    <canvas id="tax-impact-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Währungsrechner (Currency Converter) -->
        <div id="waehrung-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-3xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Währungsrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Kostenloser Währungsrechner mit aktuellen Wechselkursen. Rechnen Sie Euro, Dollar, Pfund, Yen und über 160 weitere Währungen um. Echtzeit-Kurse, historische Kurse und Umrechnungstabelle. Perfekt für Reisen, Online-Shopping, Devisenhandel und internationale Transaktionen. Aktualisiert täglich.</p>
                
                <!-- Loading Indicator -->
                <div id="waehrung-loading" class="hidden text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-400 mb-4"></div>
                    <p class="text-purple-300 text-lg">Aktuelle Kurse werden geladen...</p>
                </div>

                <!-- Currency Converter Form -->
                <div id="waehrung-calculator" class="hidden">
                    <form id="waehrung-form" class="space-y-6">
                        <!-- From Currency Section -->
                        <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 border border-purple-500/30">
                            <label for="from-currency" class="block text-sm font-medium text-purple-300 mb-3">
                                Von
                            </label>
                            <div class="flex gap-3 items-center">
                                <select 
                                    id="from-currency" 
                                    name="from-currency"
                                    class="flex-1 px-4 py-3 dark-input rounded-lg text-lg border-purple-500/50 focus:border-purple-400 focus:ring-purple-500"
                                >
                                    <option value="EUR" selected>EUR - Euro</option>
                                    <option value="USD">USD - US-Dollar</option>
                                    <option value="AED">AED - UAE Dirham</option>
                                    <option value="AFN">AFN - Afghani</option>
                                    <option value="ALL">ALL - Lek</option>
                                    <option value="AMD">AMD - Dram</option>
                                    <option value="ANG">ANG - Netherlands Antillean Guilder</option>
                                    <option value="AOA">AOA - Kwanza</option>
                                    <option value="ARS">ARS - Peso</option>
                                    <option value="AUD">AUD - Australian Dollar</option>
                                    <option value="AWG">AWG - Florin</option>
                                    <option value="AZN">AZN - Manat</option>
                                    <option value="BAM">BAM - Convertible Mark</option>
                                    <option value="BBD">BBD - Dollar</option>
                                    <option value="BDT">BDT - Taka</option>
                                    <option value="BGN">BGN - Lev</option>
                                    <option value="BHD">BHD - Dinar</option>
                                    <option value="BIF">BIF - Franc</option>
                                    <option value="BMD">BMD - Dollar</option>
                                    <option value="BND">BND - Dollar</option>
                                    <option value="BOB">BOB - Boliviano</option>
                                    <option value="BRL">BRL - Real</option>
                                    <option value="BSD">BSD - Dollar</option>
                                    <option value="BTN">BTN - Ngultrum</option>
                                    <option value="BWP">BWP - Pula</option>
                                    <option value="BYN">BYN - Rubel</option>
                                    <option value="BZD">BZD - Dollar</option>
                                    <option value="CAD">CAD - Kanadischer Dollar</option>
                                    <option value="CDF">CDF - Franc</option>
                                    <option value="CHF">CHF - Schweizer Franken</option>
                                    <option value="CLP">CLP - Peso</option>
                                    <option value="CNY">CNY - Renminbi</option>
                                    <option value="COP">COP - Peso</option>
                                    <option value="CRC">CRC - Colón</option>
                                    <option value="CUP">CUP - Peso</option>
                                    <option value="CVE">CVE - Escudo</option>
                                    <option value="CZK">CZK - Krone</option>
                                    <option value="DJF">DJF - Franc</option>
                                    <option value="DKK">DKK - Krone</option>
                                    <option value="DOP">DOP - Peso</option>
                                    <option value="DZD">DZD - Dinar</option>
                                    <option value="EGP">EGP - Pfund</option>
                                    <option value="ERN">ERN - Nakfa</option>
                                    <option value="ETB">ETB - Birr</option>
                                    <option value="FJD">FJD - Dollar</option>
                                    <option value="FKP">FKP - Pfund</option>
                                    <option value="GBP">GBP - Britisches Pfund</option>
                                    <option value="GEL">GEL - Lari</option>
                                    <option value="GHS">GHS - Cedi</option>
                                    <option value="GIP">GIP - Pfund</option>
                                    <option value="GMD">GMD - Dalasi</option>
                                    <option value="GNF">GNF - Franc</option>
                                    <option value="GTQ">GTQ - Quetzal</option>
                                    <option value="GYD">GYD - Dollar</option>
                                    <option value="HKD">HKD - Dollar</option>
                                    <option value="HNL">HNL - Lempira</option>
                                    <option value="HRK">HRK - Kuna</option>
                                    <option value="HTG">HTG - Gourde</option>
                                    <option value="HUF">HUF - Forint</option>
                                    <option value="IDR">IDR - Rupiah</option>
                                    <option value="ILS">ILS - Schekel</option>
                                    <option value="INR">INR - Rupie</option>
                                    <option value="IQD">IQD - Dinar</option>
                                    <option value="IRR">IRR - Rial</option>
                                    <option value="ISK">ISK - Krone</option>
                                    <option value="JMD">JMD - Dollar</option>
                                    <option value="JOD">JOD - Dinar</option>
                                    <option value="JPY">JPY - Japanischer Yen</option>
                                    <option value="KES">KES - Schilling</option>
                                    <option value="KGS">KGS - Som</option>
                                    <option value="KHR">KHR - Riel</option>
                                    <option value="KMF">KMF - Franc</option>
                                    <option value="KPW">KPW - Won</option>
                                    <option value="KRW">KRW - Won</option>
                                    <option value="KWD">KWD - Dinar</option>
                                    <option value="KYD">KYD - Dollar</option>
                                    <option value="KZT">KZT - Tenge</option>
                                    <option value="LAK">LAK - Kip</option>
                                    <option value="LBP">LBP - Pfund</option>
                                    <option value="LKR">LKR - Rupie</option>
                                    <option value="LRD">LRD - Dollar</option>
                                    <option value="LSL">LSL - Loti</option>
                                    <option value="LYD">LYD - Dinar</option>
                                    <option value="MAD">MAD - Dirham</option>
                                    <option value="MDL">MDL - Leu</option>
                                    <option value="MGA">MGA - Ariary</option>
                                    <option value="MKD">MKD - Denar</option>
                                    <option value="MMK">MMK - Kyat</option>
                                    <option value="MNT">MNT - Tugrik</option>
                                    <option value="MOP">MOP - Pataca</option>
                                    <option value="MRU">MRU - Ouguiya</option>
                                    <option value="MUR">MUR - Rupie</option>
                                    <option value="MVR">MVR - Rufiyaa</option>
                                    <option value="MWK">MWK - Kwacha</option>
                                    <option value="MXN">MXN - Peso</option>
                                    <option value="MYR">MYR - Ringgit</option>
                                    <option value="MZN">MZN - Metical</option>
                                    <option value="NAD">NAD - Dollar</option>
                                    <option value="NGN">NGN - Naira</option>
                                    <option value="NIO">NIO - Córdoba</option>
                                    <option value="NOK">NOK - Krone</option>
                                    <option value="NPR">NPR - Rupie</option>
                                    <option value="NZD">NZD - Dollar</option>
                                    <option value="OMR">OMR - Rial</option>
                                    <option value="PAB">PAB - Balboa</option>
                                    <option value="PEN">PEN - Sol</option>
                                    <option value="PGK">PGK - Kina</option>
                                    <option value="PHP">PHP - Peso</option>
                                    <option value="PKR">PKR - Rupie</option>
                                    <option value="PLN">PLN - Polnischer Złoty</option>
                                    <option value="PYG">PYG - Guaraní</option>
                                    <option value="QAR">QAR - Riyal</option>
                                    <option value="RON">RON - Leu</option>
                                    <option value="RSD">RSD - Dinar</option>
                                    <option value="RUB">RUB - Rubel</option>
                                    <option value="RWF">RWF - Franc</option>
                                    <option value="SAR">SAR - Riyal</option>
                                    <option value="SBD">SBD - Dollar</option>
                                    <option value="SCR">SCR - Rupie</option>
                                    <option value="SDG">SDG - Pfund</option>
                                    <option value="SEK">SEK - Krone</option>
                                    <option value="SGD">SGD - Dollar</option>
                                    <option value="SHP">SHP - Pfund</option>
                                    <option value="SLE">SLE - Leone</option>
                                    <option value="SOS">SOS - Schilling</option>
                                    <option value="SRD">SRD - Dollar</option>
                                    <option value="SSP">SSP - Pfund</option>
                                    <option value="STN">STN - Dobra</option>
                                    <option value="SYP">SYP - Pfund</option>
                                    <option value="SZL">SZL - Lilangeni</option>
                                    <option value="THB">THB - Baht</option>
                                    <option value="TJS">TJS - Somoni</option>
                                    <option value="TMT">TMT - Manat</option>
                                    <option value="TND">TND - Dinar</option>
                                    <option value="TOP">TOP - Paʻanga</option>
                                    <option value="TRY">TRY - Türkische Lira</option>
                                    <option value="TTD">TTD - Dollar</option>
                                    <option value="TVD">TVD - Dollar</option>
                                    <option value="TWD">TWD - Dollar</option>
                                    <option value="TZS">TZS - Schilling</option>
                                    <option value="UAH">UAH - Hrywnja</option>
                                    <option value="UGX">UGX - Schilling</option>
                                    <option value="UYU">UYU - Peso</option>
                                    <option value="UZS">UZS - Soʻm</option>
                                    <option value="VES">VES - Bolívar</option>
                                    <option value="VND">VND - Đồng</option>
                                    <option value="VUV">VUV - Vatu</option>
                                    <option value="WST">WST - Tala</option>
                                    <option value="XAF">XAF - CFA-Franc (BEAC)</option>
                                    <option value="XCD">XCD - Dollar</option>
                                    <option value="XOF">XOF - CFA-Franc (BCEAO)</option>
                                    <option value="XPF">XPF - CFP-Franc</option>
                                    <option value="YER">YER - Rial</option>
                                    <option value="ZAR">ZAR - Rand</option>
                                    <option value="ZMW">ZMW - Kwacha</option>
                                    <option value="ZWL">ZWL - Dollar</option>
                                </select>
                                <input 
                                    type="number" 
                                    id="from-amount" 
                                    name="from-amount"
                                    step="0.01"
                                    min="0"
                                    value="100"
                                    required
                                    class="flex-1 px-4 py-3 dark-input rounded-lg text-lg text-white font-semibold border-purple-500/50 focus:border-purple-400 focus:ring-purple-500"
                                    placeholder="0.00"
                                />
                            </div>
                        </div>

                        <!-- Swap Button -->
                        <div class="flex justify-center">
                            <button 
                                type="button"
                                id="swap-currencies-btn"
                                class="w-14 h-14 rounded-full bg-purple-600 hover:bg-purple-500 text-white font-bold text-2xl flex items-center justify-center transition-all duration-300 hover:scale-110 shadow-lg shadow-purple-500/50 hover:shadow-purple-400/70"
                                aria-label="Währungen tauschen"
                            >
                                ⇄
                            </button>
                        </div>

                        <!-- To Currency Section -->
                        <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 border border-purple-500/30">
                            <label for="to-currency" class="block text-sm font-medium text-purple-300 mb-3">
                                Zu
                            </label>
                            <div class="flex gap-3 items-center">
                                <select 
                                    id="to-currency" 
                                    name="to-currency"
                                    class="flex-1 px-4 py-3 dark-input rounded-lg text-lg border-purple-500/50 focus:border-purple-400 focus:ring-purple-500"
                                >
                                    <option value="EUR">EUR - Euro</option>
                                    <option value="USD" selected>USD - US-Dollar</option>
                                    <option value="AED">AED - UAE Dirham</option>
                                    <option value="AFN">AFN - Afghani</option>
                                    <option value="ALL">ALL - Lek</option>
                                    <option value="AMD">AMD - Dram</option>
                                    <option value="ANG">ANG - Netherlands Antillean Guilder</option>
                                    <option value="AOA">AOA - Kwanza</option>
                                    <option value="ARS">ARS - Peso</option>
                                    <option value="AUD">AUD - Australian Dollar</option>
                                    <option value="AWG">AWG - Florin</option>
                                    <option value="AZN">AZN - Manat</option>
                                    <option value="BAM">BAM - Convertible Mark</option>
                                    <option value="BBD">BBD - Dollar</option>
                                    <option value="BDT">BDT - Taka</option>
                                    <option value="BGN">BGN - Lev</option>
                                    <option value="BHD">BHD - Dinar</option>
                                    <option value="BIF">BIF - Franc</option>
                                    <option value="BMD">BMD - Dollar</option>
                                    <option value="BND">BND - Dollar</option>
                                    <option value="BOB">BOB - Boliviano</option>
                                    <option value="BRL">BRL - Real</option>
                                    <option value="BSD">BSD - Dollar</option>
                                    <option value="BTN">BTN - Ngultrum</option>
                                    <option value="BWP">BWP - Pula</option>
                                    <option value="BYN">BYN - Rubel</option>
                                    <option value="BZD">BZD - Dollar</option>
                                    <option value="CAD">CAD - Kanadischer Dollar</option>
                                    <option value="CDF">CDF - Franc</option>
                                    <option value="CHF">CHF - Schweizer Franken</option>
                                    <option value="CLP">CLP - Peso</option>
                                    <option value="CNY">CNY - Renminbi</option>
                                    <option value="COP">COP - Peso</option>
                                    <option value="CRC">CRC - Colón</option>
                                    <option value="CUP">CUP - Peso</option>
                                    <option value="CVE">CVE - Escudo</option>
                                    <option value="CZK">CZK - Krone</option>
                                    <option value="DJF">DJF - Franc</option>
                                    <option value="DKK">DKK - Krone</option>
                                    <option value="DOP">DOP - Peso</option>
                                    <option value="DZD">DZD - Dinar</option>
                                    <option value="EGP">EGP - Pfund</option>
                                    <option value="ERN">ERN - Nakfa</option>
                                    <option value="ETB">ETB - Birr</option>
                                    <option value="FJD">FJD - Dollar</option>
                                    <option value="FKP">FKP - Pfund</option>
                                    <option value="GBP">GBP - Britisches Pfund</option>
                                    <option value="GEL">GEL - Lari</option>
                                    <option value="GHS">GHS - Cedi</option>
                                    <option value="GIP">GIP - Pfund</option>
                                    <option value="GMD">GMD - Dalasi</option>
                                    <option value="GNF">GNF - Franc</option>
                                    <option value="GTQ">GTQ - Quetzal</option>
                                    <option value="GYD">GYD - Dollar</option>
                                    <option value="HKD">HKD - Dollar</option>
                                    <option value="HNL">HNL - Lempira</option>
                                    <option value="HRK">HRK - Kuna</option>
                                    <option value="HTG">HTG - Gourde</option>
                                    <option value="HUF">HUF - Forint</option>
                                    <option value="IDR">IDR - Rupiah</option>
                                    <option value="ILS">ILS - Schekel</option>
                                    <option value="INR">INR - Rupie</option>
                                    <option value="IQD">IQD - Dinar</option>
                                    <option value="IRR">IRR - Rial</option>
                                    <option value="ISK">ISK - Krone</option>
                                    <option value="JMD">JMD - Dollar</option>
                                    <option value="JOD">JOD - Dinar</option>
                                    <option value="JPY">JPY - Japanischer Yen</option>
                                    <option value="KES">KES - Schilling</option>
                                    <option value="KGS">KGS - Som</option>
                                    <option value="KHR">KHR - Riel</option>
                                    <option value="KMF">KMF - Franc</option>
                                    <option value="KPW">KPW - Won</option>
                                    <option value="KRW">KRW - Won</option>
                                    <option value="KWD">KWD - Dinar</option>
                                    <option value="KYD">KYD - Dollar</option>
                                    <option value="KZT">KZT - Tenge</option>
                                    <option value="LAK">LAK - Kip</option>
                                    <option value="LBP">LBP - Pfund</option>
                                    <option value="LKR">LKR - Rupie</option>
                                    <option value="LRD">LRD - Dollar</option>
                                    <option value="LSL">LSL - Loti</option>
                                    <option value="LYD">LYD - Dinar</option>
                                    <option value="MAD">MAD - Dirham</option>
                                    <option value="MDL">MDL - Leu</option>
                                    <option value="MGA">MGA - Ariary</option>
                                    <option value="MKD">MKD - Denar</option>
                                    <option value="MMK">MMK - Kyat</option>
                                    <option value="MNT">MNT - Tugrik</option>
                                    <option value="MOP">MOP - Pataca</option>
                                    <option value="MRU">MRU - Ouguiya</option>
                                    <option value="MUR">MUR - Rupie</option>
                                    <option value="MVR">MVR - Rufiyaa</option>
                                    <option value="MWK">MWK - Kwacha</option>
                                    <option value="MXN">MXN - Peso</option>
                                    <option value="MYR">MYR - Ringgit</option>
                                    <option value="MZN">MZN - Metical</option>
                                    <option value="NAD">NAD - Dollar</option>
                                    <option value="NGN">NGN - Naira</option>
                                    <option value="NIO">NIO - Córdoba</option>
                                    <option value="NOK">NOK - Krone</option>
                                    <option value="NPR">NPR - Rupie</option>
                                    <option value="NZD">NZD - Dollar</option>
                                    <option value="OMR">OMR - Rial</option>
                                    <option value="PAB">PAB - Balboa</option>
                                    <option value="PEN">PEN - Sol</option>
                                    <option value="PGK">PGK - Kina</option>
                                    <option value="PHP">PHP - Peso</option>
                                    <option value="PKR">PKR - Rupie</option>
                                    <option value="PLN">PLN - Polnischer Złoty</option>
                                    <option value="PYG">PYG - Guaraní</option>
                                    <option value="QAR">QAR - Riyal</option>
                                    <option value="RON">RON - Leu</option>
                                    <option value="RSD">RSD - Dinar</option>
                                    <option value="RUB">RUB - Rubel</option>
                                    <option value="RWF">RWF - Franc</option>
                                    <option value="SAR">SAR - Riyal</option>
                                    <option value="SBD">SBD - Dollar</option>
                                    <option value="SCR">SCR - Rupie</option>
                                    <option value="SDG">SDG - Pfund</option>
                                    <option value="SEK">SEK - Krone</option>
                                    <option value="SGD">SGD - Dollar</option>
                                    <option value="SHP">SHP - Pfund</option>
                                    <option value="SLE">SLE - Leone</option>
                                    <option value="SOS">SOS - Schilling</option>
                                    <option value="SRD">SRD - Dollar</option>
                                    <option value="SSP">SSP - Pfund</option>
                                    <option value="STN">STN - Dobra</option>
                                    <option value="SYP">SYP - Pfund</option>
                                    <option value="SZL">SZL - Lilangeni</option>
                                    <option value="THB">THB - Baht</option>
                                    <option value="TJS">TJS - Somoni</option>
                                    <option value="TMT">TMT - Manat</option>
                                    <option value="TND">TND - Dinar</option>
                                    <option value="TOP">TOP - Paʻanga</option>
                                    <option value="TRY">TRY - Türkische Lira</option>
                                    <option value="TTD">TTD - Dollar</option>
                                    <option value="TVD">TVD - Dollar</option>
                                    <option value="TWD">TWD - Dollar</option>
                                    <option value="TZS">TZS - Schilling</option>
                                    <option value="UAH">UAH - Hrywnja</option>
                                    <option value="UGX">UGX - Schilling</option>
                                    <option value="UYU">UYU - Peso</option>
                                    <option value="UZS">UZS - Soʻm</option>
                                    <option value="VES">VES - Bolívar</option>
                                    <option value="VND">VND - Đồng</option>
                                    <option value="VUV">VUV - Vatu</option>
                                    <option value="WST">WST - Tala</option>
                                    <option value="XAF">XAF - CFA-Franc (BEAC)</option>
                                    <option value="XCD">XCD - Dollar</option>
                                    <option value="XOF">XOF - CFA-Franc (BCEAO)</option>
                                    <option value="XPF">XPF - CFP-Franc</option>
                                    <option value="YER">YER - Rial</option>
                                    <option value="ZAR">ZAR - Rand</option>
                                    <option value="ZMW">ZMW - Kwacha</option>
                                    <option value="ZWL">ZWL - Dollar</option>
                                </select>
                                <input 
                                    type="text" 
                                    id="to-amount" 
                                    name="to-amount"
                                    readonly
                                    class="flex-1 px-4 py-3 dark-input rounded-lg text-lg text-purple-300 font-bold border-purple-500/50 bg-gray-800/50"
                                    placeholder="0.00"
                                />
                            </div>
                        </div>

                        <!-- Exchange Rate Display -->
                        <div id="exchange-rate-display" class="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30 text-center">
                            <p class="text-sm text-purple-200">
                                <span id="rate-text" class="font-medium">Aktueller Kurs wird berechnet...</span>
                            </p>
                        </div>

                        <!-- Historical Chart -->
                        <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 border border-purple-500/30">
                            <h3 class="text-lg font-semibold text-purple-300 mb-3 text-center">1-Jahres-Kursverlauf</h3>
                            <canvas id="currency-history-chart"></canvas>
                        </div>

                        <!-- Calculate Button -->
                        <button 
                            type="submit"
                            id="calculate-waehrung-btn"
                            class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative bg-purple-600 hover:bg-purple-500"
                        >
                            Aktualisieren
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Inflationsrechner (Fully Functional) -->
        <div id="inflation-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Inflationsrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie die Auswirkungen der Inflation auf Ihr Geld. Zukünftiger Preis, Kaufkraftverlust und Preissteigerung für beliebige Zeiträume. Mit historischen Inflationsdaten für Deutschland oder manueller Eingabe. Ideal für Finanzplanung, Altersvorsorge und Kaufkraftvergleiche. Visualisierung der Kaufkraftentwicklung inklusive.</p>
                
                <form id="inflation-form" class="space-y-6">
                    <div>
                        <label for="initial_amount_euro" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Geldbetrag (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der Geldbetrag, dessen zukünftiger Wert berechnet werden soll.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="initial_amount_euro" 
                            name="initial_amount_euro"
                            step="100"
                            min="1"
                            value="10000"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="10000"
                        />
                    </div>

                    <div>
                        <label for="duration_years" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Laufzeit (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der Zeitraum in Jahren, für den die Inflation berechnet werden soll.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="duration_years" 
                            name="duration_years"
                            step="1"
                            min="1"
                            max="100"
                            value="10"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="10"
                        />
                    </div>

                    <!-- Inflation Rate Input Method Toggle -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-3 flex items-center">
                            Inflationsrate
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    <p class="mb-1"><strong>Manuell:</strong> Geben Sie eine Inflationsrate ein</p>
                                    <p><strong>Historisch:</strong> Nutzen Sie die durchschnittliche Inflationsrate aus historischen Daten für einen Zeitraum</p>
                                </div>
                            </span>
                        </label>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                            <button 
                                type="button"
                                id="mode-manual"
                                class="mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-purple-600 text-white glow-purple"
                                onclick="setInflationMode('manual')"
                            >
                                Manuell
                            </button>
                            <button 
                                type="button"
                                id="mode-historical"
                                class="mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-gray-700 text-slate-300 hover:bg-gray-600"
                                onclick="setInflationMode('historical')"
                            >
                                Historisch
                            </button>
                        </div>

                        <!-- Manual Input -->
                        <div id="manual-inflation-container">
                            <input 
                                type="number" 
                                id="annual_inflation_rate_percent" 
                                name="annual_inflation_rate_percent"
                                step="0.1"
                                min="0"
                                max="50"
                                value="2.5"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="2.5"
                            />
                            <p class="text-xs text-slate-400 mt-1">Durchschnittliche jährliche Inflationsrate in %</p>
                        </div>

                        <!-- Historical Input -->
                        <div id="historical-inflation-container" class="hidden">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="start_year" class="block text-sm font-medium text-slate-300 mb-2">Startjahr</label>
                                    <select 
                                        id="start_year" 
                                        name="start_year"
                                        class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                    >
                                        <!-- Years will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div>
                                    <label for="end_year" class="block text-sm font-medium text-slate-300 mb-2">Endjahr</label>
                                    <select 
                                        id="end_year" 
                                        name="end_year"
                                        class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                    >
                                        <!-- Years will be populated by JavaScript -->
                                    </select>
                                </div>
                            </div>
                            <div id="historical-rate-display" class="mt-3 p-3 bg-purple-900/30 rounded-lg border border-purple-500/30">
                                <p class="text-sm text-slate-300">Durchschnittliche Inflationsrate: <span id="avg-rate-display" class="font-semibold text-purple-300">--</span>%</p>
                            </div>
                        </div>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-inflation-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative"
                    >
                        Berechnen
                    </button>
                </form>

                <!-- Results Section -->
                <div id="inflation-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-purple backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-purple">Ergebnis</h3>
                        
                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30">
                                <p class="text-sm text-slate-400 mb-1">Zukünftiger Preis</p>
                                <p id="result-future-price" class="text-2xl font-bold text-purple-400 text-glow-purple"></p>
                                <p class="text-xs text-slate-400 mt-2">Was der Betrag in der Zukunft kosten wird</p>
                            </div>
                            <div class="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30">
                                <p class="text-sm text-slate-400 mb-1">Zukünftige Kaufkraft</p>
                                <p id="result-future-purchasing-power" class="text-2xl font-bold text-yellow-400"></p>
                                <p class="text-xs text-slate-400 mt-2">Was der Betrag in der Zukunft wert ist</p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <p class="text-sm text-slate-400 mb-1">Preissteigerung</p>
                                <p id="result-price-increase" class="text-xl font-semibold text-red-400"></p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <p class="text-sm text-slate-400 mb-1">Kaufkraftverlust</p>
                                <p id="result-purchasing-power-loss" class="text-xl font-semibold text-red-400"></p>
                            </div>
                        </div>

                        <!-- Chart -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Kaufkraft-Entwicklung über die Zeit</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <canvas id="inflation-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aktien Rendite (Fully Functional) -->
        <div id="aktien-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Aktien Rendite / ETF-Sparplan</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Simulieren Sie Ihre ETF-Sparplan-Rendite mit präziser Steuerberechnung. Berechnet Endkapital, Gesamteinzahlungen, Netto-Gewinn und Steuern (Abgeltungssteuer, Soli, Kirchensteuer). Berücksichtigt Sparer-Pauschbetrag und Kirchensteuerpflicht. Ideal für langfristige Geldanlage, Altersvorsorge und Vermögensaufbau. Mit jährlicher Aufschlüsselung und CAGR-Berechnung.</p>
                
                <form id="aktien-form" class="space-y-6">
                    <div>
                        <label for="aktien_initial_investment" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Anfangsinvestition (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Einmalige Anfangsinvestition (z.B. 5.000 €). Kann 0 sein, wenn Sie nur monatlich sparen.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="aktien_initial_investment" 
                            name="aktien_initial_investment"
                            step="100"
                            min="0"
                            value="5000"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="5000"
                        />
                    </div>

                    <div>
                        <label for="aktien_monthly_rate" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Monatliche Sparrate (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Regelmäßige monatliche Einzahlung für Ihren ETF-Sparplan (z.B. 200 €).
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="aktien_monthly_rate" 
                            name="aktien_monthly_rate"
                            step="10"
                            min="0"
                            value="200"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="200"
                        />
                    </div>

                    <div>
                        <label for="aktien_expected_return_pa" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Erwartete jährliche Rendite (%)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Erwartete durchschnittliche jährliche Rendite vor Steuern (z.B. 7% für breit gestreute ETFs). Historisch: MSCI World ~7-8% p.a.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="aktien_expected_return_pa" 
                            name="aktien_expected_return_pa"
                            step="0.1"
                            min="0"
                            max="50"
                            value="7.0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="7.0"
                        />
                    </div>

                    <div>
                        <label for="aktien_duration_years" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Laufzeit (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Gesamtlaufzeit des Investments in Jahren.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="aktien_duration_years" 
                            name="aktien_duration_years"
                            step="1"
                            min="1"
                            max="100"
                            value="20"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="20"
                        />
                    </div>

                    <div>
                        <label for="aktien_sparer_pauschbetrag_used" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Bereits genutzter Sparer-Pauschbetrag (€)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-purple-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-gray-900 border border-purple-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Der bereits genutzte Sparer-Pauschbetrag (max. 1.000€ für Alleinstehende). Zinserträge bis zu diesem Betrag sind steuerfrei. Geben Sie an, wie viel bereits verbraucht wurde.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="aktien_sparer_pauschbetrag_used" 
                            name="aktien_sparer_pauschbetrag_used"
                            step="0.01"
                            min="0"
                            max="1000"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.00"
                        />
                    </div>

                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="aktien_church_member" 
                            name="aktien_church_member"
                            class="w-5 h-5 text-purple-500 border-gray-600 rounded focus:ring-purple-500 bg-gray-900"
                        />
                        <label for="aktien_church_member" class="ml-2 text-sm font-medium text-slate-300">
                            Kirchensteuerpflichtig (für Abgeltungssteuer)
                        </label>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-aktien-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative bg-purple-600 hover:bg-purple-500"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <!-- Results Section -->
                <div id="aktien-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-purple backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-purple">Ergebnis</h3>
                        
                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30">
                                <p class="text-sm text-slate-400 mb-1">Endkapital (Netto)</p>
                                <p id="result-aktien-final-capital" class="text-2xl font-bold text-purple-400 text-glow-purple"></p>
                            </div>
                            <div class="bg-purple-900/30 rounded-lg p-4 border border-purple-500/30">
                                <p class="text-sm text-slate-400 mb-1">Gesamte Einzahlungen</p>
                                <p id="result-aktien-total-deposits" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <p class="text-sm text-slate-400 mb-1">Gesamter Gewinn (Netto)</p>
                                <p id="result-aktien-total-gain" class="text-xl font-semibold text-green-400"></p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <p class="text-sm text-slate-400 mb-1">Steuern gezahlt</p>
                                <p id="result-aktien-total-tax" class="text-xl font-semibold text-red-400"></p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <p class="text-sm text-slate-400 mb-1">Durchschnittliche Rendite (CAGR)</p>
                                <p id="result-aktien-cagr" class="text-xl font-semibold text-purple-300"></p>
                            </div>
                        </div>

                        <!-- Annual Breakdown -->
                        <div class="border-t border-gray-700 pt-4 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Jährliche Aufschlüsselung</h4>
                            <div id="aktien-breakdown" class="space-y-2 max-h-96 overflow-y-auto">
                                <!-- Annual breakdown will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Chart -->
                        <div class="border-t border-gray-700 pt-6 mt-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-4 text-center">Kapitalentwicklung über die Zeit</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <canvas id="aktien-growth-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BMI Rechner (Fully Functional) -->
        <div id="bmi-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">BMI Rechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Ihren Body Mass Index (BMI) mit alters- und geschlechtsspezifischer Bewertung. WHO-Klassifikation, Ideal-BMI nach NRC-Tabelle, persönliche Gesundheitsbewertung und visueller BMI-Tacho. Berücksichtigt Alter, Geschlecht und individuelle Körperwerte. Ideal für Gewichtsmanagement, Gesundheitscheck und Fitnessplanung.</p>
                
                <form id="bmi-form" class="space-y-6">
                    <div>
                        <label for="bmi_weight_kg" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Körpergewicht (kg)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Ihr aktuelles Körpergewicht in Kilogramm.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="bmi_weight_kg" 
                            name="bmi_weight_kg"
                            step="0.1"
                            min="20"
                            max="300"
                            value="75"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="75.0"
                        />
                    </div>

                    <div>
                        <label for="bmi_height_cm" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Körpergröße (cm)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Ihre Körpergröße in Zentimetern.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="bmi_height_cm" 
                            name="bmi_height_cm"
                            step="0.1"
                            min="100"
                            max="250"
                            value="175"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="175.0"
                        />
                    </div>

                    <div>
                        <label for="bmi_age" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Alter (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Ihr Alter in Jahren. Wichtig für die altersabhängige Ideal-BMI-Bewertung.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="bmi_age" 
                            name="bmi_age"
                            step="1"
                            min="1"
                            max="120"
                            value="30"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="30"
                        />
                    </div>

                    <div>
                        <label for="bmi_gender" class="block text-sm font-medium text-slate-300 mb-2">
                            Geschlecht
                        </label>
                        <select 
                            id="bmi_gender" 
                            name="bmi_gender"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="male">Männlich</option>
                            <option value="female">Weiblich</option>
                        </select>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-bmi-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative bg-red-600 hover:bg-red-500"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <!-- Results Section -->
                <div id="bmi-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-red backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-red">Ergebnis</h3>
                        
                        <!-- BMI Value Display -->
                        <div class="text-center mb-6">
                            <p class="text-sm text-slate-400 mb-2">Ihr Body Mass Index</p>
                            <p id="result-bmi-value" class="text-5xl font-bold text-red-400 text-glow-red mb-2"></p>
                            <div id="result-bmi-badge" class="inline-block px-4 py-2 rounded-full text-sm font-semibold"></div>
                        </div>

                        <!-- Visual BMI Gauge -->
                        <div class="mb-6">
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <div class="relative h-12 mb-2">
                                    <!-- Background color zones -->
                                    <div class="absolute inset-0 flex">
                                        <div class="flex-1 bg-blue-600/30" style="width: 14%"></div>
                                        <div class="flex-1 bg-green-600/30" style="width: 26%"></div>
                                        <div class="flex-1 bg-orange-600/30" style="width: 20%"></div>
                                        <div class="flex-1 bg-red-600/30" style="width: 20%"></div>
                                        <div class="flex-1 bg-red-800/30" style="width: 20%"></div>
                                    </div>
                                    <!-- BMI Scale Labels -->
                                    <div class="absolute inset-0 flex justify-between items-center px-1">
                                        <span class="text-xs text-slate-400">15</span>
                                        <span class="text-xs text-slate-400">18.5</span>
                                        <span class="text-xs text-slate-400">25</span>
                                        <span class="text-xs text-slate-400">30</span>
                                        <span class="text-xs text-slate-400">35</span>
                                        <span class="text-xs text-slate-400">40</span>
                                    </div>
                                    <!-- BMI Marker Arrow -->
                                    <div id="bmi-marker" class="absolute top-0 bottom-0 w-0.5 bg-white transform -translate-x-1/2 transition-all duration-500" style="left: 0%">
                                        <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent border-b-white"></div>
                                    </div>
                                </div>
                                <div class="flex justify-between text-xs text-slate-400 mt-1">
                                    <span>Untergewicht</span>
                                    <span>Normal</span>
                                    <span>Übergewicht</span>
                                    <span>Adipositas</span>
                                </div>
                            </div>
                        </div>

                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                <p class="text-sm text-slate-400 mb-1">WHO-Kategorie</p>
                                <p id="result-bmi-who-category" class="text-xl font-semibold text-white"></p>
                            </div>
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                <p class="text-sm text-slate-400 mb-1">Ideal-BMI (Altersgruppe)</p>
                                <p id="result-bmi-ideal-range" class="text-xl font-semibold text-red-300"></p>
                            </div>
                        </div>

                        <!-- Health Feedback -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <h4 class="text-lg font-semibold text-slate-300 mb-2">Gesundheitsbewertung</h4>
                            <p id="result-bmi-feedback" class="text-slate-300 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kalorienrechner (Fully Functional) -->
        <div id="kalorien-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Kalorienrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Ihren täglichen Kalorienbedarf mit der präzisen Mifflin-St Jeor Formel. Grundumsatz (BMR), Gesamtumsatz (TDEE) und Zielkalorien für Abnehmen, Gewicht halten oder Zunehmen. DGE-Standard Makronährstoffe (Kohlenhydrate 50%, Proteine 15%, Fette 35%) mit Mindestprotein-Check. Ideal für Diätplanung, Muskelaufbau und gesunde Ernährung.</p>
                
                <form id="kalorien-form" class="space-y-6">
                    <div>
                        <label for="kalorien_gender" class="block text-sm font-medium text-slate-300 mb-2">
                            Geschlecht
                        </label>
                        <select 
                            id="kalorien_gender" 
                            name="kalorien_gender"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="male">Männlich</option>
                            <option value="female">Weiblich</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="kalorien_weight_kg" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Körpergewicht (kg)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-red-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Ihr aktuelles Körpergewicht in Kilogramm.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="kalorien_weight_kg" 
                                name="kalorien_weight_kg"
                                step="0.1"
                                min="20"
                                max="300"
                                value="75"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="75.0"
                            />
                        </div>

                        <div>
                            <label for="kalorien_height_cm" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Körpergröße (cm)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-red-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Ihre Körpergröße in Zentimetern.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="kalorien_height_cm" 
                                name="kalorien_height_cm"
                                step="0.1"
                                min="100"
                                max="250"
                                value="175"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="175.0"
                            />
                        </div>
                    </div>

                    <div>
                        <label for="kalorien_age" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Alter (Jahre)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Ihr Alter in Jahren.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="kalorien_age" 
                            name="kalorien_age"
                            step="1"
                            min="1"
                            max="120"
                            value="30"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="30"
                        />
                    </div>

                    <div>
                        <label for="kalorien_pal" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Aktivitätslevel (PAL - DGE Standard)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    <p class="mb-1"><strong>0.95:</strong> Schlafen</p>
                                    <p class="mb-1"><strong>1.2:</strong> Nur sitzend/liegend</p>
                                    <p class="mb-1"><strong>1.4-1.5:</strong> Sitzend, kaum Bewegung (Büro)</p>
                                    <p class="mb-1"><strong>1.6-1.7:</strong> Sitzend, zeitweilig stehend/gehend</p>
                                    <p class="mb-1"><strong>1.8-1.9:</strong> Überwiegend stehend/gehend</p>
                                    <p><strong>2.0-2.4:</strong> Körperlich anstrengende Arbeit</p>
                                </div>
                            </span>
                        </label>
                        <select 
                            id="kalorien_pal" 
                            name="kalorien_pal"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="0.95">0.95 - Schlafen</option>
                            <option value="1.2">1.2 - Nur sitzend/liegend (alt, gebrechlich)</option>
                            <option value="1.45" selected>1.45 - Sitzend, kaum Bewegung (Bürojob)</option>
                            <option value="1.65">1.65 - Sitzend, zeitweilig stehend/gehend (Studenten, Labor)</option>
                            <option value="1.85">1.85 - Überwiegend stehend/gehend (Verkäufer, Handwerker)</option>
                            <option value="2.2">2.2 - Körperlich anstrengende Arbeit (Bauarbeiter, Landwirte)</option>
                        </select>
                    </div>

                    <div>
                        <label for="kalorien_goal" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Ziel
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    <p class="mb-1"><strong>Gewicht halten:</strong> Keine Anpassung</p>
                                    <p class="mb-1"><strong>Abnehmen:</strong> -500 kcal (gesundes Defizit)</p>
                                    <p><strong>Zunehmen:</strong> +500 kcal (gesunder Überschuss)</p>
                                </div>
                            </span>
                        </label>
                        <select 
                            id="kalorien_goal" 
                            name="kalorien_goal"
                            required
                            class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                        >
                            <option value="maintain" selected>Gewicht halten</option>
                            <option value="lose">Abnehmen (-500 kcal)</option>
                            <option value="gain">Zunehmen (+500 kcal)</option>
                        </select>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-kalorien-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative bg-red-600 hover:bg-red-500"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <!-- Results Section -->
                <div id="kalorien-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-red backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-red">Ergebnis</h3>
                        
                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                <p class="text-sm text-slate-400 mb-1">Grundumsatz (BMR)</p>
                                <p id="result-kalorien-bmr" class="text-2xl font-bold text-red-400 text-glow-red"></p>
                            </div>
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                <p class="text-sm text-slate-400 mb-1">Gesamtumsatz (TDEE)</p>
                                <p id="result-kalorien-tdee" class="text-2xl font-bold text-white"></p>
                            </div>
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/30">
                                <p class="text-sm text-slate-400 mb-1">Zielkalorien</p>
                                <p id="result-kalorien-target" class="text-2xl font-bold text-red-300"></p>
                            </div>
                        </div>

                        <!-- Visual Stacked Bar Chart -->
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3 text-center">Energieumsatz-Aufschlüsselung</h4>
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <div class="relative h-16 mb-2">
                                    <!-- BMR Base (Grundumsatz) -->
                                    <div id="bar-bmr" class="absolute bottom-0 left-0 bg-red-600 rounded-t transition-all duration-500 flex items-center justify-center">
                                        <span id="bar-bmr-label" class="text-xs font-semibold text-white px-2"></span>
                                    </div>
                                    <!-- Activity Addition (Leistungsumsatz) -->
                                    <div id="bar-activity" class="absolute bottom-0 bg-orange-500 rounded-t transition-all duration-500 flex items-center justify-center">
                                        <span id="bar-activity-label" class="text-xs font-semibold text-white px-2"></span>
                                    </div>
                                </div>
                                <div class="flex justify-between text-xs text-slate-400 mt-2">
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 bg-red-600 rounded"></div>
                                        <span>Grundumsatz</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 bg-orange-500 rounded"></div>
                                        <span>Leistungsumsatz</span>
                                    </div>
                                    <div>
                                        <span id="pal-description-text" class="text-slate-300"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Macronutrients -->
                        <div class="border-t border-gray-700 pt-4 mt-4">
                            <h4 class="text-lg font-semibold text-slate-300 mb-3">Makronährstoffe (Tagesbedarf)</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <p class="text-sm text-slate-400 mb-1">Kohlenhydrate (50%)</p>
                                    <p id="result-kalorien-carbs" class="text-2xl font-bold text-blue-400"></p>
                                    <p class="text-xs text-slate-400 mt-1">1g = 4.1 kcal</p>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <p class="text-sm text-slate-400 mb-1">Proteine (15%)</p>
                                    <p id="result-kalorien-protein" class="text-2xl font-bold text-green-400"></p>
                                    <p class="text-xs text-slate-400 mt-1">1g = 4.1 kcal</p>
                                </div>
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <p class="text-sm text-slate-400 mb-1">Fette (35%)</p>
                                    <p id="result-kalorien-fat" class="text-2xl font-bold text-yellow-400"></p>
                                    <p class="text-xs text-slate-400 mt-1">1g = 9.3 kcal</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Promillerechner (Fully Functional) -->
        <div id="promille-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Promillerechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Ihre Blutalkoholkonzentration (BAC) mit der Widmark-Formel. Berücksichtigt Geschlecht, Gewicht, Getränkeart, Alkoholgehalt und Zeit. Resorptionsdefizit 15%, Abbau 0,15‰ pro Stunde. Rechtliche Warnungen für Auto- und Fahrradfahren nach deutschem Recht 2025. Zeit bis zur Nüchternheit und Promillewert-Anzeige inklusive.</p>
                
                <form id="promille-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="promille_gender" class="block text-sm font-medium text-slate-300 mb-2">
                                Geschlecht
                            </label>
                            <select 
                                id="promille_gender" 
                                name="promille_gender"
                                required
                                class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                            >
                                <option value="male">Männlich</option>
                                <option value="female">Weiblich</option>
                            </select>
                        </div>

                        <div>
                            <label for="promille_weight_kg" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                                Körpergewicht (kg)
                                <span class="ml-2 relative group cursor-help">
                                    <span class="text-red-400 font-bold text-base">(i)</span>
                                    <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                        Ihr Körpergewicht in Kilogramm.
                                    </div>
                                </span>
                            </label>
                            <input 
                                type="number" 
                                id="promille_weight_kg" 
                                name="promille_weight_kg"
                                step="0.1"
                                min="40"
                                max="200"
                                value="75"
                                required
                                class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                placeholder="75.0"
                            />
                        </div>
                    </div>

                    <div>
                        <label for="promille_time_hours" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Zeit seit Trinkbeginn (Stunden)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-red-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-red-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Wie viele Stunden sind seit dem ersten Getränk vergangen? Alkohol wird mit 0,15‰ pro Stunde abgebaut.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="number" 
                            id="promille_time_hours" 
                            name="promille_time_hours"
                            step="0.1"
                            min="0"
                            max="24"
                            value="0"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            placeholder="0.0"
                        />
                    </div>

                    <!-- Drink Presets -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-3">Schnellauswahl (Getränk hinzufügen)</label>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                            <button 
                                type="button"
                                onclick="addDrinkPreset({volume_ml: 330, alcohol_vol_percent: 4.8, name: 'Bier (0,33l)'})"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm touch-target transition-all"
                            >
                                Bier (0,33l)
                            </button>
                            <button 
                                type="button"
                                onclick="addDrinkPreset({volume_ml: 500, alcohol_vol_percent: 4.8, name: 'Bier (0,5l)'})"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm touch-target transition-all"
                            >
                                Bier (0,5l)
                            </button>
                            <button 
                                type="button"
                                onclick="addDrinkPreset({volume_ml: 200, alcohol_vol_percent: 12.5, name: 'Wein (0,2l)'})"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm touch-target transition-all"
                            >
                                Wein (0,2l)
                            </button>
                            <button 
                                type="button"
                                onclick="addDrinkPreset({volume_ml: 20, alcohol_vol_percent: 40, name: 'Schnaps (2cl)'})"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm touch-target transition-all"
                            >
                                Schnaps (2cl)
                            </button>
                            <button 
                                type="button"
                                onclick="addDrinkPreset({volume_ml: 200, alcohol_vol_percent: 15, name: 'Cocktail'})"
                                class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm touch-target transition-all"
                            >
                                Cocktail
                            </button>
                        </div>
                    </div>

                    <!-- Custom Drink Input -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-3">Eigenes Getränk hinzufügen</label>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <div>
                                <label for="custom_volume_ml" class="block text-xs text-slate-400 mb-1">Volumen (ml)</label>
                                <input 
                                    type="number" 
                                    id="custom_volume_ml"
                                    step="10"
                                    min="0"
                                    value="330"
                                    class="w-full px-3 py-2 dark-input rounded-lg text-sm"
                                    placeholder="330"
                                />
                            </div>
                            <div>
                                <label for="custom_alcohol_percent" class="block text-xs text-slate-400 mb-1">Alkohol (%)</label>
                                <input 
                                    type="number" 
                                    id="custom_alcohol_percent"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value="4.8"
                                    class="w-full px-3 py-2 dark-input rounded-lg text-sm"
                                    placeholder="4.8"
                                />
                            </div>
                            <div>
                                <label for="custom_quantity" class="block text-xs text-slate-400 mb-1">Anzahl</label>
                                <input 
                                    type="number" 
                                    id="custom_quantity"
                                    step="1"
                                    min="1"
                                    value="1"
                                    class="w-full px-3 py-2 dark-input rounded-lg text-sm"
                                    placeholder="1"
                                />
                            </div>
                            <div class="flex items-end">
                                <button 
                                    type="button"
                                    onclick="addCustomDrink()"
                                    class="w-full px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg text-sm touch-target transition-all"
                                >
                                    Hinzufügen
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Drink List -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-3">Getränkeliste</label>
                        <div id="drink-list" class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-4 min-h-20 space-y-2">
                            <p class="text-slate-400 text-sm text-center py-4">Keine Getränke hinzugefügt. Verwenden Sie die Schnellauswahl oder fügen Sie ein eigenes Getränk hinzu.</p>
                        </div>
                    </div>

                    <button 
                        type="submit"
                        id="calculate-promille-btn"
                        class="w-full btn-calculate text-white font-semibold py-3 px-6 rounded-lg touch-target text-lg relative bg-red-600 hover:bg-red-500"
                    >
                        <span class="relative z-10">Berechnen</span>
                    </button>
                </form>

                <!-- Results Section -->
                <div id="promille-result" class="mt-8 hidden">
                    <div class="bg-gray-900/80 rounded-lg p-6 space-y-4 glow-red backdrop-blur-sm result-fade-in">
                        <h3 class="text-xl font-semibold text-white mb-4 text-glow-red">Ergebnis</h3>
                        
                        <!-- BAC Value Display -->
                        <div class="text-center mb-6">
                            <p class="text-sm text-slate-400 mb-2">Aktueller Blutalkoholgehalt</p>
                            <p id="result-promille-value" class="text-5xl font-bold text-red-400 text-glow-red mb-2"></p>
                            <p id="result-time-to-sober" class="text-lg text-slate-300"></p>
                        </div>

                        <!-- Legal Warnings -->
                        <div id="legal-warnings" class="space-y-3 mb-4">
                            <!-- Warnings will be inserted here -->
                        </div>

                        <!-- Legal Status -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div id="legal-status-auto" class="bg-slate-800/50 rounded-lg p-4 border-2 border-red-500/50">
                                <p class="text-sm text-slate-400 mb-1">Auto fahren</p>
                                <p id="legal-status-auto-text" class="text-lg font-semibold text-red-400"></p>
                            </div>
                            <div id="legal-status-bike" class="bg-slate-800/50 rounded-lg p-4 border-2 border-orange-500/50">
                                <p class="text-sm text-slate-400 mb-1">Fahrrad fahren</p>
                                <p id="legal-status-bike-text" class="text-lg font-semibold text-orange-400"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Einheiten-Umrechner (Fully Functional) -->
        <div id="units-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Einheiten-Umrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Umrechnen Sie alle gängigen Einheiten: Länge (Meter, Fuß, Zoll, Meile), Gewicht (Kilogramm, Pfund, Unze), Volumen (Liter, Gallone, Flüssigunze), Temperatur (Celsius, Fahrenheit, Kelvin), Druck (Bar, PSI, Pascal), Energie (Joule, Kilowattstunde, Kalorie), Leistung, Zeit, Winkel, Kraft, Drehmoment, Frequenz und Datenübertragungsrate. Schnellumrechnungen und Formel-Anzeige inklusive.</p>
                
                <!-- Category Selector -->
                <div class="mb-6">
                    <label for="units-category" class="block text-sm font-medium text-slate-300 mb-2">
                        Kategorie
                    </label>
                    <select 
                        id="units-category" 
                        name="units-category"
                        class="w-full px-4 py-3 dark-select rounded-lg text-lg"
                        onchange="updateUnitsForCategory()"
                    >
                        <option value="length">Länge</option>
                        <option value="weight">Gewicht</option>
                        <option value="volume">Volumen</option>
                        <option value="temperature">Temperatur</option>
                        <option value="speed">Geschwindigkeit</option>
                        <option value="digital">Datenspeicher</option>
                        <option value="pressure">Druck</option>
                        <option value="area">Fläche</option>
                        <option value="energy">Energie</option>
                        <option value="power">Leistung</option>
                        <option value="time">Zeit</option>
                        <option value="angle">Winkel</option>
                        <option value="force">Kraft</option>
                        <option value="torque">Drehmoment</option>
                        <option value="frequency">Frequenz</option>
                        <option value="datarate">Datenübertragung</option>
                    </select>
                </div>

                <!-- Conversion Inputs -->
                <div class="space-y-4 mb-6">
                    <!-- From Input -->
                    <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 border border-blue-500/30">
                        <label for="units-from-value" class="block text-sm font-medium text-blue-300 mb-3">
                            Von
                        </label>
                        <div class="flex gap-3 items-center">
                            <input 
                                type="number" 
                                id="units-from-value" 
                                step="any"
                                value="1"
                                class="flex-1 px-4 py-3 dark-input rounded-lg text-lg text-white font-semibold border-blue-500/50 focus:border-blue-400 focus:ring-blue-500"
                                placeholder="0"
                                oninput="convertUnits('from')"
                            />
                            <select 
                                id="units-from-unit" 
                                class="px-4 py-3 dark-select rounded-lg text-base sm:text-lg border-blue-500/50 focus:border-blue-400 focus:ring-blue-500 w-full sm:w-auto"
                                style="min-width: 180px;"
                                onchange="convertUnits('from')"
                            >
                                <!-- Units will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <!-- Swap Button -->
                    <div class="flex justify-center">
                        <button 
                            type="button"
                            id="units-swap-btn"
                            onclick="swapUnits()"
                            class="w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-500 text-white font-bold text-2xl flex items-center justify-center transition-all duration-300 hover:scale-110 shadow-lg shadow-blue-500/50 hover:shadow-blue-400/70 touch-target"
                            aria-label="Einheiten tauschen"
                        >
                            ⇄
                        </button>
                    </div>

                    <!-- To Input -->
                    <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 border border-blue-500/30">
                        <label for="units-to-value" class="block text-sm font-medium text-blue-300 mb-3">
                            Zu
                        </label>
                        <div class="flex gap-3 items-center">
                            <input 
                                type="number" 
                                id="units-to-value" 
                                step="any"
                                readonly
                                class="flex-1 px-4 py-3 dark-input rounded-lg text-lg text-blue-300 font-bold border-blue-500/50 bg-gray-800/50"
                                placeholder="0"
                                oninput="convertUnits('to')"
                            />
                            <select 
                                id="units-to-unit" 
                                class="px-4 py-3 dark-select rounded-lg text-base sm:text-lg border-blue-500/50 focus:border-blue-400 focus:ring-blue-500 w-full sm:w-auto"
                                style="min-width: 180px;"
                                onchange="convertUnits('from')"
                            >
                                <!-- Units will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Quick-Select Chips -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-300 mb-3">Schnellumrechnungen</label>
                    <div id="units-quick-chips" class="flex flex-wrap gap-2">
                        <!-- Quick chips will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Formula Display -->
                <div id="units-formula-display" class="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30 text-center hidden">
                    <p class="text-sm text-blue-200">
                        <span id="formula-text" class="font-medium"></span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Geschwindigkeitsumrechner (Fully Functional) -->
        <div id="speed-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Geschwindigkeitsumrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Rechnen Sie Geschwindigkeiten um: km/h, mph, m/s, Knoten, Mach und Lauf-Pace (min/km). Dual-Purpose Converter für Autofahrer, Läufer, Segler und Sportler. Pace-Eingabe im Format MM:SS, automatische Umrechnung und Kontext-Hinweise. Ideal für Reisen, Training, Navigation und Geschwindigkeitsvergleiche.</p>
                
                <!-- Scenario Chips -->
                <div class="mb-6 flex flex-wrap gap-3">
                    <button 
                        onclick="setSpeedScenario('auto')"
                        id="scenario-auto"
                        class="px-4 py-2 bg-blue-600/30 border border-blue-500/50 rounded-lg text-sm text-blue-200 hover:bg-blue-600/50 transition-all flex items-center gap-2"
                    >
                        <span>🚗</span>
                        <span>Auto USA</span>
                    </button>
                    <button 
                        onclick="setSpeedScenario('joggen')"
                        id="scenario-joggen"
                        class="px-4 py-2 bg-blue-600/30 border border-blue-500/50 rounded-lg text-sm text-blue-200 hover:bg-blue-600/50 transition-all flex items-center gap-2"
                    >
                        <span>🏃</span>
                        <span>Joggen</span>
                    </button>
                    <button 
                        onclick="setSpeedScenario('segeln')"
                        id="scenario-segeln"
                        class="px-4 py-2 bg-blue-600/30 border border-blue-500/50 rounded-lg text-sm text-blue-200 hover:bg-blue-600/50 transition-all flex items-center gap-2"
                    >
                        <span>⛵</span>
                        <span>Segeln</span>
                    </button>
                </div>

                <form id="speed-form" class="space-y-6">
                    <!-- Input Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="speed-input-value" class="block text-sm font-medium text-slate-300 mb-2">
                                Von
                            </label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="speed-input-value" 
                                    name="speed-input-value"
                                    value="100"
                                    placeholder="100 oder 5:30"
                                    required
                                    class="w-full px-4 py-3 dark-input rounded-lg text-lg pr-20"
                                    oninput="handleSpeedInput()"
                                />
                                <select 
                                    id="speed-from-unit" 
                                    name="speed-from-unit"
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-gray-200"
                                    onchange="handleSpeedInput()"
                                >
                                    <option value="kmh">km/h</option>
                                    <option value="mph">mph</option>
                                    <option value="ms">m/s</option>
                                    <option value="kn">Knoten</option>
                                    <option value="mach">Mach</option>
                                    <option value="pace">min/km</option>
                                </select>
                            </div>
                            <p id="speed-input-hint" class="text-xs text-slate-400 mt-1">Für Pace: Format "5:30" (Minuten:Sekunden)</p>
                        </div>

                        <div>
                            <label for="speed-output-value" class="block text-sm font-medium text-slate-300 mb-2">
                                Nach
                            </label>
                            <div class="relative">
                                <input 
                                    type="text" 
                                    id="speed-output-value" 
                                    name="speed-output-value"
                                    readonly
                                    class="w-full px-4 py-3 dark-input rounded-lg text-lg pr-20 bg-gray-700/50"
                                />
                                <select 
                                    id="speed-to-unit" 
                                    name="speed-to-unit"
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-gray-200"
                                    onchange="handleSpeedInput()"
                                >
                                    <option value="kmh">km/h</option>
                                    <option value="mph" selected>mph</option>
                                    <option value="ms">m/s</option>
                                    <option value="kn">Knoten</option>
                                    <option value="mach">Mach</option>
                                    <option value="pace">min/km</option>
                                </select>
                            </div>
                            <p id="speed-output-hint" class="text-xs text-slate-400 mt-1"></p>
                        </div>
                    </div>

                    <!-- Swap Button -->
                    <div class="flex justify-center">
                        <button 
                            type="button"
                            onclick="swapSpeedUnits()"
                            class="px-4 py-2 bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-200 hover:bg-blue-600/50 transition-all"
                        >
                            ⇄ Tauschen
                        </button>
                    </div>

                    <!-- Results Display -->
                    <div id="speed-results" class="hidden mt-6">
                        <div class="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-blue-200">Ergebnis:</span>
                                <span id="speed-context-note" class="text-xs text-blue-300 italic"></span>
                            </div>
                            <div class="text-2xl font-bold text-white" id="speed-display-result">
                                -
                            </div>
                            <div id="speed-formula-display" class="text-xs text-blue-200 mt-2 italic"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Flächenrechner (Fully Functional) -->
        <div id="flaeche-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Flächenrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Umrechnen und berechnen Sie Flächen: Quadratmeter, Quadratkilometer, Hektar, Ar, Quadratfuß, Quadratmeile, Acre und mehr. Geometrische Berechnungen für Rechteck und Kreis mit visueller Vorschau. Real-World-Vergleich mit Referenzobjekten (Ping-Pong-Tisch, Parkplatz, Tennisplatz, Fußballfeld, Saarland). Ideal für Immobilien, Gartenplanung und Flächenvergleiche.</p>
                
                <!-- Mode Tabs -->
                <div class="flex gap-2 mb-6 border-b border-blue-500/30">
                    <button 
                        id="flaeche-tab-convert"
                        onclick="setFlaecheMode('convert')"
                        class="px-4 py-2 text-blue-200 border-b-2 border-blue-500 font-semibold transition-all"
                    >
                        Umrechnen
                    </button>
                    <button 
                        id="flaeche-tab-calculate"
                        onclick="setFlaecheMode('calculate')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-blue-200 transition-all"
                    >
                        Berechnen
                    </button>
                </div>

                <!-- Converter Mode -->
                <div id="flaeche-convert-mode" class="space-y-6">
                    <form id="flaeche-convert-form" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="flaeche-from-value" class="block text-sm font-medium text-slate-300 mb-2">
                                    Von
                                </label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        id="flaeche-from-value" 
                                        name="flaeche-from-value"
                                        step="0.01"
                                        min="0"
                                        value="100"
                                        required
                                        class="w-full px-4 py-3 dark-input rounded-lg text-lg pr-24"
                                        oninput="handleFlaecheConvert()"
                                    />
                                    <select 
                                        id="flaeche-from-unit" 
                                        name="flaeche-from-unit"
                                        class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-gray-200"
                                        onchange="handleFlaecheConvert()"
                                    >
                                        <option value="m2">m²</option>
                                        <option value="ha">Hektar (ha)</option>
                                        <option value="km2">km²</option>
                                        <option value="cm2">cm²</option>
                                        <option value="ft2">ft²</option>
                                        <option value="ac">Acre (ac)</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label for="flaeche-to-value" class="block text-sm font-medium text-slate-300 mb-2">
                                    Nach
                                </label>
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        id="flaeche-to-value" 
                                        name="flaeche-to-value"
                                        readonly
                                        class="w-full px-4 py-3 dark-input rounded-lg text-lg pr-24 bg-gray-700/50"
                                    />
                                    <select 
                                        id="flaeche-to-unit" 
                                        name="flaeche-to-unit"
                                        class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm text-gray-200"
                                        onchange="handleFlaecheConvert()"
                                    >
                                        <option value="m2">m²</option>
                                        <option value="ha" selected>Hektar (ha)</option>
                                        <option value="km2">km²</option>
                                        <option value="cm2">cm²</option>
                                        <option value="ft2">ft²</option>
                                        <option value="ac">Acre (ac)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Swap Button -->
                        <div class="flex justify-center">
                            <button 
                                type="button"
                                onclick="swapFlaecheUnits()"
                                class="px-4 py-2 bg-blue-600/30 border border-blue-500/50 rounded-lg text-blue-200 hover:bg-blue-600/50 transition-all"
                            >
                                ⇄ Tauschen
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Geometry Calculator Mode -->
                <div id="flaeche-calculate-mode" class="hidden space-y-6">
                    <form id="flaeche-calculate-form" class="space-y-6">
                        <!-- Shape Selector -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Form</label>
                            <div class="flex gap-4">
                                <label class="flex items-center cursor-pointer">
                                    <input 
                                        type="radio" 
                                        name="flaeche-shape" 
                                        value="rectangle"
                                        checked
                                        class="w-5 h-5 text-blue-500 border-gray-600 rounded focus:ring-blue-500 bg-gray-900"
                                        onchange="handleFlaecheGeometry()"
                                    />
                                    <span class="ml-2 text-slate-300">Rechteck</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input 
                                        type="radio" 
                                        name="flaeche-shape" 
                                        value="circle"
                                        class="w-5 h-5 text-blue-500 border-gray-600 rounded focus:ring-blue-500 bg-gray-900"
                                        onchange="handleFlaecheGeometry()"
                                    />
                                    <span class="ml-2 text-slate-300">Kreis</span>
                                </label>
                            </div>
                        </div>

                        <!-- Rectangle Inputs -->
                        <div id="flaeche-rectangle-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="flaeche-length" class="block text-sm font-medium text-slate-300 mb-2">
                                    Länge (m)
                                </label>
                                <input 
                                    type="number" 
                                    id="flaeche-length" 
                                    name="flaeche-length"
                                    step="0.01"
                                    min="0"
                                    value="10"
                                    required
                                    class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                    oninput="handleFlaecheGeometry()"
                                />
                            </div>
                            <div>
                                <label for="flaeche-width" class="block text-sm font-medium text-slate-300 mb-2">
                                    Breite (m)
                                </label>
                                <input 
                                    type="number" 
                                    id="flaeche-width" 
                                    name="flaeche-width"
                                    step="0.01"
                                    min="0"
                                    value="5"
                                    required
                                    class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                    oninput="handleFlaecheGeometry()"
                                />
                            </div>
                        </div>

                        <!-- Circle Inputs -->
                        <div id="flaeche-circle-inputs" class="hidden">
                            <div>
                                <label for="flaeche-radius" class="block text-sm font-medium text-slate-300 mb-2">
                                    Radius (m)
                                </label>
                                <input 
                                    type="number" 
                                    id="flaeche-radius" 
                                    name="flaeche-radius"
                                    step="0.01"
                                    min="0"
                                    value="5"
                                    required
                                    class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                                    oninput="handleFlaecheGeometry()"
                                />
                            </div>
                        </div>

                        <!-- Visual Shape Preview -->
                        <div class="bg-blue-900/20 rounded-lg p-6 border border-blue-500/30">
                            <p class="text-sm text-blue-200 mb-4 text-center">Vorschau</p>
                            <div id="flaeche-shape-preview" class="flex items-center justify-center min-h-[200px]">
                                <!-- Shape will be rendered here -->
                            </div>
                        </div>

                        <!-- Geometry Result -->
                        <div id="flaeche-geometry-result" class="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30 hidden">
                            <div class="text-center">
                                <p class="text-sm text-blue-200 mb-2">Fläche:</p>
                                <p class="text-2xl font-bold text-white" id="flaeche-geometry-area">-</p>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Real-World Comparison (Shown for both modes) -->
                <div id="flaeche-comparison" class="mt-6 hidden">
                    <div class="bg-blue-900/30 rounded-lg p-4 border border-blue-500/30">
                        <p class="text-sm text-blue-200 mb-3 font-semibold">Vergleich:</p>
                        <div id="flaeche-comparison-content" class="space-y-2">
                            <!-- Comparison text will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kleidergrößen Umrechner (Fully Functional) -->
        <div id="groessen-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Kleidergrößen Umrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Umrechnen Sie internationale Kleidergrößen: EU, US, UK, IT, FR, JP für Damen, Herren und Kinder. Konfektionsgrößen, Hosen (Jeans) und Schuhgrößen in allen gängigen Systemen. Smart Shopping-Tipps und Größentabellen. Ideal für Online-Shopping, internationale Bestellungen und Größenv ergleiche. Mit Range-Slider und Dropdown-Auswahl.</p>
                
                <!-- Gender Tabs -->
                <div class="flex gap-2 mb-4 border-b border-orange-500/30">
                    <button 
                        id="groessen-gender-damen"
                        onclick="setGroessenGender('damen')"
                        class="px-4 py-2 text-orange-200 border-b-2 border-orange-500 font-semibold transition-all"
                    >
                        Damen
                    </button>
                    <button 
                        id="groessen-gender-herren"
                        onclick="setGroessenGender('herren')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-orange-200 transition-all"
                    >
                        Herren
                    </button>
                    <button 
                        id="groessen-gender-kinder"
                        onclick="setGroessenGender('kinder')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-orange-200 transition-all"
                    >
                        Kinder
                    </button>
                </div>

                <!-- Category Sub-Tabs -->
                <div class="flex gap-2 mb-6">
                    <button 
                        id="groessen-category-konfektion"
                        onclick="setGroessenCategory('konfektion')"
                        class="px-4 py-2 text-orange-200 bg-orange-600/30 border border-orange-500/50 rounded-lg font-semibold transition-all"
                    >
                        Konfektion
                    </button>
                    <button 
                        id="groessen-category-hosen"
                        onclick="setGroessenCategory('hosen')"
                        class="px-4 py-2 text-slate-400 bg-gray-700/30 border border-gray-600/50 rounded-lg hover:text-orange-200 hover:bg-orange-600/20 transition-all"
                    >
                        Hosen (Jeans)
                    </button>
                    <button 
                        id="groessen-category-schuhe"
                        onclick="setGroessenCategory('schuhe')"
                        class="px-4 py-2 text-slate-400 bg-gray-700/30 border border-gray-600/50 rounded-lg hover:text-orange-200 hover:bg-orange-600/20 transition-all"
                    >
                        Schuhe
                    </button>
                </div>

                <!-- Size Selection -->
                <div class="mb-6">
                    <label for="groessen-base-unit" class="block text-sm font-medium text-slate-300 mb-2">
                        Größe wählen
                    </label>
                    <div class="space-y-4">
                        <!-- Unit Selector -->
                        <select 
                            id="groessen-base-unit" 
                            class="w-full px-4 py-3 dark-select rounded-lg text-lg mb-4"
                            onchange="updateGroessenSizeOptions()"
                        >
                            <option value="EU">EU</option>
                            <option value="US">US</option>
                            <option value="UK">UK</option>
                            <option value="IT">IT</option>
                            <option value="Int">International</option>
                        </select>

                        <!-- Range Slider -->
                        <div class="space-y-2">
                            <input 
                                type="range" 
                                id="groessen-size-slider" 
                                min="0"
                                max="10"
                                value="4"
                                step="1"
                                class="w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500"
                                oninput="handleGroessenSizeChange()"
                            />
                            <!-- Dropdown (Alternative/Complementary) -->
                            <select 
                                id="groessen-size-select" 
                                class="w-full px-4 py-3 dark-select rounded-lg text-base sm:text-lg"
                                onchange="handleGroessenSizeChange()"
                            >
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Results Display -->
                <div id="groessen-results" class="hidden">
                    <!-- Base Size Display -->
                    <div class="bg-orange-900/30 rounded-lg p-4 border border-orange-500/30 mb-4">
                        <div class="text-center">
                            <p class="text-sm text-orange-200 mb-1">Ihre Größe:</p>
                            <p class="text-3xl font-bold text-white" id="groessen-base-display">-</p>
                        </div>
                    </div>

                    <!-- Conversion Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <!-- Conversion cards will be populated by JavaScript -->
                    </div>

                    <!-- Measurement Hint -->
                    <div id="groessen-measurement-hint" class="bg-orange-900/20 rounded-lg p-3 border border-orange-500/20 mb-4 hidden">
                        <p class="text-sm text-orange-200" id="groessen-hint-text"></p>
                    </div>

                    <!-- Smart Tip -->
                    <div class="bg-orange-900/30 rounded-lg p-4 border border-orange-500/30">
                        <div class="flex items-start gap-3">
                            <span class="text-2xl">💡</span>
                            <div>
                                <p class="text-sm font-semibold text-orange-200 mb-1">Tipp:</p>
                                <p class="text-sm text-orange-100" id="groessen-smart-tip">-</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Benzinpreis Rechner (Fully Functional) -->
        <div id="benzin-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-2xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Benzinpreis Rechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Tankkosten, Reisekosten und Pendlerpauschale. Für Benzin, Diesel und Elektro. Fahrtstrecke, Verbrauch, Spritpreis und Mitfahrer berücksichtigt. Pendlerpauschale-Berechnung für Arbeitstage pro Jahr. Ideal für Reiseplanung, Fahrtkostenabrechnung und Spritkosten-Vergleich. Mit Kraftstoffart-Auswahl und detaillierter Kostenaufstellung.</p>
                
                <!-- Mode Tabs -->
                <div class="flex gap-2 mb-6 border-b border-orange-500/30">
                    <button 
                        id="benzin-tab-reisekosten"
                        onclick="setBenzinMode('reisekosten')"
                        class="px-4 py-2 text-orange-200 border-b-2 border-orange-500 font-semibold transition-all"
                    >
                        Reisekosten
                    </button>
                    <button 
                        id="benzin-tab-pendler"
                        onclick="setBenzinMode('pendler')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-orange-200 transition-all"
                    >
                        Pendlerpauschale
                    </button>
                </div>

                <form id="benzin-form" class="space-y-6">
                    <!-- Distance -->
                    <div>
                        <label for="benzin-distance" class="block text-sm font-medium text-slate-300 mb-2">
                            Fahrtstrecke (km)
                            <span id="benzin-distance-hint" class="text-xs text-slate-400 ml-2">(einfach oder gesamt)</span>
                        </label>
                        <input 
                            type="number" 
                            id="benzin-distance" 
                            name="benzin-distance"
                            step="0.1"
                            min="0"
                            value="100"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="handleBenzinCalculation()"
                        />
                    </div>

                    <!-- Fuel Consumption -->
                    <div>
                        <label for="benzin-consumption" class="block text-sm font-medium text-slate-300 mb-2">
                            Verbrauch (Liter pro 100 km)
                        </label>
                        <input 
                            type="number" 
                            id="benzin-consumption" 
                            name="benzin-consumption"
                            step="0.1"
                            min="0"
                            value="7.5"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="handleBenzinCalculation()"
                        />
                    </div>

                    <!-- Fuel Price -->
                    <div>
                        <label for="benzin-price" class="block text-sm font-medium text-slate-300 mb-2">
                            Spritpreis (€ pro Liter)
                        </label>
                        <input 
                            type="number" 
                            id="benzin-price" 
                            name="benzin-price"
                            step="0.01"
                            min="0"
                            value="1.65"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="handleBenzinCalculation()"
                        />
                    </div>

                    <!-- Fuel Type -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Kraftstoffart</label>
                        <div class="flex gap-4">
                            <label class="flex items-center cursor-pointer">
                                <input 
                                    type="radio" 
                                    name="benzin-fuel-type" 
                                    value="benzin"
                                    checked
                                    class="w-5 h-5 text-orange-500 border-gray-600 rounded focus:ring-orange-500 bg-gray-900"
                                    onchange="handleBenzinCalculation()"
                                />
                                <span class="ml-2 text-slate-300">Benzin</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input 
                                    type="radio" 
                                    name="benzin-fuel-type" 
                                    value="diesel"
                                    class="w-5 h-5 text-orange-500 border-gray-600 rounded focus:ring-orange-500 bg-gray-900"
                                    onchange="handleBenzinCalculation()"
                                />
                                <span class="ml-2 text-slate-300">Diesel</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input 
                                    type="radio" 
                                    name="benzin-fuel-type" 
                                    value="elektro"
                                    class="w-5 h-5 text-orange-500 border-gray-600 rounded focus:ring-orange-500 bg-gray-900"
                                    onchange="handleBenzinCalculation()"
                                />
                                <span class="ml-2 text-slate-300">Elektro</span>
                            </label>
                        </div>
                    </div>

                    <!-- Passengers (Reisekosten mode) -->
                    <div id="benzin-passengers-group">
                        <label for="benzin-passengers" class="block text-sm font-medium text-slate-300 mb-2">
                            Anzahl Mitfahrer (inkl. Fahrer)
                        </label>
                        <input 
                            type="number" 
                            id="benzin-passengers" 
                            name="benzin-passengers"
                            min="1"
                            value="1"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="handleBenzinCalculation()"
                        />
                    </div>

                    <!-- Commute Days (Pendler mode) -->
                    <div id="benzin-commute-days-group" class="hidden">
                        <label for="benzin-commute-days" class="block text-sm font-medium text-slate-300 mb-2">
                            Arbeitstage pro Jahr
                        </label>
                        <input 
                            type="number" 
                            id="benzin-commute-days" 
                            name="benzin-commute-days"
                            min="1"
                            max="365"
                            value="220"
                            required
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="handleBenzinCalculation()"
                        />
                        <p class="text-xs text-slate-400 mt-1">Typisch: 220 Arbeitstage (ohne Urlaub/Feiertage)</p>
                    </div>

                    <!-- Results Display -->
                    <div id="benzin-results" class="hidden mt-6 space-y-4">
                        <!-- Total Cost -->
                        <div class="bg-orange-900/30 rounded-lg p-6 border border-orange-500/30">
                            <div class="text-center">
                                <p class="text-sm text-orange-200 mb-2">Gesamtkosten</p>
                                <p class="text-4xl font-bold text-white" id="benzin-total-cost">-</p>
                            </div>
                        </div>

                        <!-- Cost per Person (if multiple passengers) -->
                        <div id="benzin-per-person-card" class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20 hidden">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-orange-200 mb-1">Pro Person</p>
                                    <p class="text-2xl font-bold text-white" id="benzin-cost-per-person">-</p>
                                </div>
                                <div class="text-right">
                                    <p id="benzin-savings-note" class="text-sm text-orange-300 font-semibold"></p>
                                </div>
                            </div>
                        </div>

                        <!-- CO2 Footprint -->
                        <div id="benzin-co2-card" class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span id="benzin-co2-icon" class="text-2xl">🍃</span>
                                    <div>
                                        <p class="text-sm text-orange-200 mb-1">CO₂-Emissionen</p>
                                        <p class="text-xl font-bold text-white" id="benzin-co2-value">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pendlerpauschale Result (Pendler mode) -->
                        <div id="benzin-pendler-card" class="bg-orange-900/30 rounded-lg p-4 border border-orange-500/30 hidden">
                            <div class="text-center">
                                <p class="text-sm text-orange-200 mb-2">Jährliche Steuerersparnis</p>
                                <p class="text-3xl font-bold text-white" id="benzin-pendler-deduction">-</p>
                                <p class="text-xs text-orange-300 mt-2" id="benzin-pendler-note"></p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Altersrechner (Fully Functional) -->
        <div id="alter-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Altersrechner</h2>
                 <p class="text-slate-400 text-sm mb-6 leading-relaxed">Berechnen Sie Ihr präzises Alter in Jahren, Monaten, Tagen, Stunden und Minuten. Lebensstatistiken: Herzschläge, Atemzüge, Schlafstunden. Nächstes Geburtstags-Datum, Countdown und Wochentag. Sternzeichen-Bestimmung mit Logos. Chronologisches Alter mit Schaltjahr-Berücksichtigung. Ideal für Geburtstagsplanung, Lebensstatistiken und Altersvergleiche.</p>
                
                <form id="alter-form" class="space-y-6">
                    <!-- Birth Date -->
                    <div>
                        <label for="alter-birth-date" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Geburtsdatum *
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-orange-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-orange-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Geben Sie Ihr Geburtsdatum im Format TT.MM.JJJJ ein (z.B. 15.03.1990)
                                </div>
                            </span>
                        </label>
                        <input 
                            type="text" 
                            id="alter-birth-date" 
                            name="alter-birth-date"
                            placeholder="TT.MM.JJJJ"
                            maxlength="10"
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="formatDateInput(this); handleAlterCalculation()"
                        />
                    </div>

                    <!-- Birth Time (Optional) -->
                    <div>
                        <label for="alter-birth-time" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Geburtszeit (optional)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-orange-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-orange-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Geben Sie die Geburtszeit im Format HH:MM ein (z.B. 14:30). Für präzisere Berechnungen mit Stunden und Minuten.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="time" 
                            id="alter-birth-time" 
                            name="alter-birth-time"
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            onchange="handleAlterCalculation()"
                        />
                        <p class="text-xs text-slate-400 mt-1">Für präzisere Berechnungen</p>
                    </div>

                    <!-- Target Date (Optional) -->
                    <div>
                        <label for="alter-target-date" class="block text-sm font-medium text-slate-300 mb-2 flex items-center">
                            Stichtag (optional)
                            <span class="ml-2 relative group cursor-help">
                                <span class="text-orange-400 font-bold text-base">(i)</span>
                                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 border border-orange-500 rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10 text-xs text-slate-300">
                                    Geben Sie ein Datum im Format TT.MM.JJJJ ein, für das das Alter berechnet werden soll. Leer lassen für aktuelles Datum.
                                </div>
                            </span>
                        </label>
                        <input 
                            type="text" 
                            id="alter-target-date" 
                            name="alter-target-date"
                            placeholder="TT.MM.JJJJ (leer = heute)"
                            maxlength="10"
                            class="w-full px-4 py-3 dark-input rounded-lg text-base sm:text-lg"
                            oninput="formatDateInput(this); handleAlterCalculation()"
                        />
                        <p class="text-xs text-slate-400 mt-1">Leer lassen für aktuelles Datum</p>
                    </div>

                    <!-- Calculate Button -->
                    <button 
                        type="button"
                        onclick="handleAlterCalculation(event)"
                        class="w-full px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg transition-all"
                    >
                        Berechnen
                    </button>

                    <!-- Results Display -->
                    <div id="alter-results" class="hidden mt-8 space-y-6">
                        <!-- Hero Age Display -->
                        <div class="bg-orange-900/30 rounded-lg p-6 border border-orange-500/30 text-center">
                            <p class="text-sm text-orange-200 mb-3">Dein Alter</p>
                            <p class="text-3xl md:text-4xl font-bold text-white" id="alter-age-string">-</p>
                            <p class="text-lg text-orange-200 mt-2" id="alter-precise-age">-</p>
                        </div>

                        <!-- Zodiac Sign -->
                        <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20 text-center">
                            <p class="text-sm text-orange-200 mb-2">Sternzeichen</p>
                            <div class="flex items-center justify-center gap-3">
                                <span id="alter-zodiac-icon" class="text-4xl">-</span>
                                <p class="text-2xl font-bold text-white" id="alter-zodiac">-</p>
                            </div>
                        </div>

                        <!-- Next Birthday -->
                        <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                            <div class="text-center">
                                <p class="text-sm text-orange-200 mb-2">Nächstes Geburtstag</p>
                                <p class="text-xl font-bold text-white mb-1" id="alter-next-birthday-date">-</p>
                                <p class="text-lg text-orange-300" id="alter-next-birthday-countdown">-</p>
                                <p class="text-sm text-orange-200 mt-2" id="alter-next-birthday-weekday">-</p>
                            </div>
                        </div>

                        <!-- Life Stats Grid -->
                        <div>
                            <p class="text-lg font-semibold text-orange-200 mb-4">Lebensstatistiken</p>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <!-- Total Days -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">📅</p>
                                        <p class="text-sm text-orange-200 mb-1">Tage gelebt</p>
                                        <p class="text-xl font-bold text-white" id="alter-total-days">-</p>
                                    </div>
                                </div>

                                <!-- Total Weeks -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">📆</p>
                                        <p class="text-sm text-orange-200 mb-1">Wochen gelebt</p>
                                        <p class="text-xl font-bold text-white" id="alter-total-weeks">-</p>
                                    </div>
                                </div>

                                <!-- Total Hours -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">⏰</p>
                                        <p class="text-sm text-orange-200 mb-1">Stunden gelebt</p>
                                        <p class="text-xl font-bold text-white" id="alter-total-hours">-</p>
                                    </div>
                                </div>

                                <!-- Heartbeats -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">❤️</p>
                                        <p class="text-sm text-orange-200 mb-1">Herzschläge</p>
                                        <p class="text-xl font-bold text-white" id="alter-heartbeats">-</p>
                                    </div>
                                </div>

                                <!-- Breaths -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">💨</p>
                                        <p class="text-sm text-orange-200 mb-1">Atemzüge</p>
                                        <p class="text-xl font-bold text-white" id="alter-breaths">-</p>
                                    </div>
                                </div>

                                <!-- Sleep Hours -->
                                <div class="bg-orange-900/20 rounded-lg p-4 border border-orange-500/20">
                                    <div class="text-center">
                                        <p class="text-2xl mb-2">💤</p>
                                        <p class="text-sm text-orange-200 mb-1">Verschlafen</p>
                                        <p class="text-xl font-bold text-white" id="alter-sleep-hours">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Rechtliches (Legal/Privacy) -->
        <div id="legal-view" class="hidden page-transition">
            <div class="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-lg p-6 md:p-8 max-w-4xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">Rechtliches</h2>
                
                <!-- Legal Tabs -->
                <div class="flex gap-2 mb-6 border-b border-gray-600">
                    <button 
                        id="legal-tab-impressum"
                        onclick="setLegalTab('impressum')"
                        class="px-4 py-2 text-gray-200 border-b-2 border-gray-400 font-semibold transition-all"
                    >
                        Impressum
                    </button>
                    <button 
                        id="legal-tab-datenschutz"
                        onclick="setLegalTab('datenschutz')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-gray-200 transition-all"
                    >
                        Datenschutz
                    </button>
                    <button 
                        id="legal-tab-haftung"
                        onclick="setLegalTab('haftung')"
                        class="px-4 py-2 text-slate-400 border-b-2 border-transparent hover:text-gray-200 transition-all"
                    >
                        Haftungsausschluss
                    </button>
                </div>

                <!-- Impressum Content -->
                <div id="legal-content-impressum" class="space-y-6 text-slate-300">
                    <div>
                        <h3 class="text-xl font-semibold text-white mb-4">Impressum</h3>
                        
                        <div class="space-y-4">
                            <div>

                            </div>

                            <div>
                                <p><strong class="text-gray-200">Kontakt:</strong></p>
                                <p>E-Mail: <a href="mailto:tooslforbusiness333@gmail.com" class="text-blue-400 hover:text-blue-300 underline">tooslforbusiness333@gmail.com</a></p>
                            </div>

                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-3">Haftungsausschluss:</h4>
                                
                                <div class="space-y-3">
                                    <div>
                                        <p class="font-semibold text-gray-200 mb-2">Haftung für Inhalte</p>
                                        <p>Die Inhalte unserer Seiten wurden mit größter Sorgfalt erstellt. Für die Richtigkeit, Vollständigkeit und Aktualität der Inhalte können wir jedoch keine Gewähr übernehmen. Als Diensteanbieter sind wir gemäß § 7 Abs.1 TMG für eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich.</p>
                                    </div>

                                    <div>
                                        <p class="font-semibold text-gray-200 mb-2">Haftung für Links</p>
                                        <p>Unser Angebot enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb können wir für diese fremden Inhalte auch keine Gewähr übernehmen. Für die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich.</p>
                                    </div>

                                    <div>
                                        <p class="font-semibold text-gray-200 mb-2">Urheberrecht</p>
                                        <p>Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die Vervielfältigung, Bearbeitung, Verbreitung und jede Art der Verwertung außerhalb der Grenzen des Urheberrechtes bedürfen der schriftlichen Zustimmung des jeweiligen Autors bzw. Erstellers.</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <p class="font-semibold text-gray-200 mb-2">Hinweis zur Nutzung:</p>
                                <p>DE Umrechner ist ein kostenloses Tool ohne kommerziellen Zweck. Die Nutzung erfolgt auf eigene Verantwortung. Wir übernehmen keine Haftung für Schäden, die aus der Nutzung dieses Tools entstehen.</p>
                            </div>

                            <div>
                                <p class="font-semibold text-gray-200 mb-2">Datenschutz:</p>
                                <p>Bitte beachten Sie unsere <a href="#" onclick="setLegalTab('datenschutz'); return false;" class="text-blue-400 hover:text-blue-300 underline">Datenschutzerklärung</a>.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Datenschutz Content -->
                <div id="legal-content-datenschutz" class="hidden space-y-4 text-slate-300">
                    <div>
                        <h3 class="text-xl font-semibold text-white mb-3">Datenschutzerklärung</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">1. Allgemeine Hinweise</h4>
                                <p>Diese Website ist grundsätzlich ohne Angabe personenbezogener Daten nutzbar. Eine Registrierung oder Anmeldung ist nicht erforderlich, um die angebotenen Rechner und Tools zu verwenden.</p>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">2. Lokale Datenverarbeitung (Client-Side Only)</h4>
                                <p><strong class="text-gray-200">Wichtig:</strong> Alle Eingaben in den Rechnern (z.B. Gehalt, Gewicht, Alter, Geburtsdatum) werden <strong class="text-green-400">ausschließlich lokal in Ihrem Browser</strong> verarbeitet.</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 pl-4">
                                    <li>Keine Daten werden an einen Server gesendet</li>
                                    <li>Keine Daten werden gespeichert oder übertragen</li>
                                    <li>Alle Berechnungen erfolgen direkt in Ihrem Browser</li>
                                    <li>Sie können diese Seite verlassen, ohne Spuren zu hinterlassen</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">3. Hosting (Firebase/Google)</h4>
                                <p>Diese Website wird über Firebase (Google) gehostet. Beim Aufruf der Seite werden technische Verbindungsdaten verarbeitet:</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 pl-4">
                                    <li>IP-Adresse (für die Auslieferung der Website erforderlich)</li>
                                    <li>Datum und Uhrzeit des Zugriffs</li>
                                    <li>Übertragene Datenmenge</li>
                                </ul>
                                <p class="mt-2 text-sm text-slate-400">Diese Daten werden von Google/Firebase gemäß deren Datenschutzerklärung verarbeitet: <a href="https://firebase.google.com/support/privacy" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">Firebase Datenschutz</a></p>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">4. Google Fonts</h4>
                                <p>Falls Google Fonts verwendet werden, werden diese lokal gehostet oder direkt von Google geladen. Weitere Informationen: <a href="https://policies.google.com/privacy" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:text-blue-300 underline">Google Datenschutzerklärung</a></p>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">5. Ihre Rechte (DSGVO)</h4>
                                <p>Da keine personenbezogenen Daten gespeichert werden, fallen die meisten DSGVO-Rechte (Auskunft, Löschung, etc.) nicht an. Bei Fragen kontaktieren Sie uns bitte unter der im Impressum angegebenen E-Mail-Adresse.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Haftungsausschluss Content -->
                <div id="legal-content-haftung" class="hidden space-y-4 text-slate-300">
                    <div>
                        <h3 class="text-xl font-semibold text-white mb-3">Haftungsausschluss</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">1. Haftung für Inhalte (§ 7 TMG)</h4>
                                <p>Als Diensteanbieter sind wir gemäß § 7 Abs.1 TMG für eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich. Wir sind jedoch nicht verpflichtet, übermittelte oder gespeicherte fremde Informationen zu überwachen oder nach Umständen zu forschen, die auf eine rechtswidrige Tätigkeit hinweisen.</p>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">2. Haftung für Links</h4>
                                <p>Unser Angebot enthält Links zu externen Websites Dritter, auf deren Inhalte wir keinen Einfluss haben. Für die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich.</p>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">3. Medizinischer Haftungsausschluss</h4>
                                <p class="text-red-300 font-semibold">⚠️ WICHTIG:</p>
                                <p>Die bereitgestellten Gesundheitsrechner (BMI, Kalorien, Promille, etc.) dienen <strong>ausschließlich Informationszwecken</strong> und ersetzen <strong>keinesfalls</strong> eine professionelle medizinische Beratung oder Behandlung durch einen Arzt.</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 pl-4">
                                    <li>Die Berechnungen basieren auf allgemeinen Formeln und Durchschnittswerten</li>
                                    <li>Individuelle gesundheitliche Umstände werden nicht berücksichtigt</li>
                                    <li>Bei gesundheitlichen Fragen oder Beschwerden konsultieren Sie bitte einen Arzt</li>
                                    <li>Für medizinische Entscheidungen übernehmen wir keine Verantwortung</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">4. Finanzieller Haftungsausschluss</h4>
                                <p class="text-red-300 font-semibold">⚠️ WICHTIG:</p>
                                <p>Die Finanzrechner (Brutto-Netto, Kredit, Darlehen, Aktienrendite, etc.) dienen <strong>reinen Informationszwecken</strong>.</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 pl-4">
                                    <li>Für die Richtigkeit, Vollständigkeit und Aktualität der Berechnungen wird keine Haftung übernommen</li>
                                    <li>Die Rechner stellen keine Anlage- oder Steuerberatung dar</li>
                                    <li>Steuergesetze und -sätze können sich ändern</li>
                                    <li>Für finanzielle Entscheidungen konsultieren Sie bitte einen Steuerberater oder Finanzberater</li>
                                    <li>Wir übernehmen keine Verantwortung für finanzielle Verluste oder Nachteile</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-200 mb-2">5. Allgemeiner Haftungsausschluss</h4>
                                <p>Die Nutzung der Website erfolgt auf eigene Gefahr. Wir übernehmen keine Gewähr für die Verfügbarkeit, Funktionalität oder Fehlerfreiheit der angebotenen Tools und Rechner.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900/80 border-t border-gray-700 py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8">
                <a 
                    href="#" 
                    onclick="showLegalPage('impressum'); return false;"
                    class="text-slate-400 hover:text-gray-200 transition-colors text-sm"
                >
                    Impressum
                </a>
                <span class="text-gray-600 hidden md:inline">|</span>
                <a 
                    href="#" 
                    onclick="showLegalPage('datenschutz'); return false;"
                    class="text-slate-400 hover:text-gray-200 transition-colors text-sm"
                >
                    Datenschutz
                </a>
                <span class="text-gray-600 hidden md:inline">|</span>
                <a 
                    href="#" 
                    onclick="showLegalPage('haftung'); return false;"
                    class="text-slate-400 hover:text-gray-200 transition-colors text-sm"
                >
                    Haftungsausschluss
                </a>
            </div>
            <div class="text-center mt-4">
                <p class="text-slate-500 text-xs">© 2025 DE Umrechner. Alle Rechner dienen nur zu Informationszwecken.</p>
            </div>
        </div>
    </footer>

    <!-- Calculating Overlay -->
    <div id="calculating-overlay" class="calculating-overlay">
        <div class="relative">
            <div class="calculating-spinner"></div>
            <div class="calculating-text">Berechne...</div>
        </div>
    </div>

    <!-- JavaScript Module -->
    <script type="module">
        /**
         * View Management System
         * Handles navigation between dashboard and calculator views
         */
        function showPage(pageName) {
            // Hide all views
            const allViews = document.querySelectorAll('[id$="-view"]');
            allViews.forEach(view => {
                view.classList.add('hidden');
            });

            // Show navigation bar for calculator views (not dashboard)
            const nav = document.getElementById('nav');
            if (pageName === 'dashboard') {
                nav.classList.add('hidden');
            } else {
                nav.classList.remove('hidden');
                // Update nav title based on page
                const titles = {
                    'brutto-netto': 'Brutto Netto Rechner',
                    'darlehen': 'Darlehen Rechner',
                    'mwst': 'Annuitätendarlehen Rechner',
                    'immobilien': 'Immobiliendarlehen Rechner',
                    'zins': 'Zinsrechner',
                    'waehrung': 'Währungsrechner',
                    'inflation': 'Inflationsrechner',
                    'aktien': 'Aktien Rendite',
                    'bmi': 'BMI Rechner',
                    'kalorien': 'Kalorienrechner',
                    'promille': 'Promillerechner',
                    'units': 'Einheiten-Umrechner',
                    'speed': 'Geschwindigkeitsumrechner',
                    'flaeche': 'Flächenrechner',
                    'groessen': 'Kleidergrößen Umrechner',
                    'benzin': 'Benzinpreis Rechner',
                    'alter': 'Altersrechner',
                    'legal': 'Rechtliches'
                };
                document.getElementById('nav-title').textContent = titles[pageName] || 'Rechner';
                
                // Smart back navigation: from mwst/immobilien go to darlehen, from darlehen go to dashboard
                const backButton = nav.querySelector('button');
                if (pageName === 'mwst' || pageName === 'immobilien') {
                    backButton.onclick = () => showPage('darlehen');
                    backButton.textContent = 'Zurück zur Auswahl';
                } else if (pageName === 'darlehen') {
                    backButton.onclick = () => showPage('dashboard');
                    backButton.textContent = 'Zurück zum Dashboard';
                } else {
                    backButton.onclick = () => showPage('dashboard');
                    backButton.textContent = 'Zurück zum Dashboard';
                }
                
                // Add padding to main content when nav is visible (responsive)
                const isMobile = window.innerWidth < 640;
                document.querySelector('main').style.paddingTop = isMobile ? '60px' : '80px';
                
                // Update padding on resize
                window.addEventListener('resize', () => {
                    const isMobileNow = window.innerWidth < 640;
                    document.querySelector('main').style.paddingTop = isMobileNow ? '60px' : '80px';
                });
            }

            // Show the requested view
            const targetView = document.getElementById(pageName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Initialize specific calculators when shown
                // (No initialization needed for loan calculator)
                if (pageName === 'waehrung') {
                    setTimeout(() => {
                        if (typeof initializeWaehrung === 'function') {
                            initializeWaehrung();
                        }
                    }, 100);
                }
                if (pageName === 'inflation') {
                    setTimeout(() => {
                        if (typeof initializeInflation === 'function') {
                            initializeInflation();
                        }
                    }, 100);
                }
                if (pageName === 'units') {
                    setTimeout(() => {
                        if (typeof initializeUnits === 'function') {
                            initializeUnits();
                        }
                    }, 100);
                }
                if (pageName === 'speed') {
                    setTimeout(() => {
                        if (typeof initializeSpeed === 'function') {
                            initializeSpeed();
                        }
                    }, 100);
                }
                if (pageName === 'flaeche') {
                    setTimeout(() => {
                        if (typeof initializeFlaeche === 'function') {
                            initializeFlaeche();
                        }
                    }, 100);
                }
                if (pageName === 'groessen') {
                    setTimeout(() => {
                        if (typeof initializeGroessen === 'function') {
                            initializeGroessen();
                        }
                    }, 100);
                }
                if (pageName === 'benzin') {
                    setTimeout(() => {
                        if (typeof initializeBenzin === 'function') {
                            initializeBenzin();
                        }
                    }, 100);
                }
                if (pageName === 'alter') {
                    setTimeout(() => {
                        if (typeof initializeAlter === 'function') {
                            initializeAlter();
                        }
                    }, 100);
                }
            } else {
                // Fallback to dashboard if view doesn't exist
                document.getElementById('dashboard-view').classList.remove('hidden');
            }
        }

        /**
         * German Brutto Netto Rechner 2025
         * Comprehensive calculation based on 2025 German tax and social contribution laws
         */
        function calculateNettoGermany(inputs) {
            const {
                brutto_monthly,
                tax_class,
                age,
                num_children = 0,
                church_member = false,
                state_kirchensteuer = 'NW',
                krankenkasse_zusatzbeitrag = 1.7,
                is_pension_exempt = false,
                steuerfreibetrag_monthly = 0,
                kv_status = 'general',
                pkv_monthly_contribution = 0,
                pkv_contribution_eligible_for_subsidy = 0
            } = inputs;

            // 2025 Constants
            const YEARLY_GRUNDFREIBETRAG = 12096.00;
            const YEARLY_KINDERFREIBETRAG = 6384.00; // Per child in 2025
            const KV_BBG_MONTHLY = 5512.50;
            const RV_AV_BBG_MONTHLY = 8050.00;
            const KV_GENERAL_RATE = 0.073; // 7.3%
            const RV_RATE = 0.093; // 9.3%
            const AV_RATE = 0.013; // 1.3%
            const PV_BASE_RATE = 0.018; // 1.8%
            const PV_CHILDLESS_SURCHARGE = 0.006; // 0.6%
            const SOLI_RATE = 0.055; // 5.5%
            const WERBUNGSKOSTEN_PAUSCHALE = 1200.00; // Annual standard deduction
            
            // Altersentlastungsbetrag 2025 (for age >= 64)
            const ALTERSENTLASTUNGSBETRAG_PERCENT = 0.2; // 20% of income, max amount
            const ALTERSENTLASTUNGSBETRAG_MAX = 1900.00; // Maximum annual amount 2025
            
            // State-specific Church Tax rates (8% or 9%)
            const churchTax8States = ['BW', 'BY', 'TH']; // 8% states
            const kirchensteuer_rate = churchTax8States.includes(state_kirchensteuer) ? 0.08 : 0.09;

            // Social Contributions - Monthly Calculation
            
            // 1. Krankenversicherung (KV)
            let kv_employee = 0;
            let ag_zuschuss_pkv = 0;
            let kv_base = 0;

            if (kv_status === 'private') {
                // Private Insurance: No KV contribution from employee
                kv_employee = 0;
                
                // Calculate AG-Zuschuss (Employer's PKV subsidy)
                // AG-Zuschuss = min(half of PKV contribution, max GKV employee share)
                const kv_general_rate_employee = 0.073; // 7.3%
                const kv_avg_zusatzbeitrag = 1.7;
                const kv_zusatz_employee = (kv_avg_zusatzbeitrag / 2) / 100; // 0.85%
                const max_gkv_employee_rate = kv_general_rate_employee + kv_zusatz_employee;
                const max_gkv_employee_share = Math.min(brutto_monthly, KV_BBG_MONTHLY) * max_gkv_employee_rate;
                
                const half_pkv_contribution = pkv_contribution_eligible_for_subsidy / 2;
                ag_zuschuss_pkv = Math.min(half_pkv_contribution, max_gkv_employee_share);
                
                // Note: AG-Zuschuss reduces taxable income (zvE) but NOT social contributions
            } else {
                // Statutory Insurance (GKV)
                kv_base = Math.min(brutto_monthly, KV_BBG_MONTHLY);
                
                let kv_base_rate = 0;
                if (kv_status === 'general') {
                    // General rate: 14.6% total, employee share 7.3% + half of Zusatzbeitrag
                    kv_base_rate = 0.073; // 7.3%
                } else if (kv_status === 'reduced') {
                    // Reduced rate: 14.0% total, employee share 7.0% + half of Zusatzbeitrag
                    kv_base_rate = 0.070; // 7.0%
                }
                
                // KV Additional Rate (employee share = half of total)
                const kv_additional_employee = (krankenkasse_zusatzbeitrag / 2) / 100;
                const kv_total_rate = kv_base_rate + kv_additional_employee;
                kv_employee = kv_base * kv_total_rate;
            }

            // 2. Pflegeversicherung (PV) with child logic
            const pv_base = Math.min(brutto_monthly, KV_BBG_MONTHLY);
            let pv_rate = PV_BASE_RATE;
            
            // PV Child Logic: -0.25% per child after 1st, max 1% discount total (up to 5th child)
            if (num_children > 0) {
                const effective_children = Math.min(num_children - 1, 4); // Max 4 children for discount (2nd-5th)
                const children_discount = Math.min(effective_children * 0.0025, 0.01);
                pv_rate = PV_BASE_RATE - children_discount;
            } else if (age > 23) {
                // Childless surcharge for employees over 23
                pv_rate = PV_BASE_RATE + PV_CHILDLESS_SURCHARGE;
            }
            const pv_employee = pv_base * pv_rate;

            // 3. Rentenversicherung (RV) - Skip if pension exempt
            let rv_employee = 0;
            if (!is_pension_exempt) {
                const rv_base = Math.min(brutto_monthly, RV_AV_BBG_MONTHLY);
                rv_employee = rv_base * RV_RATE;
            }

            // 4. Arbeitslosenversicherung (AV)
            const av_base = Math.min(brutto_monthly, RV_AV_BBG_MONTHLY);
            const av_employee = av_base * AV_RATE;

            // Total Social Contributions
            const total_sv_monthly = kv_employee + pv_employee + rv_employee + av_employee;

            // Annual Calculations
            const brutto_annual = brutto_monthly * 12;
            const sv_annual = total_sv_monthly * 12;
            const steuerfreibetrag_annual = steuerfreibetrag_monthly * 12;
            
            // Kinderfreibetrag (reduces taxable income)
            const kinderfreibetrag_annual = num_children * YEARLY_KINDERFREIBETRAG;
            
            // Altersentlastungsbetrag (for age >= 64)
            let altersentlastungsbetrag_annual = 0;
            if (age >= 64) {
                const brutto_minus_sv = brutto_annual - sv_annual;
                altersentlastungsbetrag_annual = Math.min(
                    brutto_minus_sv * ALTERSENTLASTUNGSBETRAG_PERCENT,
                    ALTERSENTLASTUNGSBETRAG_MAX
                );
            }
            
            // Step 1: Calculate Annual Taxable Income (zvE - zu versteuerndes Einkommen)
            // zvE = Gross - SV - Allowances + Freibetrag - AG-Zuschuss (if PKV)
            // Note: Grundfreibetrag is handled in tax calculation, not deducted here
            // Note: AG-Zuschuss reduces taxable income but NOT social contributions
            const ag_zuschuss_annual = ag_zuschuss_pkv * 12;
            let zvE = Math.max(0, 
                brutto_annual - sv_annual - WERBUNGSKOSTEN_PAUSCHALE - 
                kinderfreibetrag_annual - altersentlastungsbetrag_annual + steuerfreibetrag_annual - ag_zuschuss_annual
            );

            // Step 2: Income Tax Calculation (2025 Precise Formula)
            // 2025 BMF Official Thresholds (Single Earner - SK I, II, IV)
            const ZONE1_MAX = 12096.00;      // Zone 1: 0% (Nullzone)
            const ZONE2_MAX = 17430.00;      // Zone 2: 14%-24% (Untere Progressionszone)
            const ZONE3_MAX = 68430.00;      // Zone 3: 24%-42% (Obere Progressionszone)
            const ZONE4_MAX = 277825.00;     // Zone 4: 42% (Proportionalzone)
            // Zone 5: >277825: 45% (Reichensteuer)

            /**
             * Core Tax Calculation Function for Single Earner (SK I, II, IV)
             * Implements the 2025 German progressive tax formula with 5 zones
             * Uses proper incremental tax calculation across zones
             */
            function calculateIncomeTax2025(zvE_input) {
                if (zvE_input <= ZONE1_MAX) {
                    // Zone 1: Nullzone (0% tax) - Grundfreibetrag
                    return 0.00;
                }
                
                let total_tax = 0.00;
                
                // Zone 2: 12,097 to 17,430 EUR (14% to 24% linear progression)
                // Formula: Progressive from 14% at 12,097 to 24% at 17,430
                if (zvE_input > ZONE1_MAX && zvE_input <= ZONE2_MAX) {
                    // Income falls entirely in zone 2
                    const excess = zvE_input - ZONE1_MAX;
                    const zone2_range = ZONE2_MAX - ZONE1_MAX;
                    // Average rate: (14% + end_rate) / 2, where end_rate depends on position
                    const end_rate = 0.14 + ((excess / zone2_range) * 0.10);
                    const avg_rate = (0.14 + end_rate) / 2;
                    total_tax = excess * avg_rate;
                } else if (zvE_input > ZONE2_MAX) {
                    // Income exceeds zone 2 - calculate complete zone 2 tax
                    const zone2_range = ZONE2_MAX - ZONE1_MAX;
                    const zone2_tax = zone2_range * ((0.14 + 0.24) / 2); // ~19% average
                    total_tax = zone2_tax;
                    
                    // Zone 3: 17,431 to 68,430 EUR (24% to 42% linear progression)
                    if (zvE_input > ZONE2_MAX && zvE_input <= ZONE3_MAX) {
                        // Income falls in zone 3
                        const zone3_excess = zvE_input - ZONE2_MAX;
                        const zone3_range = ZONE3_MAX - ZONE2_MAX;
                        const end_rate = 0.24 + ((zone3_excess / zone3_range) * 0.18);
                        const avg_rate = (0.24 + end_rate) / 2;
                        total_tax += zone3_excess * avg_rate;
                    } else if (zvE_input > ZONE3_MAX) {
                        // Income exceeds zone 3 - calculate complete zone 3 tax
                        const zone3_range = ZONE3_MAX - ZONE2_MAX;
                        const zone3_tax = zone3_range * ((0.24 + 0.42) / 2); // ~33% average
                        total_tax += zone3_tax;
                        
                        // Zone 4: 68,431 to 277,825 EUR (42% flat rate)
                        if (zvE_input > ZONE3_MAX && zvE_input <= ZONE4_MAX) {
                            const zone4_excess = zvE_input - ZONE3_MAX;
                            total_tax += zone4_excess * 0.42;
                        } else if (zvE_input > ZONE4_MAX) {
                            // Zone 5: >277,825 EUR (45% flat rate)
                            const zone4_range = ZONE4_MAX - ZONE3_MAX;
                            const zone4_tax = zone4_range * 0.42;
                            const zone5_excess = zvE_input - ZONE4_MAX;
                            total_tax += zone4_tax + (zone5_excess * 0.45);
                        }
                    }
                }
                
                return Math.max(0, total_tax);
            }

            // Step 3: Apply Tax Class Logic
            let lohnsteuer_annual = 0;
            
            if (zvE > 0) {
                if (tax_class === 3) {
                    // Steuerklasse III: Ehegattensplitting
                    // Calculate tax on half income, then multiply by 2
                    const zvE_half = zvE * 0.5;
                    const tax_half = calculateIncomeTax2025(zvE_half);
                    lohnsteuer_annual = tax_half * 2.0;
                } else if (tax_class === 5 || tax_class === 6) {
                    // Steuerklasse V/VI: Higher upfront rates, steeper brackets
                    // These classes use higher withholding rates
                    const base_tax = calculateIncomeTax2025(zvE);
                    // SK V: ~1.3x multiplier for higher upfront withholding
                    // SK VI: ~1.4x multiplier for highest upfront withholding
                    const multiplier = tax_class === 5 ? 1.3 : 1.4;
                    lohnsteuer_annual = base_tax * multiplier;
                } else {
                    // Steuerklasse I, II, IV: Standard progression
                    lohnsteuer_annual = calculateIncomeTax2025(zvE);
                    
                    // Steuerklasse II: Additional reduction for single parents
                    if (tax_class === 2) {
                        // Approximate 8% reduction for SK II
                        lohnsteuer_annual *= 0.92;
                    }
                }
            }
            
            // Ensure non-negative
            lohnsteuer_annual = Math.max(0, lohnsteuer_annual);

            // Soli Calculation (5.5% of Lohnsteuer above threshold)
            // Soli threshold: ~972 EUR annual income tax (2025)
            // Kinderfreibetrag reduces Soli threshold
            const soli_threshold_base = 972.00;
            const soli_threshold_reduction_per_child = 194.00; // Approx reduction per child
            const soli_threshold = Math.max(0, soli_threshold_base - (num_children * soli_threshold_reduction_per_child));
            
            let soli_annual = 0;
            if (lohnsteuer_annual > soli_threshold) {
                soli_annual = (lohnsteuer_annual - soli_threshold) * SOLI_RATE;
            }

            // Church Tax Calculation (8% or 9% depending on state)
            let kirchensteuer_annual = 0;
            if (church_member) {
                kirchensteuer_annual = lohnsteuer_annual * kirchensteuer_rate;
            }

            // Monthly Tax Amounts
            const lohnsteuer_monthly = lohnsteuer_annual / 12;
            const soli_monthly = soli_annual / 12;
            const kirchensteuer_monthly = kirchensteuer_annual / 12;

            // Final Netto Calculation
            // For PKV: Employee pays full PKV contribution (not deducted here as it's private)
            // AG-Zuschuss reduces taxable income but doesn't appear as deduction
            const total_deductions_monthly = lohnsteuer_monthly + soli_monthly + kirchensteuer_monthly + 
                                          kv_employee + pv_employee + rv_employee + av_employee;
            const netto_monthly = brutto_monthly - total_deductions_monthly;
            
            // For PKV, net salary is reduced by actual PKV contribution (not AG-Zuschuss)
            // AG-Zuschuss is already reflected in reduced taxes via zvE reduction

            // Return JSON result
            return {
                brutto_monthly: Math.round(brutto_monthly * 100) / 100,
                netto_monthly: Math.round(Math.max(0, netto_monthly) * 100) / 100,
                lohnsteuer_monthly: Math.round(lohnsteuer_monthly * 100) / 100,
                soli_monthly: Math.round(soli_monthly * 100) / 100,
                kirchensteuer_monthly: Math.round(kirchensteuer_monthly * 100) / 100,
                kv_employee_monthly: Math.round(kv_employee * 100) / 100,
                pv_employee_monthly: Math.round(pv_employee * 100) / 100,
                rv_employee_monthly: Math.round(rv_employee * 100) / 100,
                av_employee_monthly: Math.round(av_employee * 100) / 100,
                total_deductions_monthly: Math.round(total_deductions_monthly * 100) / 100,
                // PKV specific fields
                ag_zuschuss_pkv_monthly: Math.round(ag_zuschuss_pkv * 100) / 100,
                pkv_monthly_contribution: kv_status === 'private' ? Math.round(pkv_monthly_contribution * 100) / 100 : 0
            };
        }

        /**
         * Signature Animation Function - Reusable for all calculators
         * Creates sparkle particles and button animation
         */
        function triggerSignatureAnimation(buttonElement) {
            // Add animating class (glow and pulse animation)
            buttonElement.classList.add('animating');
            
            // Remove animating class after animation completes (1.5s)
            setTimeout(() => {
                buttonElement.classList.remove('animating');
                
                // Create sparkle particles AFTER button animation completes
                const sparkleContainer = buttonElement.parentElement;
                
                for (let i = 0; i < 12; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    
                    // Random position around button
                    const angle = (i / 12) * Math.PI * 2;
                    const radius = 40;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    sparkle.style.left = `${50 + x}%`;
                    sparkle.style.top = `${50 + y}%`;
                    sparkle.style.animationDelay = `${i * 0.1}s`;
                    
                    // Create container if needed
                    let container = sparkleContainer.querySelector('.sparkle-container');
                    if (!container) {
                        container = document.createElement('div');
                        container.className = 'sparkle-container';
                        container.style.position = 'absolute';
                        container.style.top = '0';
                        container.style.left = '0';
                        container.style.width = '100%';
                        container.style.height = '100%';
                        container.style.pointerEvents = 'none';
                        sparkleContainer.style.position = 'relative';
                        sparkleContainer.appendChild(container);
                    }
                    
                    container.appendChild(sparkle);
                    
                    // Remove sparkle after animation
                    setTimeout(() => {
                        sparkle.remove();
                    }, 2000);
                }
            }, 1500);
        }
        
        /**
         * Show calculating overlay
         */
        function showCalculatingOverlay() {
            const overlay = document.getElementById('calculating-overlay');
            overlay.classList.add('active');
        }
        
        /**
         * Hide calculating overlay
         */
        function hideCalculatingOverlay() {
            const overlay = document.getElementById('calculating-overlay');
            overlay.classList.remove('active');
        }

        /**
         * Toggle PKV fields visibility based on KV status
         */
        function togglePKVFields() {
            const kvStatus = document.getElementById('kv_status').value;
            const pkvContainer = document.getElementById('pkv_fields_container');
            const zusatzbeitragContainer = document.getElementById('kv_zusatzbeitrag_container');
            
            if (kvStatus === 'private') {
                pkvContainer.classList.remove('hidden');
                zusatzbeitragContainer.classList.add('hidden');
                // Make PKV fields required
                document.getElementById('pkv_monthly_contribution').required = true;
                document.getElementById('pkv_contribution_eligible_for_subsidy').required = true;
            } else {
                pkvContainer.classList.add('hidden');
                zusatzbeitragContainer.classList.remove('hidden');
                // Remove requirement from PKV fields
                document.getElementById('pkv_monthly_contribution').required = false;
                document.getElementById('pkv_contribution_eligible_for_subsidy').required = false;
            }
        }

        /**
         * Brutto Netto Retirement Chart
         */
        let bruttoNettoRetirementChart = null;

        /**
         * Calculate retirement age (standard is 67 in Germany)
         */
        function getRetirementAge(birthYear) {
            // Simplified: For people born after 1964, retirement age is 67
            // For this calculation, we'll use 67 as standard
            return 67;
        }

        /**
         * Format time in a human-readable way
         */
        function formatTime(hours) {
            const years = Math.floor(hours / (40 * 52)); // 40 hours/week * 52 weeks
            const remainingHours = hours % (40 * 52);
            const days = Math.floor(remainingHours / 8); // 8 hours/day
            const remainingDaysHours = remainingHours % 8;
            
            let result = [];
            if (years > 0) {
                result.push(`${years} ${years === 1 ? 'Jahr' : 'Jahre'}`);
            }
            if (days > 0) {
                result.push(`${days} ${days === 1 ? 'Tag' : 'Tage'}`);
            }
            if (remainingDaysHours > 0 && years === 0 && days < 7) {
                result.push(`${remainingDaysHours} ${remainingDaysHours === 1 ? 'Stunde' : 'Stunden'}`);
            }
            
            return result.length > 0 ? result.join(', ') : `${hours.toFixed(0)} Stunden`;
        }

        /**
         * Calculate and display time worked statistics
         */
        function calculateTimeWorked(result, age) {
            const retirementAge = getRetirementAge(null);
            const yearsToRetirement = Math.max(0, retirementAge - age);
            
            if (yearsToRetirement <= 0) {
                // Already at or past retirement age
                document.getElementById('time-for-self').textContent = '0 Stunden';
                document.getElementById('time-for-state').textContent = '0 Stunden';
                document.getElementById('time-for-self-breakdown').textContent = 'Bereits im Rentenalter';
                document.getElementById('time-for-state-breakdown').textContent = '';
                document.getElementById('work-for-self-bar').style.width = '0%';
                document.getElementById('work-for-state-bar').style.width = '0%';
                document.getElementById('self-percentage').textContent = '';
                document.getElementById('state-percentage').textContent = '';
                return;
            }
            
            // Annual values
            const bruttoAnnual = result.brutto_monthly * 12;
            const nettoAnnual = result.netto_monthly * 12;
            const deductionsAnnual = result.total_deductions_monthly * 12;
            
            // Total over working lifetime
            const totalBrutto = bruttoAnnual * yearsToRetirement;
            const totalNetto = nettoAnnual * yearsToRetirement;
            const totalDeductions = deductionsAnnual * yearsToRetirement;
            
            // Calculate percentages
            const nettoPercentage = (totalNetto / totalBrutto) * 100;
            const deductionsPercentage = (totalDeductions / totalBrutto) * 100;
            
            // Assuming 40 hours/week, 52 weeks/year = 2080 hours/year
            const hoursPerYear = 2080;
            const totalWorkingHours = hoursPerYear * yearsToRetirement;
            
            // Hours worked for self (netto) vs state (deductions)
            const hoursForSelf = (totalWorkingHours * nettoPercentage) / 100;
            const hoursForState = (totalWorkingHours * deductionsPercentage) / 100;
            
            // Display results
            document.getElementById('time-for-self').textContent = formatTime(hoursForSelf);
            document.getElementById('time-for-state').textContent = formatTime(hoursForState);
            document.getElementById('time-for-self-breakdown').textContent = `${nettoPercentage.toFixed(1)}% der Arbeitszeit`;
            document.getElementById('time-for-state-breakdown').textContent = `${deductionsPercentage.toFixed(1)}% der Arbeitszeit`;
            
            // Update progress bars
            document.getElementById('work-for-self-bar').style.width = `${nettoPercentage}%`;
            document.getElementById('work-for-state-bar').style.width = `${deductionsPercentage}%`;
            document.getElementById('self-percentage').textContent = `${nettoPercentage.toFixed(1)}%`;
            document.getElementById('state-percentage').textContent = `${deductionsPercentage.toFixed(1)}%`;
        }

        /**
         * Render retirement chart showing netto vs total deductions until retirement
         */
        function renderBruttoNettoRetirementChart(result, age) {
            const chartCanvas = document.getElementById('brutto-netto-retirement-chart');
            if (!chartCanvas) return;
            
            const ctx = chartCanvas.getContext('2d');
            
            // Destroy existing chart if it exists
            if (bruttoNettoRetirementChart) {
                bruttoNettoRetirementChart.destroy();
            }
            
            const retirementAge = getRetirementAge(null);
            const yearsToRetirement = Math.max(0, retirementAge - age);
            
            if (yearsToRetirement <= 0) {
                // Already at or past retirement age
                document.getElementById('retirement-chart-info').textContent = 'Sie haben bereits das Rentenalter erreicht.';
                return;
            }
            
            // Create labels and data - show every 5 years or max 20 data points
            const step = Math.max(1, Math.ceil(yearsToRetirement / 20));
            const years = [];
            const nettoCumulative = [];
            const deductionsCumulative = [];
            
            let nettoTotal = 0;
            let deductionsTotal = 0;
            
            for (let year = 1; year <= yearsToRetirement; year += step) {
                // Add monthly values * 12 for annual, then accumulate
                const yearsInThisStep = Math.min(step, yearsToRetirement - year + 1);
                nettoTotal += result.netto_monthly * 12 * yearsInThisStep;
                deductionsTotal += result.total_deductions_monthly * 12 * yearsInThisStep;
                
                years.push(`Jahr ${year}${year + yearsInThisStep - 1 > year ? `-${year + yearsInThisStep - 1}` : ''}`);
                nettoCumulative.push(nettoTotal);
                deductionsCumulative.push(deductionsTotal);
            }
            
            // If last year is not included, add it
            if (years[years.length - 1] !== `Jahr ${yearsToRetirement}`) {
                nettoTotal += result.netto_monthly * 12 * (yearsToRetirement % step || step);
                deductionsTotal += result.total_deductions_monthly * 12 * (yearsToRetirement % step || step);
                years.push(`Jahr ${yearsToRetirement}`);
                nettoCumulative.push(nettoTotal);
                deductionsCumulative.push(deductionsTotal);
            }
            
            // Update info text
            document.getElementById('retirement-chart-info').textContent = 
                `Visualisierung über ${yearsToRetirement} ${yearsToRetirement === 1 ? 'Jahr' : 'Jahre'} bis zum Rentenalter (${retirementAge} Jahre)`;
            
            // Chart.js color scheme for teal theme
            const chartColors = {
                teal: 'rgba(20, 184, 166, 0.8)',
                tealLight: 'rgba(20, 184, 166, 0.3)',
                tealBorder: 'rgba(20, 184, 166, 1)',
                red: 'rgba(239, 68, 68, 0.8)',
                redLight: 'rgba(239, 68, 68, 0.3)',
                redBorder: 'rgba(239, 68, 68, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };
            
            bruttoNettoRetirementChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Geld in der Hand (Netto)',
                            data: nettoCumulative,
                            backgroundColor: chartColors.tealLight,
                            borderColor: chartColors.tealBorder,
                            borderWidth: 2,
                            order: 2
                        },
                        {
                            label: 'Abgaben an den Staat',
                            data: deductionsCumulative,
                            backgroundColor: chartColors.redLight,
                            borderColor: chartColors.redBorder,
                            borderWidth: 2,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: chartColors.textColor,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                usePointStyle: true,
                                padding: 15
                            },
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: chartColors.textColor,
                            bodyColor: chartColors.textColor,
                            borderColor: chartColors.tealBorder,
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const formattedValue = value.toLocaleString('de-DE', {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                    return `${context.dataset.label}: ${formattedValue} €`;
                                },
                                footer: function(tooltipItems) {
                                    let totalNetto = 0;
                                    let totalDeductions = 0;
                                    
                                    tooltipItems.forEach(item => {
                                        if (item.datasetIndex === 0) {
                                            totalNetto = item.parsed.y;
                                        } else {
                                            totalDeductions = item.parsed.y;
                                        }
                                    });
                                    
                                    const totalBrutto = totalNetto + totalDeductions;
                                    const statePercentage = ((totalDeductions / totalBrutto) * 100).toFixed(1);
                                    
                                    return [
                                        `─────────────────`,
                                        `Gesamt Brutto: ${totalBrutto.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €`,
                                        `Anteil für Staat: ${statePercentage}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: false,
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M €';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Kumulative Beträge (€)',
                                color: chartColors.textColor,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        /**
         * Handle Brutto Netto Form Submission
         */
        document.getElementById('brutto-netto-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('brutto-netto-result').classList.add('hidden');
            
            // Small delay to show animation, then calculate
            setTimeout(() => {
                // Get brutto input and period
                const brutto_input = parseFloat(document.getElementById('brutto').value);
                const brutto_period = document.getElementById('brutto_period').value;
            
            // Convert to monthly based on period
            let brutto_monthly = 0;
            switch(brutto_period) {
                case 'yearly':
                    brutto_monthly = brutto_input / 12;
                    break;
                case 'monthly':
                    brutto_monthly = brutto_input;
                    break;
                case 'weekly':
                    brutto_monthly = brutto_input * (52 / 12); // ~4.333 weeks per month
                    break;
                case 'daily':
                    brutto_monthly = brutto_input * (365 / 12); // ~30.4167 days per month
                    break;
                default:
                    brutto_monthly = brutto_input;
            }
            
            const tax_class = parseInt(document.getElementById('steuerklasse').value);
            const age = parseInt(document.getElementById('age').value);
            const num_children = Math.min(parseInt(document.getElementById('num_children').value) || 0, 5);
            const church_member = document.getElementById('church_member').checked;
            const state_kirchensteuer = document.getElementById('state_kirchensteuer').value;
            const kv_status = document.getElementById('kv_status').value;
            const krankenkasse_zusatzbeitrag = kv_status === 'private' ? 1.7 : (parseFloat(document.getElementById('krankenkasse_zusatzbeitrag').value) || 1.7);
            const is_pension_exempt = document.getElementById('is_pension_exempt').checked;
            const steuerfreibetrag_monthly = parseFloat(document.getElementById('steuerfreibetrag_monthly').value) || 0;
            const pkv_monthly_contribution = kv_status === 'private' ? (parseFloat(document.getElementById('pkv_monthly_contribution').value) || 0) : 0;
            const pkv_contribution_eligible_for_subsidy = kv_status === 'private' ? (parseFloat(document.getElementById('pkv_contribution_eligible_for_subsidy').value) || 0) : 0;
            
            // Validation
            if (brutto_monthly <= 0) {
                alert('Bitte geben Sie einen gültigen Bruttolohn ein.');
                return;
            }
            if (age < 16 || age > 100) {
                alert('Bitte geben Sie ein gültiges Alter ein (16-100).');
                return;
            }
            if (tax_class < 1 || tax_class > 6) {
                alert('Bitte wählen Sie eine gültige Steuerklasse.');
                return;
            }
            if (krankenkasse_zusatzbeitrag < 0 || krankenkasse_zusatzbeitrag > 5) {
                alert('Bitte geben Sie einen gültigen Zusatzbeitrag ein (0-5%).');
                return;
            }
            if (steuerfreibetrag_monthly < 0) {
                alert('Bitte geben Sie einen gültigen Steuerfreibetrag ein.');
                return;
            }
            
            // Validation for PKV fields
            if (kv_status === 'private') {
                if (pkv_monthly_contribution <= 0) {
                    alert('Bitte geben Sie Ihren monatlichen PKV-Beitrag ein.');
                    return;
                }
                if (pkv_contribution_eligible_for_subsidy <= 0) {
                    alert('Bitte geben Sie den zuschussfähigen PKV-Beitragsanteil ein.');
                    return;
                }
            }
            
            // Calculate using 2025 German tax system
            const result = calculateNettoGermany({
                brutto_monthly,
                tax_class,
                age,
                num_children,
                church_member,
                state_kirchensteuer,
                krankenkasse_zusatzbeitrag,
                is_pension_exempt,
                steuerfreibetrag_monthly,
                kv_status,
                pkv_monthly_contribution,
                pkv_contribution_eligible_for_subsidy
            });
            
            // Display results
            document.getElementById('result-brutto').textContent = result.brutto_monthly.toFixed(2) + ' €';
            document.getElementById('result-netto').textContent = result.netto_monthly.toFixed(2) + ' €';
            document.getElementById('result-lohnsteuer').textContent = '- ' + result.lohnsteuer_monthly.toFixed(2) + ' €';
            document.getElementById('result-soli').textContent = '- ' + result.soli_monthly.toFixed(2) + ' €';
            document.getElementById('result-kirchensteuer').textContent = '- ' + result.kirchensteuer_monthly.toFixed(2) + ' €';
            document.getElementById('result-kv').textContent = '- ' + result.kv_employee_monthly.toFixed(2) + ' €';
            document.getElementById('result-pv').textContent = '- ' + result.pv_employee_monthly.toFixed(2) + ' €';
            document.getElementById('result-rv').textContent = '- ' + result.rv_employee_monthly.toFixed(2) + ' €';
            document.getElementById('result-av').textContent = '- ' + result.av_employee_monthly.toFixed(2) + ' €';
            
            // Show/hide PKV fields based on KV status
            const pkvContainer = document.getElementById('result-pkv-container');
            if (kv_status === 'private') {
                pkvContainer.classList.remove('hidden');
                document.getElementById('result-pkv').textContent = '- ' + result.pkv_monthly_contribution.toFixed(2) + ' €';
                document.getElementById('result-ag-zuschuss').textContent = '+ ' + result.ag_zuschuss_pkv_monthly.toFixed(2) + ' €';
            } else {
                pkvContainer.classList.add('hidden');
            }
            
            document.getElementById('result-total-deductions').textContent = '- ' + result.total_deductions_monthly.toFixed(2) + ' €';
            
            // Calculate and display time worked statistics
            calculateTimeWorked(result, age);
            
            // Render retirement chart
            renderBruttoNettoRetirementChart(result, age);
            
            // Keep overlay showing for 1 second to make animation visible
            setTimeout(() => {
                // Hide calculating overlay
                hideCalculatingOverlay();
                
                // Show results with fade-in animation
                const resultDiv = document.getElementById('brutto-netto-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000); // Show overlay for 1 second
            }, 500); // Delay calculation start to show button animation
        });

        /**
         * Annuitätendarlehen Rechner Functions
         */
        
        /**
         * Calculate Annuitätendarlehen (German Annuity Loan)
         */
        function calculateLoan(inputs) {
            const {
                loan_amount,
                interest_rate_nominal_pa,
                initial_amortization_rate,
                zinsbindung_years,
                payment_frequency = 'monthly',
                extra_payment_annual = 0
            } = inputs;

            // Calculate initial monthly annuity (constant payment)
            // Monthly Rate = (Loan Amount * (Initial Interest Rate + Initial Amortization Rate)) / 12
            const monthly_interest_rate = interest_rate_nominal_pa / 12 / 100;
            const monthly_amortization_rate = initial_amortization_rate / 12 / 100;
            
            // Initial monthly annuity
            const monthly_annuity = loan_amount * (monthly_interest_rate + monthly_amortization_rate);
            
            // Initialize tracking variables
            let restschuld = loan_amount;
            let total_interest_paid = 0;
            let total_amortized = 0;
            const tilgungsplan = [];
            
            // Continue until debt is fully paid (not just until zinsbindung ends)
            let month = 0;
            const max_years = 50; // Safety limit (50 years max)
            const max_months = max_years * 12;
            
            // Monthly iteration - continue until debt is paid off
            while (restschuld > 0 && month < max_months) {
                month++;
                
                // Calculate interest component for this month
                const interest = restschuld * monthly_interest_rate;
                
                // Calculate amortization component (Tilgung)
                let amortization = monthly_annuity - interest;
                
                // Apply extra payment at the end of each year (month 12, 24, 36, etc.)
                if (month % 12 === 0 && extra_payment_annual > 0) {
                    amortization += extra_payment_annual;
                }
                
                // Ensure amortization doesn't exceed remaining debt
                if (amortization > restschuld) {
                    amortization = restschuld;
                }
                
                // Update remaining debt
                restschuld -= amortization;
                
                // Update totals
                total_interest_paid += interest;
                total_amortized += amortization;
                
                // Store in amortization schedule
                tilgungsplan.push({
                    month: month,
                    interest: Math.round(interest * 100) / 100,
                    amortization: Math.round(amortization * 100) / 100,
                    restschuld: Math.max(0, Math.round(restschuld * 100) / 100)
                });
                
                // If debt is fully paid, stop
                if (restschuld <= 0) {
                    restschuld = 0;
                    break;
                }
            }
            
            return {
                monthly_annuity: Math.round(monthly_annuity * 100) / 100,
                total_interest_paid: Math.round(total_interest_paid * 100) / 100,
                remaining_debt: Math.round(restschuld * 100) / 100,
                total_amortized: Math.round(total_amortized * 100) / 100,
                tilgungsplan: tilgungsplan,
                disclaimer_note: "Die tatsächlichen Effektivzinsen sind bankindividuell und können abweichen (PAngV)."
            };
        }

        /**
         * Chart variables for loan calculator
         */
        let debtDevelopmentChart = null;
        let interestAmortizationChart = null;
        
        /**
         * Chart variables for mortgage calculator
         */
        let mortgageDebtDevelopmentChart = null;
        let mortgageInterestAmortizationChart = null;

        /**
         * Immobiliendarlehen Rechner - Calculate Mortgage with Ancillary Costs
         */
        function calculateMortgage(inputs) {
            const {
                purchase_price,
                equity,
                state_grunderwerbsteuer,
                notary_cost_percent = 2.0,
                broker_commission_percent = 3.57,
                nominal_interest_rate_pa,
                zinsbindung_years,
                initial_amortization_rate,
                extra_payment_annual = 0,
                disagio_percent = 0,
                payment_frequency = 'monthly'
            } = inputs;

            // Grunderwerbsteuer rates by Bundesland (2025)
            const grunderwerbsteuerRates = {
                'BW': 5.0, 'BY': 3.5, 'BE': 6.0, 'BB': 6.5, 'HB': 5.0, 'HH': 4.5,
                'HE': 6.0, 'MV': 6.0, 'NI': 5.0, 'NW': 6.5, 'RP': 5.0, 'SL': 6.5,
                'SN': 3.5, 'ST': 5.0, 'SH': 6.5, 'TH': 6.5
            };

            // Calculate ancillary costs
            const grunderwerbsteuerRate = grunderwerbsteuerRates[state_grunderwerbsteuer] || 6.0;
            const grunderwerbsteuer = purchase_price * (grunderwerbsteuerRate / 100);
            const notary_grundbuch = purchase_price * (notary_cost_percent / 100);
            const broker_commission = purchase_price * (broker_commission_percent / 100);
            
            const total_ancillary_costs = grunderwerbsteuer + notary_grundbuch + broker_commission;
            const total_investment = purchase_price + total_ancillary_costs;
            
            // Calculate required loan amount
            const required_loan_amount = total_investment - equity;
            
            // Apply Disagio (reduces the payout amount)
            const disagio_amount = required_loan_amount * (disagio_percent / 100);
            const actual_payout = required_loan_amount - disagio_amount;
            
            // Calculate monthly annuity (same as calculateLoan)
            const monthly_interest_rate = nominal_interest_rate_pa / 12 / 100;
            const monthly_amortization_rate = initial_amortization_rate / 12 / 100;
            const monthly_annuity = required_loan_amount * (monthly_interest_rate + monthly_amortization_rate);
            
            // Calculate amortization schedule (only for zinsbindung duration)
            let restschuld = required_loan_amount;
            let total_interest_paid = 0;
            let total_amortized = 0;
            const tilgungsplan = [];
            const tilgungsplan_summary = [];
            
            const max_months = zinsbindung_years * 12;
            
            // Calculate only for the zinsbindung period (not until full repayment)
            for (let month = 1; month <= max_months; month++) {
                const interest = restschuld * monthly_interest_rate;
                let amortization = monthly_annuity - interest;
                
                // Apply extra payment at end of year
                if (month % 12 === 0 && extra_payment_annual > 0) {
                    amortization += extra_payment_annual;
                }
                
                // Ensure amortization doesn't exceed remaining debt
                if (amortization > restschuld) {
                    amortization = restschuld;
                }
                
                restschuld -= amortization;
                total_interest_paid += interest;
                total_amortized += amortization;
                
                // Ensure restschuld doesn't go negative
                if (restschuld < 0) {
                    restschuld = 0;
                }
                
                tilgungsplan.push({
                    month: month,
                    interest: Math.round(interest * 100) / 100,
                    amortization: Math.round(amortization * 100) / 100,
                    restschuld: Math.max(0, Math.round(restschuld * 100) / 100)
                });
                
                // Create yearly summary (end of each year)
                if (month % 12 === 0 || month === max_months) {
                    const year = Math.ceil(month / 12);
                    const yearStart = (year - 1) * 12;
                    const yearInterest = tilgungsplan.slice(yearStart, month)
                        .reduce((sum, e) => sum + e.interest, 0);
                    const yearAmortization = tilgungsplan.slice(yearStart, month)
                        .reduce((sum, e) => sum + e.amortization, 0);
                    
                    tilgungsplan_summary.push({
                        year: year,
                        interest_paid: Math.round(yearInterest * 100) / 100,
                        principal_paid: Math.round(yearAmortization * 100) / 100,
                        restschuld: Math.max(0, Math.round(restschuld * 100) / 100)
                    });
                }
            }
            
            // Calculate Effective Interest Rate (Effektivzins)
            // Simplified calculation: nominal rate adjusted for disagio
            // More accurate would require iterative calculation, but this gives a good approximation
            let effective_interest_rate_pa = nominal_interest_rate_pa;
            if (disagio_percent > 0 && actual_payout > 0) {
                // Adjust for disagio: the effective rate is higher because you receive less
                const annual_interest = required_loan_amount * (nominal_interest_rate_pa / 100);
                effective_interest_rate_pa = (annual_interest / actual_payout) * 100;
            }
            
            return {
                required_loan_amount: Math.round(required_loan_amount * 100) / 100,
                total_investment: Math.round(total_investment * 100) / 100,
                total_ancillary_costs: Math.round(total_ancillary_costs * 100) / 100,
                monthly_annuity: Math.round(monthly_annuity * 100) / 100,
                effective_interest_rate_pa: Math.round(effective_interest_rate_pa * 100) / 100,
                remaining_debt: Math.round(restschuld * 100) / 100,
                cost_breakdown: {
                    grunderwerbsteuer: Math.round(grunderwerbsteuer * 100) / 100,
                    notary_grundbuch: Math.round(notary_grundbuch * 100) / 100,
                    broker_commission: Math.round(broker_commission * 100) / 100
                },
                tilgungsplan_summary: tilgungsplan_summary,
                tilgungsplan: tilgungsplan // Full monthly plan for charts
            };
        }

        /**
         * Render mortgage charts
         */
        function renderMortgageCharts(result) {
            const chartColors = {
                teal: 'rgba(20, 184, 166, 0.8)',
                tealLight: 'rgba(20, 184, 166, 0.3)',
                tealBorder: 'rgba(20, 184, 166, 1)',
                red: 'rgba(239, 68, 68, 0.8)',
                redLight: 'rgba(239, 68, 68, 0.3)',
                redBorder: 'rgba(239, 68, 68, 1)',
                green: 'rgba(34, 197, 94, 0.8)',
                greenLight: 'rgba(34, 197, 94, 0.3)',
                greenBorder: 'rgba(34, 197, 94, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };

            // Destroy existing charts
            if (mortgageDebtDevelopmentChart) mortgageDebtDevelopmentChart.destroy();
            if (mortgageInterestAmortizationChart) mortgageInterestAmortizationChart.destroy();

            // Aggregate data by year
            const yearlyAgg = {};
            result.tilgungsplan.forEach(entry => {
                const year = Math.ceil(entry.month / 12);
                if (!yearlyAgg[year]) {
                    yearlyAgg[year] = {
                        interest: 0,
                        amortization: 0,
                        restschuld: entry.restschuld
                    };
                }
                yearlyAgg[year].interest += entry.interest;
                yearlyAgg[year].amortization += entry.amortization;
                yearlyAgg[year].restschuld = entry.restschuld;
            });

            const years = [];
            const debtData = [];
            const interestData = [];
            const amortizationData = [];
            
            Object.keys(yearlyAgg).sort((a, b) => parseInt(a) - parseInt(b)).forEach(yearKey => {
                const year = parseInt(yearKey);
                years.push(`Jahr ${year}`);
                debtData.push(yearlyAgg[year].restschuld);
                interestData.push(yearlyAgg[year].interest);
                amortizationData.push(yearlyAgg[year].amortization);
            });

            // Debt Development Chart
            const debtCtx = document.getElementById('mortgage-debt-development-chart').getContext('2d');
            mortgageDebtDevelopmentChart = new Chart(debtCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Restschuld',
                        data: debtData,
                        borderColor: chartColors.redBorder,
                        backgroundColor: chartColors.redLight,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { 
                                color: chartColors.textColor,
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M €';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });

            // Interest vs Amortization Chart
            const interestCtx = document.getElementById('mortgage-interest-amortization-chart').getContext('2d');
            mortgageInterestAmortizationChart = new Chart(interestCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Zinsen',
                            data: interestData,
                            backgroundColor: chartColors.redLight,
                            borderColor: chartColors.redBorder,
                            borderWidth: 1
                        },
                        {
                            label: 'Tilgung',
                            data: amortizationData,
                            backgroundColor: chartColors.greenLight,
                            borderColor: chartColors.greenBorder,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { 
                                color: chartColors.textColor,
                                callback: function(value) {
                                    if (value >= 1000) {
                                        return (value / 1000).toFixed(1) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });
        }

        /**
         * Handle Mortgage Form Submission
         */
        document.getElementById('mortgage-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-mortgage-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('mortgage-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const purchase_price = parseFloat(document.getElementById('purchase_price').value) || 0;
                const equity = parseFloat(document.getElementById('equity').value) || 0;
                const state_grunderwerbsteuer = document.getElementById('state_grunderwerbsteuer').value;
                const notary_cost_percent = parseFloat(document.getElementById('notary_cost_percent').value) || 2.0;
                const broker_commission_percent = parseFloat(document.getElementById('broker_commission_percent').value) || 3.57;
                const nominal_interest_rate_pa = parseFloat(document.getElementById('mortgage_nominal_interest_rate_pa').value) || 0;
                const zinsbindung_years = parseInt(document.getElementById('mortgage_zinsbindung_years').value) || 0;
                const initial_amortization_rate = parseFloat(document.getElementById('mortgage_initial_amortization_rate').value) || 0;
                const extra_payment_annual = parseFloat(document.getElementById('mortgage_extra_payment_annual').value) || 0;
                const disagio_percent = parseFloat(document.getElementById('disagio_percent').value) || 0;

                // Validation
                if (purchase_price <= 0) {
                    alert('Bitte geben Sie einen gültigen Kaufpreis ein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (equity < 0 || equity >= purchase_price) {
                    alert('Das Eigenkapital muss zwischen 0 und dem Kaufpreis liegen.');
                    hideCalculatingOverlay();
                    return;
                }
                if (nominal_interest_rate_pa <= 0 || nominal_interest_rate_pa > 20) {
                    alert('Bitte geben Sie einen gültigen Zinssatz ein (0.01-20%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (initial_amortization_rate <= 0 || initial_amortization_rate > 20) {
                    alert('Bitte geben Sie einen gültigen Tilgungssatz ein (0.1-20%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (zinsbindung_years < 1 || zinsbindung_years > 30) {
                    alert('Bitte geben Sie eine gültige Zinsbindung ein (1-30 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateMortgage({
                    purchase_price,
                    equity,
                    state_grunderwerbsteuer,
                    notary_cost_percent,
                    broker_commission_percent,
                    nominal_interest_rate_pa,
                    zinsbindung_years,
                    initial_amortization_rate,
                    extra_payment_annual,
                    disagio_percent,
                    payment_frequency: 'monthly'
                });

                // Display results
                document.getElementById('result-total-investment').textContent = result.total_investment.toLocaleString('de-DE') + ' €';
                document.getElementById('result-required-loan').textContent = result.required_loan_amount.toLocaleString('de-DE') + ' €';
                document.getElementById('result-mortgage-monthly-annuity').textContent = result.monthly_annuity.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-effective-rate').textContent = result.effective_interest_rate_pa.toFixed(2) + ' %';
                document.getElementById('result-mortgage-remaining-debt').textContent = result.remaining_debt.toLocaleString('de-DE') + ' €';
                document.getElementById('result-total-ancillary-costs').textContent = result.total_ancillary_costs.toLocaleString('de-DE') + ' €';

                // Display cost breakdown
                document.getElementById('result-grunderwerbsteuer').textContent = result.cost_breakdown.grunderwerbsteuer.toLocaleString('de-DE') + ' €';
                document.getElementById('result-notary-grundbuch').textContent = result.cost_breakdown.notary_grundbuch.toLocaleString('de-DE') + ' €';
                document.getElementById('result-broker-commission').textContent = result.cost_breakdown.broker_commission.toLocaleString('de-DE') + ' €';

                // Display Tilgungsplan (all years of zinsbindung)
                const tbody = document.getElementById('mortgage-tilgungsplan-body');
                tbody.innerHTML = '';
                
                // Show all years (not just first 5)
                result.tilgungsplan_summary.forEach(entry => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700 hover:bg-gray-800/50';
                    row.innerHTML = `
                        <td class="py-2 text-slate-300">Jahr ${entry.year}</td>
                        <td class="py-2 text-red-400 text-right">${entry.interest_paid.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</td>
                        <td class="py-2 text-green-400 text-right">${entry.principal_paid.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</td>
                        <td class="py-2 text-white text-right">${entry.restschuld.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</td>
                    `;
                    tbody.appendChild(row);
                });

                // Render charts
                renderMortgageCharts(result);

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('mortgage-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Render loan charts
         */
        function renderLoanCharts(result) {
            const chartColors = {
                teal: 'rgba(20, 184, 166, 0.8)',
                tealLight: 'rgba(20, 184, 166, 0.3)',
                tealBorder: 'rgba(20, 184, 166, 1)',
                red: 'rgba(239, 68, 68, 0.8)',
                redLight: 'rgba(239, 68, 68, 0.3)',
                redBorder: 'rgba(239, 68, 68, 1)',
                green: 'rgba(34, 197, 94, 0.8)',
                greenLight: 'rgba(34, 197, 94, 0.3)',
                greenBorder: 'rgba(34, 197, 94, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };

            // Destroy existing charts
            if (debtDevelopmentChart) debtDevelopmentChart.destroy();
            if (interestAmortizationChart) interestAmortizationChart.destroy();

            // Aggregate data by year (sum interest and amortization per year, show debt at end of year)
            const years = [];
            const debtData = [];
            const interestData = [];
            const amortizationData = [];
            
            const totalMonths = result.tilgungsplan.length;
            
            // Aggregate by year
            const yearlyAgg = {};
            result.tilgungsplan.forEach(entry => {
                const year = Math.ceil(entry.month / 12);
                if (!yearlyAgg[year]) {
                    yearlyAgg[year] = {
                        interest: 0,
                        amortization: 0,
                        restschuld: entry.restschuld
                    };
                }
                yearlyAgg[year].interest += entry.interest;
                yearlyAgg[year].amortization += entry.amortization;
                yearlyAgg[year].restschuld = entry.restschuld; // Update to latest value
            });
            
            // Convert to arrays for chart
            Object.keys(yearlyAgg).sort((a, b) => parseInt(a) - parseInt(b)).forEach(yearKey => {
                const year = parseInt(yearKey);
                years.push(`Jahr ${year}`);
                debtData.push(yearlyAgg[year].restschuld);
                interestData.push(yearlyAgg[year].interest);
                amortizationData.push(yearlyAgg[year].amortization);
            });

            // Debt Development Chart
            const debtCtx = document.getElementById('debt-development-chart').getContext('2d');
            debtDevelopmentChart = new Chart(debtCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Restschuld',
                        data: debtData,
                        borderColor: chartColors.redBorder,
                        backgroundColor: chartColors.redLight,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { 
                                color: chartColors.textColor,
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M €';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });

            // Interest vs Amortization Chart
            const interestCtx = document.getElementById('interest-amortization-chart').getContext('2d');
            interestAmortizationChart = new Chart(interestCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Zinsen',
                            data: interestData,
                            backgroundColor: chartColors.redLight,
                            borderColor: chartColors.redBorder,
                            borderWidth: 1
                        },
                        {
                            label: 'Tilgung',
                            data: amortizationData,
                            backgroundColor: chartColors.greenLight,
                            borderColor: chartColors.greenBorder,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { 
                                color: chartColors.textColor,
                                callback: function(value) {
                                    if (value >= 1000) {
                                        return (value / 1000).toFixed(1) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });
        }

        /**
         * Handle Loan Form Submission
         */
        document.getElementById('loan-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-loan-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('loan-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const loan_amount = parseFloat(document.getElementById('loan_amount').value) || 0;
                const interest_rate_nominal_pa = parseFloat(document.getElementById('interest_rate_nominal_pa').value) || 0;
                const initial_amortization_rate = parseFloat(document.getElementById('initial_amortization_rate').value) || 0;
                const zinsbindung_years = parseInt(document.getElementById('zinsbindung_years').value) || 0;
                const extra_payment_annual = parseFloat(document.getElementById('extra_payment_annual').value) || 0;

                // Validation
                if (loan_amount <= 0) {
                    alert('Bitte geben Sie einen gültigen Darlehensbetrag ein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (interest_rate_nominal_pa <= 0 || interest_rate_nominal_pa > 20) {
                    alert('Bitte geben Sie einen gültigen Zinssatz ein (0.01-20%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (initial_amortization_rate <= 0 || initial_amortization_rate > 20) {
                    alert('Bitte geben Sie einen gültigen Tilgungssatz ein (0.1-20%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (zinsbindung_years < 1 || zinsbindung_years > 30) {
                    alert('Bitte geben Sie eine gültige Zinsbindung ein (1-30 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }
                if (extra_payment_annual < 0) {
                    alert('Die Sondertilgung darf nicht negativ sein.');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateLoan({
                    loan_amount,
                    interest_rate_nominal_pa,
                    initial_amortization_rate,
                    zinsbindung_years,
                    payment_frequency: 'monthly',
                    extra_payment_annual
                });

                // Display results
                document.getElementById('result-monthly-annuity').textContent = result.monthly_annuity.toFixed(2) + ' €';
                document.getElementById('result-remaining-debt').textContent = result.remaining_debt.toFixed(2) + ' €';
                document.getElementById('result-total-interest').textContent = result.total_interest_paid.toFixed(2) + ' €';
                document.getElementById('result-total-amortized').textContent = result.total_amortized.toFixed(2) + ' €';
                document.getElementById('disclaimer-note').textContent = result.disclaimer_note;

                // Display Tilgungsplan (aggregated by year)
                const tbody = document.getElementById('tilgungsplan-body');
                tbody.innerHTML = '';
                
                // Aggregate by year
                const yearlyData = {};
                result.tilgungsplan.forEach(entry => {
                    const year = Math.ceil(entry.month / 12);
                    if (!yearlyData[year]) {
                        yearlyData[year] = {
                            year: year,
                            interest: 0,
                            amortization: 0,
                            restschuld: entry.restschuld // Use restschuld at end of year
                        };
                    }
                    yearlyData[year].interest += entry.interest;
                    yearlyData[year].amortization += entry.amortization;
                    // Update restschuld to the last value of the year
                    yearlyData[year].restschuld = entry.restschuld;
                });
                
                // Display yearly data
                Object.keys(yearlyData).sort((a, b) => parseInt(a) - parseInt(b)).forEach(yearKey => {
                    const yearEntry = yearlyData[parseInt(yearKey)];
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700 hover:bg-gray-800/50';
                    row.innerHTML = `
                        <td class="py-2 text-slate-300">Jahr ${yearEntry.year}</td>
                        <td class="py-2 text-red-400 text-right">${yearEntry.interest.toFixed(2)} €</td>
                        <td class="py-2 text-green-400 text-right">${yearEntry.amortization.toFixed(2)} €</td>
                        <td class="py-2 text-white text-right">${yearEntry.restschuld.toFixed(2)} €</td>
                    `;
                    tbody.appendChild(row);
                });

                // Render charts
                renderLoanCharts(result);

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('loan-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });


        /**
         * Zinsrechner - Savings Plan Calculator with Tax Compliance
         * Calculates compound interest savings plan with German Abgeltungssteuer
         */
        function calculateSavingsPlan(inputs) {
            const {
                initial_capital = 0,
                monthly_rate = 0,
                interest_rate_pa = 0,
                duration_years = 0,
                rate_increase_annual_percent = 0,
                sparer_pauschbetrag_used = 0,
                is_church_member = false,
                fees_percent_pa = 0,
                include_tax = true,
                tax_rate_percent = 26.375
            } = inputs;

            // Constants
            const SPARER_PAUSCHBETRAG_MAX = 1000.00; // Max tax-free allowance

            // Initialize totals
            let current_capital = initial_capital;
            let total_deposits = initial_capital;
            let total_gross_interest = 0;
            let total_tax_deducted = 0;
            let total_fees_deducted = 0;
            const breakdown = [];

            const interest_rate_decimal = interest_rate_pa / 100;
            const fees_rate_decimal = fees_percent_pa / 100;
            const rate_increase_decimal = rate_increase_annual_percent / 100;
            const tax_rate_decimal = include_tax ? (tax_rate_percent / 100) : 0;
            let current_monthly_rate = monthly_rate;
            let remaining_pauschbetrag = Math.max(0, SPARER_PAUSCHBETRAG_MAX - sparer_pauschbetrag_used);

            // Annual iteration
            for (let year = 1; year <= duration_years; year++) {
                const start_capital = current_capital;
                const start_monthly_rate = current_monthly_rate;

                // Calculate monthly deposits for this year
                const monthly_deposits_year = current_monthly_rate * 12;

                // Calculate capital at year end with monthly deposits and annual compounding
                // More accurate approach: Calculate interest on capital as deposits accumulate
                // Monthly deposits accumulate linearly during the year
                // Average capital during year ≈ start_capital + (monthly_deposits_year / 2)
                const deposits_during_year = monthly_deposits_year;
                const average_capital = start_capital + (deposits_during_year / 2);
                
                // Annual interest earned (compounded annually)
                const interest_gross = average_capital * interest_rate_decimal;
                
                // Calculate fees on average capital
                const fees_amount = average_capital * fees_rate_decimal;
                total_fees_deducted += fees_amount;
                
                // End capital = start + deposits + interest - fees
                current_capital = start_capital + deposits_during_year + interest_gross - fees_amount;

                // Update totals
                total_deposits += deposits_during_year;
                total_gross_interest += interest_gross;

                // Calculate taxes for this year (if enabled)
                let tax_paid = 0;
                if (include_tax && tax_rate_decimal > 0) {
                    const taxable_interest = Math.max(0, interest_gross - remaining_pauschbetrag);
                    
                    if (taxable_interest > 0) {
                        // Use custom tax rate (already includes Soli and KiSt if applicable)
                        tax_paid = taxable_interest * tax_rate_decimal;
                        
                        // Deduct tax from capital
                        current_capital -= tax_paid;
                        
                        // Update remaining pauschbetrag (only the used portion, rest resets next year)
                        remaining_pauschbetrag = 0; // Reset to max for next year
                    } else {
                        // No tax, but reduce remaining pauschbetrag
                        remaining_pauschbetrag = Math.max(0, remaining_pauschbetrag - interest_gross);
                    }
                }

                total_tax_deducted += tax_paid;

                // Store annual breakdown
                breakdown.push({
                    year: year,
                    start_capital: Math.round(start_capital * 100) / 100,
                    monthly_rate: Math.round(start_monthly_rate * 100) / 100,
                    deposits_year: Math.round(deposits_during_year * 100) / 100,
                    interest_gross: Math.round(interest_gross * 100) / 100,
                    fees_amount: Math.round(fees_amount * 100) / 100,
                    tax_paid: Math.round(tax_paid * 100) / 100,
                    end_capital: Math.round(current_capital * 100) / 100
                });

                // Increase monthly rate for next year (if dynamik > 0)
                if (rate_increase_decimal > 0) {
                    current_monthly_rate = current_monthly_rate * (1 + rate_increase_decimal);
                }

                // Reset pauschbetrag to max for next year
                remaining_pauschbetrag = SPARER_PAUSCHBETRAG_MAX;
            }

            const total_net_interest = total_gross_interest - total_tax_deducted - total_fees_deducted;

            return {
                final_capital: Math.round(current_capital * 100) / 100,
                total_deposits: Math.round(total_deposits * 100) / 100,
                total_gross_interest: Math.round(total_gross_interest * 100) / 100,
                total_tax_deducted: Math.round(total_tax_deducted * 100) / 100,
                total_fees_deducted: Math.round(total_fees_deducted * 100) / 100,
                total_net_interest: Math.round(total_net_interest * 100) / 100,
                breakdown: breakdown
            };
        }

        /**
         * Aktien Rendite / ETF-Sparplan Calculator
         * Calculates compound growth with German Abgeltungssteuer (2025)
         */
        function calculateStockReturn(inputs) {
            const {
                initial_investment = 0,
                monthly_rate = 0,
                expected_return_pa = 0,
                duration_years = 0,
                sparer_pauschbetrag_used = 0,
                is_church_member = false
            } = inputs;

            // Constants
            const SPARER_PAUSCHBETRAG_MAX = 1000.00; // Max tax-free allowance per year
            const ABGELTUNGSSTEUER_RATE = 0.25; // 25% Abgeltungssteuer
            const SOLI_RATE = 0.055; // 5.5% Solidaritätszuschlag
            const KIRCHENSTEUER_RATE = 0.09; // 9% Kirchensteuer (on Abgeltungssteuer)
            
            // Calculate effective tax rate
            let effective_tax_rate = ABGELTUNGSSTEUER_RATE;
            effective_tax_rate += ABGELTUNGSSTEUER_RATE * SOLI_RATE; // Add Soli
            if (is_church_member) {
                effective_tax_rate += ABGELTUNGSSTEUER_RATE * KIRCHENSTEUER_RATE; // Add KiSt
            }
            // effective_tax_rate ≈ 0.26375 (without KiSt) or 0.27995 (with KiSt)

            // Initialize tracking variables
            let current_capital = initial_investment;
            let total_deposits = initial_investment;
            let total_gross_gain = 0;
            let total_tax_paid = 0;
            const annual_breakdown = [];

            const return_rate_decimal = expected_return_pa / 100;
            let remaining_pauschbetrag = Math.max(0, SPARER_PAUSCHBETRAG_MAX - sparer_pauschbetrag_used);

            // Annual iteration with compound growth
            for (let year = 1; year <= duration_years; year++) {
                const start_value = current_capital;
                const start_deposits = total_deposits;

                // Calculate monthly deposits for this year
                const deposits_this_year = monthly_rate * 12;
                total_deposits += deposits_this_year;

                // Calculate average capital during the year for more accurate compounding
                // Capital grows as deposits are made monthly
                // Approximation: Average capital ≈ start_value + (deposits_this_year / 2)
                const average_capital = start_value + (deposits_this_year / 2);

                // Calculate gross gain for this year (compounded)
                // More precise: Apply return to capital that grows throughout the year
                // Using average capital approximation for simplicity
                const gain_gross = average_capital * return_rate_decimal;

                // Add deposits and gross gain to capital
                current_capital = start_value + deposits_this_year + gain_gross;
                total_gross_gain += gain_gross;

                // Calculate taxes for this year
                let tax_paid = 0;
                const taxable_gain = Math.max(0, gain_gross - remaining_pauschbetrag);
                
                if (taxable_gain > 0) {
                    // Calculate Abgeltungssteuer
                    const abgeltungssteuer = taxable_gain * ABGELTUNGSSTEUER_RATE;
                    
                    // Calculate Soli
                    const soli = abgeltungssteuer * SOLI_RATE;
                    
                    // Calculate Kirchensteuer (if applicable)
                    let kirchensteuer = 0;
                    if (is_church_member) {
                        kirchensteuer = abgeltungssteuer * KIRCHENSTEUER_RATE;
                    }
                    
                    tax_paid = abgeltungssteuer + soli + kirchensteuer;
                    
                    // Deduct tax from capital
                    current_capital -= tax_paid;
                    total_tax_paid += tax_paid;
                    
                    // Pauschbetrag is fully used
                    remaining_pauschbetrag = 0;
                } else {
                    // No tax, but reduce remaining pauschbetrag
                    remaining_pauschbetrag = Math.max(0, remaining_pauschbetrag - gain_gross);
                }

                // Store annual breakdown
                annual_breakdown.push({
                    year: year,
                    start_value: Math.round(start_value * 100) / 100,
                    gain_gross: Math.round(gain_gross * 100) / 100,
                    tax_paid: Math.round(tax_paid * 100) / 100,
                    end_value: Math.round(current_capital * 100) / 100,
                    deposits_year: Math.round(deposits_this_year * 100) / 100
                });

                // Reset pauschbetrag to max for next year
                remaining_pauschbetrag = SPARER_PAUSCHBETRAG_MAX;
            }

            // Calculate total net gain
            const total_net_gain = current_capital - total_deposits;

            // Calculate CAGR (Compound Annual Growth Rate)
            // CAGR = ((End Value / Start Value) ^ (1 / Years)) - 1
            let annualized_return_cagr = 0;
            if (total_deposits > 0 && duration_years > 0) {
                const start_value = initial_investment || 1; // Avoid division by zero
                const end_value = current_capital;
                if (end_value > start_value) {
                    annualized_return_cagr = (Math.pow(end_value / start_value, 1 / duration_years) - 1) * 100;
                }
            }

            return {
                final_capital: Math.round(current_capital * 100) / 100,
                total_deposits: Math.round(total_deposits * 100) / 100,
                total_net_gain: Math.round(total_net_gain * 100) / 100,
                total_tax_paid: Math.round(total_tax_paid * 100) / 100,
                annualized_return_cagr: Math.round(annualized_return_cagr * 100) / 100,
                annual_breakdown: annual_breakdown
            };
        }

        /**
         * BMI Calculator with Age-Adjusted Ideal Ranges
         * Implements WHO classification and NRC age-adjusted ideal BMI ranges
         */
        function calculateBMI(inputs) {
            const {
                weight_kg,
                height_cm,
                age,
                gender
            } = inputs;

            // Basic BMI Formula
            const height_m = height_cm / 100;
            const bmi_value = Math.round((weight_kg / (height_m * height_m)) * 10) / 10;

            // WHO Classification
            let who_category = '';
            let color_code = '';
            
            if (bmi_value < 18.5) {
                who_category = 'Untergewicht';
                color_code = 'blue';
            } else if (bmi_value >= 18.5 && bmi_value < 25.0) {
                who_category = 'Normalgewicht';
                color_code = 'green';
            } else if (bmi_value >= 25.0 && bmi_value < 30.0) {
                who_category = 'Übergewicht (Präadipositas)';
                color_code = 'orange';
            } else if (bmi_value >= 30.0 && bmi_value < 35.0) {
                who_category = 'Adipositas Grad I';
                color_code = 'red';
            } else if (bmi_value >= 35.0 && bmi_value < 40.0) {
                who_category = 'Adipositas Grad II';
                color_code = 'red';
            } else {
                who_category = 'Adipositas Grad III';
                color_code = 'red';
            }

            // NRC Age-Adjusted Ideal BMI Ranges
            let ideal_min = 19;
            let ideal_max = 24;
            
            if (age >= 19 && age <= 24) {
                ideal_min = 19;
                ideal_max = 24;
            } else if (age >= 25 && age <= 34) {
                ideal_min = 20;
                ideal_max = 25;
            } else if (age >= 35 && age <= 44) {
                ideal_min = 21;
                ideal_max = 26;
            } else if (age >= 45 && age <= 54) {
                ideal_min = 22;
                ideal_max = 27;
            } else if (age >= 55 && age <= 64) {
                ideal_min = 23;
                ideal_max = 28;
            } else if (age > 64) {
                ideal_min = 24;
                ideal_max = 29;
            }

            const ideal_range_text = `${ideal_min} - ${ideal_max}`;

            // Generate personalized health feedback
            let health_feedback = '';
            
            if (bmi_value < ideal_min) {
                health_feedback = `Ihr BMI liegt unter dem Idealbereich für Ihre Altersgruppe (${ideal_range_text}). Dies kann auf Untergewicht hinweisen. Eine ausgewogene Ernährung und regelmäßige Bewegung können helfen.`;
            } else if (bmi_value >= ideal_min && bmi_value <= ideal_max) {
                health_feedback = `Ihr BMI liegt im Idealbereich für Ihre Altersgruppe (${ideal_range_text}). Das ist ein gutes Zeichen für Ihre Gesundheit. Weiter so!`;
            } else if (bmi_value > ideal_max && bmi_value < 25) {
                health_feedback = `Ihr BMI liegt leicht über dem Idealbereich für Ihre Altersgruppe (${ideal_range_text}), aber noch im Normalbereich nach WHO. Eine gesunde Ernährung und regelmäßige Bewegung können helfen, das Idealgewicht zu erreichen.`;
            } else if (bmi_value >= 25 && bmi_value < 30) {
                health_feedback = `Ihr BMI liegt über dem Idealbereich für Ihre Altersgruppe (${ideal_range_text}) und zeigt Übergewicht an. Eine ausgewogene Ernährung, regelmäßige Bewegung und eine langsame Gewichtsreduktion können Ihre Gesundheit verbessern.`;
            } else if (bmi_value >= 30 && bmi_value < 35) {
                health_feedback = `Ihr BMI weist auf Adipositas Grad I hin. Es wird empfohlen, mit einem Arzt oder Ernährungsberater zu sprechen, um einen gesunden Gewichtsreduktionsplan zu entwickeln.`;
            } else if (bmi_value >= 35 && bmi_value < 40) {
                health_feedback = `Ihr BMI weist auf Adipositas Grad II hin. Eine ärztliche Beratung wird dringend empfohlen, um gesundheitliche Risiken zu minimieren und einen individuellen Behandlungsplan zu erstellen.`;
            } else {
                health_feedback = `Ihr BMI weist auf Adipositas Grad III hin. Eine sofortige ärztliche Beratung wird dringend empfohlen, um gesundheitliche Risiken zu bewerten und einen umfassenden Behandlungsplan zu entwickeln.`;
            }

            return {
                bmi_value: bmi_value,
                who_category: who_category,
                ideal_range_text: ideal_range_text,
                health_feedback: health_feedback,
                color_code: color_code,
                ideal_min: ideal_min,
                ideal_max: ideal_max
            };
        }

        /**
         * Calorie & Macro Calculator (Mifflin-St Jeor)
         * Uses DGE-standard PAL values and macronutrient distribution
         */
        function calculateCalories(inputs) {
            const {
                gender,
                weight_kg,
                height_cm,
                age,
                pal_value,
                goal
            } = inputs;

            // Mifflin-St Jeor BMR Formula
            let bmr_kcal = 0;
            if (gender === 'male') {
                bmr_kcal = (10 * weight_kg) + (6.25 * height_cm) - (5 * age) + 5;
            } else {
                bmr_kcal = (10 * weight_kg) + (6.25 * height_cm) - (5 * age) - 161;
            }

            // Round BMR
            bmr_kcal = Math.round(bmr_kcal);

            // Calculate TDEE (Total Daily Energy Expenditure)
            const tdee_kcal = Math.round(bmr_kcal * pal_value);

            // Goal Adjustment
            let target_kcal = tdee_kcal;
            if (goal === 'lose') {
                target_kcal = tdee_kcal - 500;
            } else if (goal === 'gain') {
                target_kcal = tdee_kcal + 500;
            }
            target_kcal = Math.round(target_kcal);

            // Macronutrient Calculations (DGE Standard)
            // Carbohydrates: 50% of calories (1g = 4.1 kcal)
            const carbs_kcal = target_kcal * 0.50;
            const carbs_g = Math.round(carbs_kcal / 4.1);

            // Proteins: 15% of calories (1g = 4.1 kcal)
            // Minimum: 0.8g per kg bodyweight
            const protein_kcal = target_kcal * 0.15;
            const protein_g_min = Math.round(weight_kg * 0.8);
            const protein_g_from_percent = Math.round(protein_kcal / 4.1);
            // Use the higher of the two (percentage-based or minimum)
            const protein_g = Math.max(protein_g_from_percent, protein_g_min);

            // Fats: 35% of calories (1g = 9.3 kcal)
            const fat_kcal = target_kcal * 0.35;
            const fat_g = Math.round(fat_kcal / 9.3);

            // PAL Description
            const pal_descriptions = {
                '0.95': 'Schlafen',
                '1.2': 'Nur sitzend/liegend (alt, gebrechlich)',
                '1.45': 'Sitzend, kaum Bewegung (Bürojob)',
                '1.65': 'Sitzend, zeitweilig stehend/gehend (Studenten, Labor)',
                '1.85': 'Überwiegend stehend/gehend (Verkäufer, Handwerker)',
                '2.2': 'Körperlich anstrengende Arbeit (Bauarbeiter, Landwirte)'
            };
            const pal_description = pal_descriptions[pal_value.toString()] || 'Aktivitätslevel';

            return {
                bmr_kcal: bmr_kcal,
                tdee_kcal: tdee_kcal,
                target_kcal: target_kcal,
                macros: {
                    carbs_g: carbs_g,
                    protein_g: protein_g,
                    fat_g: fat_g
                },
                pal_description: pal_description,
                activity_kcal: tdee_kcal - bmr_kcal // For visualization
            };
        }

        /**
         * Blood Alcohol Calculator (Widmark Formula)
         * Calculates BAC using Widmark equation with resorption deficit and elimination
         */
        function calculatePromille(inputs) {
            const {
                gender,
                weight_kg,
                drink_list,
                time_since_first_drink
            } = inputs;

            // Constants
            const ETHANOL_DENSITY = 0.8; // g/ml
            const RESORPTION_DEFICIT = 0.15; // 15% of alcohol doesn't reach blood
            const ELIMINATION_RATE = 0.15; // 0.15‰ per hour

            // Widmark Factor (r)
            const widmark_r = gender === 'male' ? 0.68 : 0.55;

            // Calculate total alcohol mass (A)
            let total_alcohol_mass_g = 0;
            
            drink_list.forEach(drink => {
                const alcohol_volume_ml = drink.volume_ml * (drink.alcohol_vol_percent / 100);
                const alcohol_mass_g = alcohol_volume_ml * ETHANOL_DENSITY;
                total_alcohol_mass_g += alcohol_mass_g * drink.quantity;
            });

            // Apply resorption deficit (15% doesn't reach blood)
            const effective_alcohol_mass = total_alcohol_mass_g * (1 - RESORPTION_DEFICIT);

            // Basic BAC using Widmark formula: c = A / (weight * r)
            const basic_bac = effective_alcohol_mass / (weight_kg * widmark_r);

            // Apply elimination (0.15‰ per hour)
            const elimination_loss = ELIMINATION_RATE * time_since_first_drink;
            let promille_value = basic_bac - elimination_loss;

            // Ensure non-negative
            promille_value = Math.max(0, promille_value);
            promille_value = Math.round(promille_value * 100) / 100; // Round to 2 decimals

            // Calculate time to sober (hours until 0.0‰)
            const time_to_sober = promille_value > 0 ? Math.ceil(promille_value / ELIMINATION_RATE) : 0;

            // Determine legal status and warnings
            let legal_status_auto = '';
            let legal_status_bike = '';
            let warning_color = 'green';
            const warnings = [];

            if (promille_value > 0.0) {
                warnings.push({
                    text: '⚠️ Achtung Fahranfänger (Probezeit) & < 21 Jahre: 0,0‰ Grenze!',
                    color: 'yellow'
                });
            }

            if (promille_value > 0.3) {
                warnings.push({
                    text: '⚠️ Relative Fahruntüchtigkeit: Strafbar bei Auffälligkeiten/Unfall',
                    color: 'orange'
                });
            }

            if (promille_value > 0.5) {
                legal_status_auto = 'Ordnungswidrigkeit! Bußgeld, Fahrverbot. Nicht fahren!';
                warning_color = 'orange';
                warnings.push({
                    text: '🚫 Ordnungswidrigkeit: Bußgeld, Fahrverbot möglich',
                    color: 'red'
                });
            } else if (promille_value > 0.3) {
                legal_status_auto = 'Vorsicht! Relative Fahruntüchtigkeit. Nicht fahren!';
                warning_color = 'orange';
            } else if (promille_value > 0.0) {
                legal_status_auto = 'Achtung: Fahranfänger & < 21 Jahre: 0,0‰ Grenze!';
                warning_color = 'yellow';
            } else {
                legal_status_auto = 'Keine Alkoholwerte nachweisbar';
            }

            if (promille_value > 1.6) {
                legal_status_bike = 'MPU-Grenze! Auch für Fahrradfahrer relevant!';
                warning_color = 'red';
                warnings.push({
                    text: '🚨 MPU-Grenze (1,6‰): Auch für Fahrradfahrer relevant!',
                    color: 'red'
                });
            } else if (promille_value > 1.1) {
                legal_status_bike = 'Absolute Fahruntüchtigkeit! Straftat, Führerscheinentzug möglich.';
                warning_color = 'red';
                warnings.push({
                    text: '🚨 Absolute Fahruntüchtigkeit (1,1‰): Straftat, Führerscheinentzug!',
                    color: 'red'
                });
            } else if (promille_value > 0.5) {
                legal_status_bike = 'Vorsicht! Strafbar bei Unfall/Auffälligkeit.';
                warning_color = 'orange';
            } else if (promille_value > 0.3) {
                legal_status_bike = 'Vorsicht! Relative Fahruntüchtigkeit möglich.';
                warning_color = 'orange';
            } else {
                legal_status_bike = 'Keine besonderen Einschränkungen';
            }

            return {
                promille_value: promille_value,
                time_to_sober: time_to_sober,
                legal_status_auto: legal_status_auto,
                legal_status_bike: legal_status_bike,
                warning_color: warning_color,
                warnings: warnings
            };
        }

        /**
         * Drink list management for Promillerechner
         */
        let drinkList = [];

        /**
         * Add drink preset to list
         */
        function addDrinkPreset(preset) {
            drinkList.push({
                volume_ml: preset.volume_ml,
                alcohol_vol_percent: preset.alcohol_vol_percent,
                quantity: 1,
                name: preset.name || `${preset.volume_ml}ml (${preset.alcohol_vol_percent}%)`
            });
            renderDrinkList();
        }

        /**
         * Add custom drink to list
         */
        function addCustomDrink() {
            const volume_ml = parseFloat(document.getElementById('custom_volume_ml').value) || 0;
            const alcohol_percent = parseFloat(document.getElementById('custom_alcohol_percent').value) || 0;
            const quantity = parseInt(document.getElementById('custom_quantity').value) || 1;

            if (volume_ml <= 0 || alcohol_percent <= 0) {
                alert('Bitte geben Sie gültige Werte für Volumen und Alkoholgehalt ein.');
                return;
            }

            drinkList.push({
                volume_ml: volume_ml,
                alcohol_vol_percent: alcohol_percent,
                quantity: quantity,
                name: `${volume_ml}ml (${alcohol_percent}%)`
            });
            renderDrinkList();

            // Reset custom inputs
            document.getElementById('custom_volume_ml').value = '330';
            document.getElementById('custom_alcohol_percent').value = '4.8';
            document.getElementById('custom_quantity').value = '1';
        }

        /**
         * Render drink list
         */
        function renderDrinkList() {
            const drinkListContainer = document.getElementById('drink-list');
            
            if (drinkList.length === 0) {
                drinkListContainer.innerHTML = '<p class="text-slate-400 text-sm text-center py-4">Keine Getränke hinzugefügt. Verwenden Sie die Schnellauswahl oder fügen Sie ein eigenes Getränk hinzu.</p>';
                return;
            }

            drinkListContainer.innerHTML = '';
            
            drinkList.forEach((drink, index) => {
                const alcohol_volume_ml = drink.volume_ml * (drink.alcohol_vol_percent / 100);
                const alcohol_mass_g = alcohol_volume_ml * 0.8;
                const total_alcohol = alcohol_mass_g * drink.quantity;

                const drinkDiv = document.createElement('div');
                drinkDiv.className = 'bg-slate-800/50 rounded-lg p-3 border border-gray-700 flex items-center justify-between';
                drinkDiv.innerHTML = `
                    <div class="flex-1">
                        <p class="text-white font-semibold">${drink.name}</p>
                        <p class="text-xs text-slate-400">
                            ${drink.volume_ml}ml × ${drink.quantity} = ${(drink.volume_ml * drink.quantity).toFixed(0)}ml 
                            (${drink.alcohol_vol_percent}% Vol.) 
                            ≈ ${total_alcohol.toFixed(1)}g Alkohol
                        </p>
                    </div>
                    <button 
                        type="button"
                        onclick="removeDrink(${index})"
                        class="ml-3 px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded text-sm touch-target transition-all"
                    >
                        Entfernen
                    </button>
                `;
                drinkListContainer.appendChild(drinkDiv);
            });
        }

        /**
         * Remove drink from list
         */
        function removeDrink(index) {
            drinkList.splice(index, 1);
            renderDrinkList();
        }

        /**
         * Unit Converter - Multi-Category Converter
         * Supports Length, Weight, Volume, Temperature, Speed, Digital Storage
         */

        // Unit definitions for each category
        const UNIT_CATEGORIES = {
            length: {
                units: [
                    { id: 'm', name: 'Meter (m)', toBase: 1 },
                    { id: 'cm', name: 'Zentimeter (cm)', toBase: 0.01 },
                    { id: 'mm', name: 'Millimeter (mm)', toBase: 0.001 },
                    { id: 'km', name: 'Kilometer (km)', toBase: 1000 },
                    { id: 'in', name: 'Zoll/Inch (in)', toBase: 0.0254 },
                    { id: 'ft', name: 'Foot (ft)', toBase: 0.3048 },
                    { id: 'yd', name: 'Yard (yd)', toBase: 0.9144 },
                    { id: 'mi', name: 'Meile (mi)', toBase: 1609.344 },
                    { id: 'nm', name: 'Nautische Meile (nm)', toBase: 1852 }
                ],
                quickChips: [
                    { from: 'cm', to: 'in', label: 'cm → Zoll' },
                    { from: 'm', to: 'ft', label: 'm → ft' },
                    { from: 'km', to: 'mi', label: 'km → Meilen' },
                    { from: 'in', to: 'cm', label: 'Zoll → cm' }
                ]
            },
            weight: {
                units: [
                    { id: 'kg', name: 'Kilogramm (kg)', toBase: 1 },
                    { id: 'g', name: 'Gramm (g)', toBase: 0.001 },
                    { id: 'mg', name: 'Milligramm (mg)', toBase: 0.000001 },
                    { id: 't', name: 'Tonne (t)', toBase: 1000 },
                    { id: 'lb', name: 'Pound (lb)', toBase: 0.453592 },
                    { id: 'oz', name: 'Ounce (oz)', toBase: 0.0283495 },
                    { id: 'st', name: 'Stone (st)', toBase: 6.35029 },
                    { id: 'ct', name: 'Karat (ct)', toBase: 0.0002 }
                ],
                quickChips: [
                    { from: 'kg', to: 'lb', label: 'kg → lb' },
                    { from: 'lb', to: 'kg', label: 'lb → kg' },
                    { from: 'g', to: 'oz', label: 'g → oz' },
                    { from: 'oz', to: 'g', label: 'oz → g' }
                ]
            },
            volume: {
                units: [
                    { id: 'l', name: 'Liter (l)', toBase: 1 },
                    { id: 'ml', name: 'Milliliter (ml)', toBase: 0.001 },
                    { id: 'm3', name: 'Kubikmeter (m³)', toBase: 1000 },
                    { id: 'cm3', name: 'Kubikzentimeter (cm³)', toBase: 0.001 },
                    { id: 'gal', name: 'US Gallon (gal)', toBase: 3.78541 },
                    { id: 'galuk', name: 'UK Gallon (gal)', toBase: 4.54609 },
                    { id: 'floz', name: 'US Fluid Ounce (fl oz)', toBase: 0.0295735 },
                    { id: 'bbl', name: 'Oil Barrel (bbl)', toBase: 158.987 },
                    { id: 'cup', name: 'Cup (US)', toBase: 0.236588 },
                    { id: 'pt', name: 'Pint (US)', toBase: 0.473176 },
                    { id: 'qt', name: 'Quart (US)', toBase: 0.946353 }
                ],
                quickChips: [
                    { from: 'l', to: 'gal', label: 'Liter → Gallon' },
                    { from: 'gal', to: 'l', label: 'Gallon → Liter' },
                    { from: 'ml', to: 'floz', label: 'ml → fl oz' },
                    { from: 'floz', to: 'ml', label: 'fl oz → ml' }
                ]
            },
            temperature: {
                units: [
                    { id: 'C', name: 'Celsius (°C)', special: true },
                    { id: 'F', name: 'Fahrenheit (°F)', special: true },
                    { id: 'K', name: 'Kelvin (K)', special: true }
                ],
                quickChips: [
                    { from: 'C', to: 'F', label: '°C → °F' },
                    { from: 'F', to: 'C', label: '°F → °C' },
                    { from: 'C', to: 'K', label: '°C → K' },
                    { from: 'K', to: 'C', label: 'K → °C' }
                ]
            },
            speed: {
                units: [
                    { id: 'kmh', name: 'km/h', toBase: 1 },
                    { id: 'ms', name: 'm/s', toBase: 0.277778 },
                    { id: 'mph', name: 'mph', toBase: 1.60934 },
                    { id: 'kn', name: 'Knoten (kn)', toBase: 1.852 },
                    { id: 'mach', name: 'Mach', toBase: 1225.044 }
                ],
                quickChips: [
                    { from: 'kmh', to: 'mph', label: 'km/h → mph' },
                    { from: 'mph', to: 'kmh', label: 'mph → km/h' },
                    { from: 'kmh', to: 'ms', label: 'km/h → m/s' },
                    { from: 'ms', to: 'kmh', label: 'm/s → km/h' }
                ]
            },
            digital: {
                units: [
                    { id: 'bit', name: 'Bit', toBase: 1 },
                    { id: 'byte', name: 'Byte', toBase: 8 },
                    { id: 'KB', name: 'Kilobyte (KB)', toBase: 8192 },
                    { id: 'MB', name: 'Megabyte (MB)', toBase: 8388608 },
                    { id: 'GB', name: 'Gigabyte (GB)', toBase: 8589934592 },
                    { id: 'TB', name: 'Terabyte (TB)', toBase: 8796093022208 },
                    { id: 'PB', name: 'Petabyte (PB)', toBase: 9007199254740992 }
                ],
                quickChips: [
                    { from: 'MB', to: 'GB', label: 'MB → GB' },
                    { from: 'GB', to: 'MB', label: 'GB → MB' },
                    { from: 'GB', to: 'TB', label: 'GB → TB' },
                    { from: 'TB', to: 'GB', label: 'TB → GB' }
                ]
            },
            pressure: {
                units: [
                    { id: 'Pa', name: 'Pascal (Pa)', toBase: 1 },
                    { id: 'kPa', name: 'Kilopascal (kPa)', toBase: 1000 },
                    { id: 'MPa', name: 'Megapascal (MPa)', toBase: 1000000 },
                    { id: 'bar', name: 'Bar (bar)', toBase: 100000 },
                    { id: 'mbar', name: 'Millibar (mbar)', toBase: 100 },
                    { id: 'psi', name: 'PSI (psi)', toBase: 6894.76 },
                    { id: 'atm', name: 'Atmosphäre (atm)', toBase: 101325 },
                    { id: 'Torr', name: 'Torr', toBase: 133.322 },
                    { id: 'mmHg', name: 'mmHg', toBase: 133.322 }
                ],
                quickChips: [
                    { from: 'bar', to: 'psi', label: 'bar → psi' },
                    { from: 'psi', to: 'bar', label: 'psi → bar' },
                    { from: 'Pa', to: 'bar', label: 'Pa → bar' },
                    { from: 'bar', to: 'Pa', label: 'bar → Pa' }
                ]
            },
            area: {
                units: [
                    { id: 'm2', name: 'Quadratmeter (m²)', toBase: 1 },
                    { id: 'cm2', name: 'Quadratzentimeter (cm²)', toBase: 0.0001 },
                    { id: 'km2', name: 'Quadratkilometer (km²)', toBase: 1000000 },
                    { id: 'ha', name: 'Hektar (ha)', toBase: 10000 },
                    { id: 'acre', name: 'Acre', toBase: 4046.86 },
                    { id: 'ft2', name: 'Quadratfuß (ft²)', toBase: 0.092903 },
                    { id: 'in2', name: 'Quadratzoll (in²)', toBase: 0.00064516 },
                    { id: 'yd2', name: 'Quadratyard (yd²)', toBase: 0.836127 }
                ],
                quickChips: [
                    { from: 'm2', to: 'ft2', label: 'm² → ft²' },
                    { from: 'ft2', to: 'm2', label: 'ft² → m²' },
                    { from: 'ha', to: 'acre', label: 'ha → Acre' },
                    { from: 'acre', to: 'ha', label: 'Acre → ha' }
                ]
            },
            energy: {
                units: [
                    { id: 'J', name: 'Joule (J)', toBase: 1 },
                    { id: 'kJ', name: 'Kilojoule (kJ)', toBase: 1000 },
                    { id: 'MJ', name: 'Megajoule (MJ)', toBase: 1000000 },
                    { id: 'kWh', name: 'Kilowattstunde (kWh)', toBase: 3600000 },
                    { id: 'cal', name: 'Kalorie (cal)', toBase: 4.184 },
                    { id: 'kcal', name: 'Kilokalorie (kcal)', toBase: 4184 },
                    { id: 'BTU', name: 'BTU', toBase: 1055.06 },
                    { id: 'eV', name: 'Elektronenvolt (eV)', toBase: 0.000000000000000000160218 }
                ],
                quickChips: [
                    { from: 'kWh', to: 'kJ', label: 'kWh → kJ' },
                    { from: 'kJ', to: 'kWh', label: 'kJ → kWh' },
                    { from: 'kcal', to: 'kJ', label: 'kcal → kJ' },
                    { from: 'kJ', to: 'kcal', label: 'kJ → kcal' }
                ]
            },
            power: {
                units: [
                    { id: 'W', name: 'Watt (W)', toBase: 1 },
                    { id: 'kW', name: 'Kilowatt (kW)', toBase: 1000 },
                    { id: 'MW', name: 'Megawatt (MW)', toBase: 1000000 },
                    { id: 'GW', name: 'Gigawatt (GW)', toBase: 1000000000 },
                    { id: 'hp', name: 'Pferdestärke (PS)', toBase: 735.499 },
                    { id: 'hpuk', name: 'Horsepower (hp)', toBase: 745.7 },
                    { id: 'BTUh', name: 'BTU/h', toBase: 0.293071 }
                ],
                quickChips: [
                    { from: 'kW', to: 'hp', label: 'kW → PS' },
                    { from: 'hp', to: 'kW', label: 'PS → kW' },
                    { from: 'W', to: 'hp', label: 'W → PS' },
                    { from: 'hp', to: 'W', label: 'PS → W' }
                ]
            },
            time: {
                units: [
                    { id: 's', name: 'Sekunde (s)', toBase: 1 },
                    { id: 'min', name: 'Minute (min)', toBase: 60 },
                    { id: 'h', name: 'Stunde (h)', toBase: 3600 },
                    { id: 'd', name: 'Tag (d)', toBase: 86400 },
                    { id: 'wk', name: 'Woche (wk)', toBase: 604800 },
                    { id: 'mo', name: 'Monat (mo)', toBase: 2592000 },
                    { id: 'yr', name: 'Jahr (yr)', toBase: 31536000 }
                ],
                quickChips: [
                    { from: 'h', to: 'min', label: 'h → min' },
                    { from: 'min', to: 'h', label: 'min → h' },
                    { from: 'd', to: 'h', label: 'Tag → h' },
                    { from: 'h', to: 'd', label: 'h → Tag' }
                ]
            },
            angle: {
                units: [
                    { id: 'deg', name: 'Grad (°)', toBase: 1 },
                    { id: 'rad', name: 'Radian (rad)', toBase: 57.2958 },
                    { id: 'grad', name: 'Gon (grad)', toBase: 0.9 }
                ],
                quickChips: [
                    { from: 'deg', to: 'rad', label: '° → rad' },
                    { from: 'rad', to: 'deg', label: 'rad → °' },
                    { from: 'deg', to: 'grad', label: '° → gon' },
                    { from: 'grad', to: 'deg', label: 'gon → °' }
                ]
            },
            force: {
                units: [
                    { id: 'N', name: 'Newton (N)', toBase: 1 },
                    { id: 'kN', name: 'Kilonewton (kN)', toBase: 1000 },
                    { id: 'lbf', name: 'Pound-force (lbf)', toBase: 4.44822 },
                    { id: 'kgf', name: 'Kilogramm-force (kgf)', toBase: 9.80665 }
                ],
                quickChips: [
                    { from: 'N', to: 'lbf', label: 'N → lbf' },
                    { from: 'lbf', to: 'N', label: 'lbf → N' },
                    { from: 'N', to: 'kgf', label: 'N → kgf' },
                    { from: 'kgf', to: 'N', label: 'kgf → N' }
                ]
            },
            torque: {
                units: [
                    { id: 'Nm', name: 'Newtonmeter (Nm)', toBase: 1 },
                    { id: 'lbft', name: 'Pound-foot (lb-ft)', toBase: 1.35582 },
                    { id: 'kgcm', name: 'Kilogramm-Zentimeter (kg-cm)', toBase: 0.0980665 }
                ],
                quickChips: [
                    { from: 'Nm', to: 'lbft', label: 'Nm → lb-ft' },
                    { from: 'lbft', to: 'Nm', label: 'lb-ft → Nm' },
                    { from: 'Nm', to: 'kgcm', label: 'Nm → kg-cm' },
                    { from: 'kgcm', to: 'Nm', label: 'kg-cm → Nm' }
                ]
            },
            frequency: {
                units: [
                    { id: 'Hz', name: 'Hertz (Hz)', toBase: 1 },
                    { id: 'kHz', name: 'Kilohertz (kHz)', toBase: 1000 },
                    { id: 'MHz', name: 'Megahertz (MHz)', toBase: 1000000 },
                    { id: 'GHz', name: 'Gigahertz (GHz)', toBase: 1000000000 },
                    { id: 'THz', name: 'Terahertz (THz)', toBase: 1000000000000 }
                ],
                quickChips: [
                    { from: 'MHz', to: 'GHz', label: 'MHz → GHz' },
                    { from: 'GHz', to: 'MHz', label: 'GHz → MHz' },
                    { from: 'kHz', to: 'MHz', label: 'kHz → MHz' },
                    { from: 'MHz', to: 'kHz', label: 'MHz → kHz' }
                ]
            },
            datarate: {
                units: [
                    { id: 'bps', name: 'Bit/s (bps)', toBase: 1 },
                    { id: 'Kbps', name: 'Kilobit/s (Kbps)', toBase: 1000 },
                    { id: 'Mbps', name: 'Megabit/s (Mbps)', toBase: 1000000 },
                    { id: 'Gbps', name: 'Gigabit/s (Gbps)', toBase: 1000000000 },
                    { id: 'Bps', name: 'Byte/s (Bps)', toBase: 8 },
                    { id: 'KBps', name: 'Kilobyte/s (KBps)', toBase: 8000 },
                    { id: 'MBps', name: 'Megabyte/s (MBps)', toBase: 8000000 },
                    { id: 'GBps', name: 'Gigabyte/s (GBps)', toBase: 8000000000 }
                ],
                quickChips: [
                    { from: 'Mbps', to: 'MBps', label: 'Mbps → MB/s' },
                    { from: 'MBps', to: 'Mbps', label: 'MB/s → Mbps' },
                    { from: 'Gbps', to: 'GBps', label: 'Gbps → GB/s' },
                    { from: 'GBps', to: 'Gbps', label: 'GB/s → Gbps' }
                ]
            }
        };

        /**
         * Calculate unit conversion
         */
        function calculateUnits(category, value, fromUnit, toUnit) {
            if (!value || value === '' || isNaN(value)) {
                return {
                    inputValue: value,
                    inputUnit: fromUnit,
                    outputValue: 0,
                    outputUnit: toUnit,
                    formula_display: ''
                };
            }

            const categoryData = UNIT_CATEGORIES[category];
            if (!categoryData) return null;

            const fromUnitData = categoryData.units.find(u => u.id === fromUnit);
            const toUnitData = categoryData.units.find(u => u.id === toUnit);

            if (!fromUnitData || !toUnitData) return null;

            let outputValue = 0;
            let formula_display = '';

            // Special handling for temperature
            if (category === 'temperature') {
                const numValue = parseFloat(value);
                
                // Convert to Celsius first
                let celsius = 0;
                if (fromUnit === 'C') {
                    celsius = numValue;
                } else if (fromUnit === 'F') {
                    celsius = (numValue - 32) * 5 / 9;
                } else if (fromUnit === 'K') {
                    celsius = numValue - 273.15;
                }

                // Convert from Celsius to target
                if (toUnit === 'C') {
                    outputValue = celsius;
                    formula_display = `${value} ${fromUnit === 'F' ? '°F' : fromUnit === 'K' ? 'K' : '°C'} ${fromUnit === 'F' ? '− 32 × 5/9' : fromUnit === 'K' ? '− 273.15' : ''} = ${outputValue.toFixed(2)} °C`;
                } else if (toUnit === 'F') {
                    outputValue = (celsius * 9 / 5) + 32;
                    formula_display = `${value} ${fromUnit === 'C' ? '°C' : fromUnit === 'K' ? 'K' : '°F'} ${fromUnit === 'C' ? '× 9/5 + 32' : fromUnit === 'K' ? '− 273.15 × 9/5 + 32' : '− 32 × 5/9 × 9/5 + 32'} = ${outputValue.toFixed(2)} °F`;
                } else if (toUnit === 'K') {
                    outputValue = celsius + 273.15;
                    formula_display = `${value} ${fromUnit === 'C' ? '°C' : fromUnit === 'F' ? '°F' : 'K'} ${fromUnit === 'C' ? '+ 273.15' : fromUnit === 'F' ? '− 32 × 5/9 + 273.15' : ''} = ${outputValue.toFixed(2)} K`;
                }
            } else {
                // Standard conversion via base unit
                const valueInBase = parseFloat(value) * fromUnitData.toBase;
                outputValue = valueInBase / toUnitData.toBase;
                
                // Format formula display
                const factor = fromUnitData.toBase / toUnitData.toBase;
                if (factor === 1) {
                    formula_display = `${value} ${fromUnitData.name} = ${outputValue.toFixed(4)} ${toUnitData.name}`;
                } else if (factor < 1) {
                    formula_display = `${value} ${fromUnitData.name} ÷ ${(1/factor).toFixed(4)} = ${outputValue.toFixed(4)} ${toUnitData.name}`;
                } else {
                    formula_display = `${value} ${fromUnitData.name} × ${factor.toFixed(4)} = ${outputValue.toFixed(4)} ${toUnitData.name}`;
                }
            }

            // Round to appropriate decimal places
            let roundedValue = outputValue;
            if (category === 'temperature') {
                roundedValue = Math.round(outputValue * 100) / 100; // 2 decimals
            } else if (category === 'digital') {
                roundedValue = Math.round(outputValue * 1000) / 1000; // 3 decimals
            } else {
                roundedValue = Math.round(outputValue * 10000) / 10000; // 4 decimals
            }

            return {
                inputValue: parseFloat(value),
                inputUnit: fromUnit,
                outputValue: roundedValue,
                outputUnit: toUnit,
                formula_display: formula_display
            };
        }

        /**
         * Update units dropdowns when category changes
         */
        function updateUnitsForCategory() {
            const category = document.getElementById('units-category').value;
            const categoryData = UNIT_CATEGORIES[category];
            
            if (!categoryData) return;

            const fromSelect = document.getElementById('units-from-unit');
            const toSelect = document.getElementById('units-to-unit');

            // Clear existing options
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';

            // Populate with new units
            categoryData.units.forEach(unit => {
                const option1 = document.createElement('option');
                option1.value = unit.id;
                option1.textContent = unit.name;
                fromSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = unit.id;
                option2.textContent = unit.name;
                toSelect.appendChild(option2);
            });

            // Set default selections (first and second unit)
            if (categoryData.units.length >= 2) {
                fromSelect.value = categoryData.units[0].id;
                toSelect.value = categoryData.units[1].id;
            }

            // Update quick chips
            updateQuickChips(category);

            // Reset and convert
            document.getElementById('units-from-value').value = '1';
            convertUnits('from');
        }

        /**
         * Update quick-select chips
         */
        function updateQuickChips(category) {
            const chipsContainer = document.getElementById('units-quick-chips');
            chipsContainer.innerHTML = '';

            const categoryData = UNIT_CATEGORIES[category];
            if (!categoryData || !categoryData.quickChips) return;

            categoryData.quickChips.forEach(chip => {
                const chipButton = document.createElement('button');
                chipButton.type = 'button';
                chipButton.className = 'px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm touch-target transition-all';
                chipButton.textContent = chip.label;
                chipButton.onclick = () => {
                    document.getElementById('units-from-unit').value = chip.from;
                    document.getElementById('units-to-unit').value = chip.to;
                    convertUnits('from');
                };
                chipsContainer.appendChild(chipButton);
            });
        }

        /**
         * Convert units (bi-directional)
         */
        function convertUnits(direction) {
            const category = document.getElementById('units-category').value;
            const fromUnit = document.getElementById('units-from-unit').value;
            const toUnit = document.getElementById('units-to-unit').value;

            let inputValue, outputValue, result;

            if (direction === 'from') {
                inputValue = document.getElementById('units-from-value').value;
                result = calculateUnits(category, inputValue, fromUnit, toUnit);
                
                if (result) {
                    document.getElementById('units-to-value').value = result.outputValue;
                    updateFormulaDisplay(result);
                }
            } else {
                // Convert from 'to' field to 'from' field
                outputValue = document.getElementById('units-to-value').value;
                result = calculateUnits(category, outputValue, toUnit, fromUnit);
                
                if (result) {
                    document.getElementById('units-from-value').value = result.outputValue;
                    // Reverse formula display
                    const reversedResult = {
                        ...result,
                        inputUnit: toUnit,
                        outputUnit: fromUnit,
                        formula_display: result.formula_display.replace(result.inputUnit, toUnit).replace(result.outputUnit, fromUnit)
                    };
                    updateFormulaDisplay(reversedResult);
                }
            }
        }

        /**
         * Update formula display
         */
        function updateFormulaDisplay(result) {
            const formulaDisplay = document.getElementById('units-formula-display');
            const formulaText = document.getElementById('formula-text');
            
            if (result.formula_display) {
                formulaText.textContent = result.formula_display;
                formulaDisplay.classList.remove('hidden');
            } else {
                formulaDisplay.classList.add('hidden');
            }
        }

        /**
         * Swap units
         */
        function swapUnits() {
            const fromUnit = document.getElementById('units-from-unit').value;
            const toUnit = document.getElementById('units-to-unit').value;
            const fromValue = document.getElementById('units-from-value').value;
            const toValue = document.getElementById('units-to-value').value;

            // Swap units
            document.getElementById('units-from-unit').value = toUnit;
            document.getElementById('units-to-unit').value = fromUnit;

            // Swap values
            document.getElementById('units-from-value').value = toValue;
            document.getElementById('units-to-value').value = fromValue;

            // Recalculate
            convertUnits('from');
        }

        /**
         * Initialize units converter when view is shown
         */
        function initializeUnits() {
            updateUnitsForCategory();
        }

        /**
         * Speed Converter Functions
         */

        // Conversion factors relative to km/h
        const SPEED_CONVERSIONS = {
            kmh: 1,
            mph: 1.60934,
            ms: 3.6,
            kn: 1.852,
            mach: 1234.8
        };

        /**
         * Convert pace (MM:SS) to decimal minutes
         */
        function paceToDecimal(paceString) {
            if (!paceString || typeof paceString !== 'string') return null;
            
            const parts = paceString.split(':');
            if (parts.length !== 2) return null;
            
            const minutes = parseInt(parts[0], 10);
            const seconds = parseInt(parts[1], 10);
            
            if (isNaN(minutes) || isNaN(seconds) || seconds >= 60) return null;
            
            return minutes + (seconds / 60);
        }

        /**
         * Convert decimal minutes to pace (MM:SS)
         */
        function decimalToPace(decimalMinutes) {
            if (isNaN(decimalMinutes) || decimalMinutes <= 0) return null;
            
            const minutes = Math.floor(decimalMinutes);
            const seconds = Math.round((decimalMinutes - minutes) * 60);
            
            // Handle seconds overflow
            if (seconds >= 60) {
                return `${minutes + 1}:00`;
            }
            
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        /**
         * Convert pace (min/km) to km/h
         */
        function paceToKmh(paceMinutes) {
            if (!paceMinutes || paceMinutes <= 0) return 0;
            return 60 / paceMinutes;
        }

        /**
         * Convert km/h to pace (min/km)
         */
        function kmhToPace(kmh) {
            if (!kmh || kmh <= 0) return null;
            return 60 / kmh;
        }

        /**
         * Calculate speed conversion
         */
        function calculateSpeed(value, fromUnit, toUnit) {
            if (!value || value === '' || (fromUnit !== 'pace' && isNaN(value))) {
                return {
                    inputValue: value,
                    inputUnit: fromUnit,
                    outputValue: 0,
                    outputUnit: toUnit,
                    displayString: '-',
                    context_note: ''
                };
            }

            let kmhValue = 0;
            let contextNote = '';

            // Convert input to km/h
            if (fromUnit === 'pace') {
                // Handle MM:SS format
                const decimalMinutes = paceToDecimal(value);
                if (decimalMinutes === null) {
                    return {
                        inputValue: value,
                        inputUnit: fromUnit,
                        outputValue: 0,
                        outputUnit: toUnit,
                        displayString: 'Ungültiges Format',
                        context_note: 'Bitte Format "MM:SS" verwenden (z.B. "5:30")'
                    };
                }
                kmhValue = paceToKmh(decimalMinutes);
            } else if (fromUnit === 'kmh') {
                kmhValue = parseFloat(value);
            } else {
                const factor = SPEED_CONVERSIONS[fromUnit];
                if (!factor) return null;
                kmhValue = parseFloat(value) * factor;
            }

            // Convert from km/h to target unit
            let outputValue = 0;
            let displayString = '';
            let formulaDisplay = '';

            if (toUnit === 'pace') {
                const paceMinutes = kmhToPace(kmhValue);
                if (paceMinutes === null) {
                    displayString = 'Ungültig';
                } else {
                    const paceString = decimalToPace(paceMinutes);
                    outputValue = paceMinutes;
                    displayString = `${paceString} min/km`;
                    formulaDisplay = `60 ÷ ${kmhValue.toFixed(2)} km/h = ${paceString} min/km`;
                    contextNote = 'Laufgeschwindigkeit';
                }
            } else if (toUnit === 'kmh') {
                outputValue = kmhValue;
                displayString = `${outputValue.toFixed(2)} km/h`;
                formulaDisplay = `${value} ${fromUnit === 'pace' ? 'min/km' : fromUnit} = ${outputValue.toFixed(2)} km/h`;
                contextNote = 'Standard Geschwindigkeit';
            } else {
                const factor = SPEED_CONVERSIONS[toUnit];
                if (!factor) return null;
                outputValue = kmhValue / factor;
                
                const unitNames = {
                    mph: 'mph',
                    ms: 'm/s',
                    kn: 'kn',
                    mach: 'Mach'
                };
                
                displayString = `${outputValue.toFixed(2)} ${unitNames[toUnit]}`;
                formulaDisplay = `${kmhValue.toFixed(2)} km/h ÷ ${factor} = ${outputValue.toFixed(2)} ${unitNames[toUnit]}`;
                
                // Context notes
                if (toUnit === 'mph') {
                    contextNote = 'Typische Reisegeschwindigkeit auf US-Highways';
                } else if (toUnit === 'kn') {
                    contextNote = 'Schifffahrt/Luftfahrt';
                } else if (toUnit === 'mach') {
                    contextNote = 'Schallgeschwindigkeit';
                } else {
                    contextNote = 'Wissenschaftliche Einheit';
                }
            }

            return {
                inputValue: value,
                inputUnit: fromUnit,
                outputValue: outputValue,
                outputUnit: toUnit,
                displayString: displayString,
                context_note: contextNote,
                formula_display: formulaDisplay
            };
        }

        /**
         * Handle speed input changes
         */
        function handleSpeedInput() {
            const inputValue = document.getElementById('speed-input-value').value;
            const fromUnit = document.getElementById('speed-from-unit').value;
            const toUnit = document.getElementById('speed-to-unit').value;

            const result = calculateSpeed(inputValue, fromUnit, toUnit);
            
            if (result) {
                // Format output value based on unit type
                let outputDisplay = '-';
                if (result.outputUnit === 'pace' && result.outputValue > 0) {
                    outputDisplay = decimalToPace(result.outputValue) || '-';
                } else if (result.outputValue > 0) {
                    outputDisplay = result.outputValue.toFixed(2);
                } else if (result.displayString && result.displayString !== '-') {
                    outputDisplay = result.displayString;
                }
                document.getElementById('speed-output-value').value = outputDisplay;
                document.getElementById('speed-display-result').textContent = result.displayString;
                document.getElementById('speed-context-note').textContent = result.context_note;
                document.getElementById('speed-formula-display').textContent = result.formula_display || '';
                document.getElementById('speed-results').classList.remove('hidden');

                // Update hints
                const inputHint = document.getElementById('speed-input-hint');
                const outputHint = document.getElementById('speed-output-hint');
                
                if (fromUnit === 'pace') {
                    inputHint.textContent = 'Format: "5:30" (Minuten:Sekunden)';
                    inputHint.classList.remove('hidden');
                } else {
                    inputHint.textContent = '';
                }

                if (toUnit === 'pace') {
                    outputHint.textContent = 'Format: "MM:SS" (Minuten:Sekunden)';
                    outputHint.classList.remove('hidden');
                } else {
                    outputHint.textContent = '';
                }

                // Update visual feedback
                updateSpeedVisualFeedback(fromUnit, toUnit);
            }
        }

        /**
         * Update visual feedback icons
         */
        function updateSpeedVisualFeedback(fromUnit, toUnit) {
            // Remove active states
            document.querySelectorAll('[id^="scenario-"]').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'border-blue-400');
                btn.classList.add('bg-blue-600/30', 'border-blue-500/50');
            });

            // Check if pace is involved (joggen scenario)
            if (fromUnit === 'pace' || toUnit === 'pace') {
                const joggenBtn = document.getElementById('scenario-joggen');
                if (joggenBtn) {
                    joggenBtn.classList.add('bg-blue-600', 'border-blue-400');
                    joggenBtn.classList.remove('bg-blue-600/30', 'border-blue-500/50');
                }
            }
            // Check if mph/kmh (auto scenario)
            else if ((fromUnit === 'kmh' && toUnit === 'mph') || (fromUnit === 'mph' && toUnit === 'kmh')) {
                const autoBtn = document.getElementById('scenario-auto');
                if (autoBtn) {
                    autoBtn.classList.add('bg-blue-600', 'border-blue-400');
                    autoBtn.classList.remove('bg-blue-600/30', 'border-blue-500/50');
                }
            }
            // Check if knots (segeln scenario)
            else if (fromUnit === 'kn' || toUnit === 'kn') {
                const segelnBtn = document.getElementById('scenario-segeln');
                if (segelnBtn) {
                    segelnBtn.classList.add('bg-blue-600', 'border-blue-400');
                    segelnBtn.classList.remove('bg-blue-600/30', 'border-blue-500/50');
                }
            }
        }

        /**
         * Set speed scenario (quick action)
         */
        function setSpeedScenario(scenario) {
            const fromSelect = document.getElementById('speed-from-unit');
            const toSelect = document.getElementById('speed-to-unit');
            const inputValue = document.getElementById('speed-input-value');

            // Reset all scenario buttons
            document.querySelectorAll('[id^="scenario-"]').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'border-blue-400');
                btn.classList.add('bg-blue-600/30', 'border-blue-500/50');
            });

            // Activate selected scenario button
            const scenarioBtn = document.getElementById(`scenario-${scenario}`);
            if (scenarioBtn) {
                scenarioBtn.classList.add('bg-blue-600', 'border-blue-400');
                scenarioBtn.classList.remove('bg-blue-600/30', 'border-blue-500/50');
            }

            if (scenario === 'auto') {
                fromSelect.value = 'kmh';
                toSelect.value = 'mph';
                inputValue.value = '100';
            } else if (scenario === 'joggen') {
                fromSelect.value = 'kmh';
                toSelect.value = 'pace';
                inputValue.value = '10';
            } else if (scenario === 'segeln') {
                fromSelect.value = 'kmh';
                toSelect.value = 'kn';
                inputValue.value = '20';
            }

            handleSpeedInput();
        }

        /**
         * Swap speed units
         */
        function swapSpeedUnits() {
            const fromUnit = document.getElementById('speed-from-unit').value;
            const toUnit = document.getElementById('speed-to-unit').value;
            const inputValue = document.getElementById('speed-input-value').value;
            const outputValue = document.getElementById('speed-output-value').value;

            // Swap units
            document.getElementById('speed-from-unit').value = toUnit;
            document.getElementById('speed-to-unit').value = fromUnit;

            // Swap values (handle pace format)
            if (toUnit === 'pace') {
                // Output is pace format, use it directly
                document.getElementById('speed-input-value').value = outputValue;
            } else {
                document.getElementById('speed-input-value').value = outputValue;
            }

            handleSpeedInput();
        }

        /**
         * Initialize speed converter when view is shown
         */
        function initializeSpeed() {
            handleSpeedInput();
        }

        /**
         * Flächenrechner Functions
         */

        // Area conversion factors relative to m²
        const AREA_CONVERSIONS = {
            m2: 1,
            ha: 10000,
            km2: 1000000,
            cm2: 0.0001,
            ft2: 0.092903,
            ac: 4046.86
        };

        // Real-world reference objects (in m²)
        const AREA_REFERENCES = {
            pingpong: { name: 'Ping-Pong Tisch', area: 4.2, icon: '🏓' },
            parking: { name: 'Parkplatz', area: 12.5, icon: '🅿️' },
            tennis: { name: 'Tennisplatz', area: 260, icon: '🎾' },
            football: { name: 'Fußballfeld (FIFA)', area: 7140, icon: '⚽' },
            saarland: { name: 'Das Saarland', area: 2570000000, icon: '🇩🇪' }
        };

        /**
         * Set flaeche mode (convert or calculate)
         */
        function setFlaecheMode(mode) {
            const convertTab = document.getElementById('flaeche-tab-convert');
            const calculateTab = document.getElementById('flaeche-tab-calculate');
            const convertMode = document.getElementById('flaeche-convert-mode');
            const calculateMode = document.getElementById('flaeche-calculate-mode');

            if (mode === 'convert') {
                convertTab.classList.add('text-blue-200', 'border-blue-500', 'font-semibold');
                convertTab.classList.remove('text-slate-400', 'border-transparent');
                calculateTab.classList.add('text-slate-400', 'border-transparent');
                calculateTab.classList.remove('text-blue-200', 'border-blue-500', 'font-semibold');
                convertMode.classList.remove('hidden');
                calculateMode.classList.add('hidden');
                handleFlaecheConvert();
            } else {
                calculateTab.classList.add('text-blue-200', 'border-blue-500', 'font-semibold');
                calculateTab.classList.remove('text-slate-400', 'border-transparent');
                convertTab.classList.add('text-slate-400', 'border-transparent');
                convertTab.classList.remove('text-blue-200', 'border-blue-500', 'font-semibold');
                calculateMode.classList.remove('hidden');
                convertMode.classList.add('hidden');
                handleFlaecheGeometry();
            }
        }

        /**
         * Handle area conversion
         */
        function handleFlaecheConvert() {
            const inputValue = parseFloat(document.getElementById('flaeche-from-value').value);
            const fromUnit = document.getElementById('flaeche-from-unit').value;
            const toUnit = document.getElementById('flaeche-to-unit').value;

            if (isNaN(inputValue) || inputValue < 0) {
                document.getElementById('flaeche-to-value').value = '';
                document.getElementById('flaeche-comparison').classList.add('hidden');
                return;
            }

            // Convert to m² first
            const valueInM2 = inputValue * AREA_CONVERSIONS[fromUnit];
            
            // Convert from m² to target unit
            const outputValue = valueInM2 / AREA_CONVERSIONS[toUnit];
            
            // Format output
            let formattedValue = outputValue;
            if (outputValue >= 1000000) {
                formattedValue = outputValue.toFixed(2);
            } else if (outputValue >= 1000) {
                formattedValue = outputValue.toFixed(2);
            } else if (outputValue >= 1) {
                formattedValue = outputValue.toFixed(2);
            } else {
                formattedValue = outputValue.toFixed(4);
            }

            document.getElementById('flaeche-to-value').value = formattedValue;

            // Show real-world comparison
            showFlaecheComparison(valueInM2);
        }

        /**
         * Swap area units
         */
        function swapFlaecheUnits() {
            const fromUnit = document.getElementById('flaeche-from-unit').value;
            const toUnit = document.getElementById('flaeche-to-unit').value;
            const fromValue = document.getElementById('flaeche-from-value').value;
            const toValue = document.getElementById('flaeche-to-value').value;

            document.getElementById('flaeche-from-unit').value = toUnit;
            document.getElementById('flaeche-to-unit').value = fromUnit;
            document.getElementById('flaeche-from-value').value = toValue;
            document.getElementById('flaeche-to-value').value = fromValue;

            handleFlaecheConvert();
        }

        /**
         * Handle geometry calculation
         */
        function handleFlaecheGeometry() {
            const shape = document.querySelector('input[name="flaeche-shape"]:checked').value;
            const rectInputs = document.getElementById('flaeche-rectangle-inputs');
            const circleInputs = document.getElementById('flaeche-circle-inputs');
            const resultDiv = document.getElementById('flaeche-geometry-result');

            // Show/hide appropriate inputs
            if (shape === 'rectangle') {
                rectInputs.classList.remove('hidden');
                circleInputs.classList.add('hidden');
            } else {
                rectInputs.classList.add('hidden');
                circleInputs.classList.remove('hidden');
            }

            let area = 0;
            let isValid = true;

            if (shape === 'rectangle') {
                const length = parseFloat(document.getElementById('flaeche-length').value);
                const width = parseFloat(document.getElementById('flaeche-width').value);
                
                if (isNaN(length) || isNaN(width) || length <= 0 || width <= 0) {
                    isValid = false;
                } else {
                    area = length * width;
                    renderRectanglePreview(length, width);
                }
            } else {
                const radius = parseFloat(document.getElementById('flaeche-radius').value);
                
                if (isNaN(radius) || radius <= 0) {
                    isValid = false;
                } else {
                    area = Math.PI * radius * radius;
                    renderCirclePreview(radius);
                }
            }

            if (isValid && area > 0) {
                document.getElementById('flaeche-geometry-area').textContent = `${area.toFixed(2)} m²`;
                resultDiv.classList.remove('hidden');
                showFlaecheComparison(area);
            } else {
                resultDiv.classList.add('hidden');
                document.getElementById('flaeche-comparison').classList.add('hidden');
                // Clear preview
                document.getElementById('flaeche-shape-preview').innerHTML = '';
            }
        }

        /**
         * Render rectangle preview
         */
        function renderRectanglePreview(length, width) {
            const preview = document.getElementById('flaeche-shape-preview');
            
            // Calculate aspect ratio and scale for display
            const maxSize = 180; // Max width/height in pixels
            const aspectRatio = length / width;
            
            let displayWidth, displayHeight;
            if (aspectRatio >= 1) {
                displayWidth = maxSize;
                displayHeight = maxSize / aspectRatio;
            } else {
                displayHeight = maxSize;
                displayWidth = maxSize * aspectRatio;
            }

            preview.innerHTML = `
                <div class="relative">
                    <div 
                        class="bg-blue-500/50 border-2 border-blue-400 rounded"
                        style="width: ${displayWidth}px; height: ${displayHeight}px;"
                    ></div>
                    <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-blue-200 whitespace-nowrap">
                        ${length.toFixed(2)} m × ${width.toFixed(2)} m
                    </div>
                </div>
            `;
        }

        /**
         * Render circle preview
         */
        function renderCirclePreview(radius) {
            const preview = document.getElementById('flaeche-shape-preview');
            
            const maxSize = 180;
            const diameter = Math.min(radius * 20, maxSize); // Scale factor

            preview.innerHTML = `
                <div class="relative">
                    <div 
                        class="bg-blue-500/50 border-2 border-blue-400 rounded-full mx-auto"
                        style="width: ${diameter}px; height: ${diameter}px;"
                    ></div>
                    <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-blue-200 whitespace-nowrap">
                        r = ${radius.toFixed(2)} m
                    </div>
                </div>
            `;
        }

        /**
         * Show real-world comparison
         */
        function showFlaecheComparison(areaM2) {
            const comparisonDiv = document.getElementById('flaeche-comparison');
            const contentDiv = document.getElementById('flaeche-comparison-content');
            
            if (!areaM2 || areaM2 <= 0) {
                comparisonDiv.classList.add('hidden');
                return;
            }

            comparisonDiv.classList.remove('hidden');
            contentDiv.innerHTML = '';

            // Determine appropriate reference based on area size
            let comparisons = [];

            if (areaM2 < 20) {
                // Small areas: compare to ping-pong tables
                const count = areaM2 / AREA_REFERENCES.pingpong.area;
                comparisons.push({
                    ...AREA_REFERENCES.pingpong,
                    count: count
                });
            } else if (areaM2 < 100) {
                // Medium-small: parking spaces
                const count = areaM2 / AREA_REFERENCES.parking.area;
                comparisons.push({
                    ...AREA_REFERENCES.parking,
                    count: count
                });
            } else if (areaM2 < 5000) {
                // Medium: tennis courts
                const count = areaM2 / AREA_REFERENCES.tennis.area;
                comparisons.push({
                    ...AREA_REFERENCES.tennis,
                    count: count
                });
            } else if (areaM2 < 1000000000) {
                // Large: football fields
                const count = areaM2 / AREA_REFERENCES.football.area;
                comparisons.push({
                    ...AREA_REFERENCES.football,
                    count: count
                });
            } else {
                // Very large: Saarland (German meme unit)
                const count = areaM2 / AREA_REFERENCES.saarland.area;
                comparisons.push({
                    ...AREA_REFERENCES.saarland,
                    count: count
                });
            }

            // Also show a secondary comparison if relevant
            if (areaM2 >= 20 && areaM2 < 100) {
                const pingpongCount = areaM2 / AREA_REFERENCES.pingpong.area;
                if (pingpongCount > 1) {
                    comparisons.push({
                        ...AREA_REFERENCES.pingpong,
                        count: pingpongCount
                    });
                }
            } else if (areaM2 >= 100 && areaM2 < 5000) {
                const parkingCount = areaM2 / AREA_REFERENCES.parking.area;
                comparisons.push({
                    ...AREA_REFERENCES.parking,
                    count: parkingCount
                });
            } else if (areaM2 >= 5000 && areaM2 < 1000000000) {
                const tennisCount = areaM2 / AREA_REFERENCES.tennis.area;
                if (tennisCount > 1) {
                    comparisons.push({
                        ...AREA_REFERENCES.tennis,
                        count: tennisCount
                    });
                }
            }

            // Display comparisons
            comparisons.forEach(comp => {
                const count = comp.count;
                let displayText = '';
                
                if (count < 0.1) {
                    displayText = `Weniger als 0,1 ${comp.name}`;
                } else if (count < 1) {
                    displayText = `Etwa ${(count * 100).toFixed(0)}% eines ${comp.name}s`;
                } else if (count < 2) {
                    displayText = `Etwa 1 ${comp.name}`;
                } else if (count < 10) {
                    displayText = `Etwa ${count.toFixed(1)} ${comp.name}e`;
                } else {
                    displayText = `Etwa ${Math.round(count).toLocaleString('de-DE')} ${comp.name}e`;
                }

                const comparisonItem = document.createElement('div');
                comparisonItem.className = 'flex items-center gap-2 text-blue-200';
                comparisonItem.innerHTML = `
                    <span class="text-xl">${comp.icon}</span>
                    <span>${displayText}</span>
                `;
                contentDiv.appendChild(comparisonItem);
            });
        }

        /**
         * Initialize flaeche calculator when view is shown
         */
        function initializeFlaeche() {
            setFlaecheMode('convert');
        }

        /**
         * Kleidergrößen Umrechner Functions
         */

        // Comprehensive size lookup tables
        const SIZE_DATA = {
            damen: {
                konfektion: {
                    sizes: [
                        { EU: '32', US: '2', UK: '4', IT: '36', Int: 'XXS' },
                        { EU: '34', US: '4', UK: '6', IT: '38', Int: 'XS' },
                        { EU: '36', US: '6', UK: '8', IT: '40', Int: 'S' },
                        { EU: '38', US: '8', UK: '10', IT: '42', Int: 'M' },
                        { EU: '40', US: '10', UK: '12', IT: '44', Int: 'L' },
                        { EU: '42', US: '12', UK: '14', IT: '46', Int: 'XL' },
                        { EU: '44', US: '14', UK: '16', IT: '48', Int: 'XXL' },
                        { EU: '46', US: '16', UK: '18', IT: '50', Int: '3XL' },
                        { EU: '48', US: '18', UK: '20', IT: '52', Int: '3XL' }
                    ],
                    measurements: {
                        '32': 'Brustumfang ca. 78-81 cm',
                        '34': 'Brustumfang ca. 82-85 cm',
                        '36': 'Brustumfang ca. 86-89 cm',
                        '38': 'Brustumfang ca. 90-93 cm',
                        '40': 'Brustumfang ca. 94-97 cm',
                        '42': 'Brustumfang ca. 98-101 cm',
                        '44': 'Brustumfang ca. 102-105 cm',
                        '46': 'Brustumfang ca. 106-109 cm',
                        '48': 'Brustumfang ca. 110-113 cm'
                    }
                },
                hosen: {
                    sizes: [
                        { EU: '32', US: '2', UK: '4', IT: '36', Int: 'XS' },
                        { EU: '34', US: '4', UK: '6', IT: '38', Int: 'S' },
                        { EU: '36', US: '6', UK: '8', IT: '40', Int: 'M' },
                        { EU: '38', US: '8', UK: '10', IT: '42', Int: 'L' },
                        { EU: '40', US: '10', UK: '12', IT: '44', Int: 'XL' },
                        { EU: '42', US: '12', UK: '14', IT: '46', Int: 'XXL' }
                    ],
                    measurements: {
                        '32': 'Taillenumfang ca. 64-67 cm',
                        '34': 'Taillenumfang ca. 68-71 cm',
                        '36': 'Taillenumfang ca. 72-75 cm',
                        '38': 'Taillenumfang ca. 76-79 cm',
                        '40': 'Taillenumfang ca. 80-83 cm',
                        '42': 'Taillenumfang ca. 84-87 cm'
                    }
                },
                schuhe: {
                    sizes: [
                        { EU: '36', US: '5.5', UK: '3.5', IT: '36', Int: '36' },
                        { EU: '37', US: '6', UK: '4', IT: '37', Int: '37' },
                        { EU: '38', US: '7', UK: '5', IT: '38', Int: '38' },
                        { EU: '39', US: '7.5', UK: '5.5', IT: '39', Int: '39' },
                        { EU: '40', US: '8.5', UK: '6.5', IT: '40', Int: '40' },
                        { EU: '41', US: '9', UK: '7', IT: '41', Int: '41' },
                        { EU: '42', US: '10', UK: '8', IT: '42', Int: '42' }
                    ],
                    measurements: {}
                }
            },
            herren: {
                konfektion: {
                    sizes: [
                        { EU: '44', US: '34', UK: '34', IT: '44', Int: 'S' },
                        { EU: '46', US: '36', UK: '36', IT: '46', Int: 'M' },
                        { EU: '48', US: '38', UK: '38', IT: '48', Int: 'L' },
                        { EU: '50', US: '40', UK: '40', IT: '50', Int: 'XL' },
                        { EU: '52', US: '42', UK: '42', IT: '52', Int: 'XXL' },
                        { EU: '54', US: '44', UK: '44', IT: '54', Int: '3XL' },
                        { EU: '56', US: '46', UK: '46', IT: '56', Int: '3XL' },
                        { EU: '58', US: '48', UK: '48', IT: '58', Int: '3XL' }
                    ],
                    measurements: {
                        '44': 'Brustumfang ca. 88-92 cm',
                        '46': 'Brustumfang ca. 96-100 cm',
                        '48': 'Brustumfang ca. 104-108 cm',
                        '50': 'Brustumfang ca. 112-116 cm',
                        '52': 'Brustumfang ca. 120-124 cm',
                        '54': 'Brustumfang ca. 128-132 cm',
                        '56': 'Brustumfang ca. 136-140 cm',
                        '58': 'Brustumfang ca. 144-148 cm'
                    }
                },
                hosen: {
                    sizes: [
                        { EU: '44', US: '30', UK: '30', IT: '44', Int: 'S' },
                        { EU: '46', US: '32', UK: '32', IT: '46', Int: 'M' },
                        { EU: '48', US: '34', UK: '34', IT: '48', Int: 'L' },
                        { EU: '50', US: '36', UK: '36', IT: '50', Int: 'XL' },
                        { EU: '52', US: '38', UK: '38', IT: '52', Int: 'XXL' },
                        { EU: '54', US: '40', UK: '40', IT: '54', Int: 'XXL' }
                    ],
                    measurements: {
                        '44': 'Taillenumfang ca. 76-80 cm',
                        '46': 'Taillenumfang ca. 80-84 cm',
                        '48': 'Taillenumfang ca. 84-88 cm',
                        '50': 'Taillenumfang ca. 88-92 cm',
                        '52': 'Taillenumfang ca. 92-96 cm',
                        '54': 'Taillenumfang ca. 96-100 cm'
                    }
                },
                schuhe: {
                    sizes: [
                        { EU: '40', US: '7', UK: '6', IT: '40', Int: '40' },
                        { EU: '41', US: '8', UK: '7', IT: '41', Int: '41' },
                        { EU: '42', US: '9', UK: '8', IT: '42', Int: '42' },
                        { EU: '43', US: '9.5', UK: '8.5', IT: '43', Int: '43' },
                        { EU: '44', US: '10.5', UK: '9.5', IT: '44', Int: '44' },
                        { EU: '45', US: '11.5', UK: '10.5', IT: '45', Int: '45' },
                        { EU: '46', US: '12', UK: '11', IT: '46', Int: '46' },
                        { EU: '47', US: '13', UK: '12', IT: '47', Int: '47' },
                        { EU: '48', US: '13.5', UK: '12.5', IT: '48', Int: '48' }
                    ],
                    measurements: {}
                }
            },
            kinder: {
                konfektion: {
                    sizes: [
                        { EU: '92', US: '2T', UK: '2', IT: '92', Int: '92' },
                        { EU: '98', US: '3T', UK: '3', IT: '98', Int: '98' },
                        { EU: '104', US: '4T', UK: '4', IT: '104', Int: '104' },
                        { EU: '110', US: '5', UK: '5', IT: '110', Int: '110' },
                        { EU: '116', US: '6', UK: '6', IT: '116', Int: '116' },
                        { EU: '122', US: '7', UK: '7', IT: '122', Int: '122' },
                        { EU: '128', US: '8', UK: '8', IT: '128', Int: '128' },
                        { EU: '134', US: '10', UK: '10', IT: '134', Int: '134' },
                        { EU: '140', US: '12', UK: '12', IT: '140', Int: '140' }
                    ],
                    measurements: {}
                },
                hosen: {
                    sizes: [
                        { EU: '92', US: '2T', UK: '2', IT: '92', Int: '92' },
                        { EU: '98', US: '3T', UK: '3', IT: '98', Int: '98' },
                        { EU: '104', US: '4T', UK: '4', IT: '104', Int: '104' },
                        { EU: '110', US: '5', UK: '5', IT: '110', Int: '110' },
                        { EU: '116', US: '6', UK: '6', IT: '116', Int: '116' },
                        { EU: '122', US: '7', UK: '7', IT: '122', Int: '122' }
                    ],
                    measurements: {}
                },
                schuhe: {
                    sizes: [
                        { EU: '25', US: '8', UK: '7', IT: '25', Int: '25' },
                        { EU: '26', US: '9', UK: '8', IT: '26', Int: '26' },
                        { EU: '27', US: '10', UK: '9', IT: '27', Int: '27' },
                        { EU: '28', US: '11', UK: '10', IT: '28', Int: '28' },
                        { EU: '29', US: '12', UK: '11', IT: '29', Int: '29' },
                        { EU: '30', US: '13', UK: '12', IT: '30', Int: '30' },
                        { EU: '31', US: '1', UK: '13', IT: '31', Int: '31' },
                        { EU: '32', US: '2', UK: '1', IT: '32', Int: '32' },
                        { EU: '33', US: '3', UK: '2', IT: '33', Int: '33' }
                    ],
                    measurements: {}
                }
            }
        };

        // Smart tips pool
        const SMART_TIPS = {
            damen: {
                konfektion: [
                    'Italienische Größen fallen oft 1-2 Nummern kleiner aus!',
                    'Bei figurbetonter Kleidung eine Größe größer wählen.',
                    'US-Größen sind oft großzügiger als EU-Größen.',
                    'Bei Online-Käufen immer die Größentabelle des Shops prüfen.'
                ],
                hosen: [
                    'Jeans können nach dem ersten Tragen noch etwas nachgeben.',
                    'Bei Stretch-Jeans eine Nummer kleiner wählen.',
                    'US-Jeans-Größen entsprechen dem Taillenumfang in Zoll.',
                    'Hochwertige Jeans können beim ersten Waschen etwas einlaufen.'
                ],
                schuhe: [
                    'Schuhe sollten am längsten Zeh 1-1.5 cm Platz haben.',
                    'Am Nachmittag sind Füße größer - ideal zum Anprobieren!',
                    'US-Frauenschuhe sind ca. 1.5-2 Nummern größer als EU.',
                    'Bei High Heels eine halbe Größe größer wählen.'
                ]
            },
            herren: {
                konfektion: [
                    'Italienische Größen sind oft schmaler geschnitten.',
                    'US-Größen sind meist großzügiger als EU-Größen.',
                    'Bei Slim-Fit eine Größe größer wählen.',
                    'Schulterbreite ist oft wichtiger als Brustumfang.'
                ],
                hosen: [
                    'Jeans-Größen in Zoll entsprechen dem Taillenumfang.',
                    'Bei Stretch-Jeans eine Nummer kleiner wählen.',
                    'US-Größen sind oft großzügiger geschnitten.',
                    'Die Länge kann bei vielen Marken angepasst werden.'
                ],
                schuhe: [
                    'US-Herrenschuhe sind ca. 1 Nummer kleiner als EU.',
                    'Schuhe sollten am längsten Zeh 1 cm Platz haben.',
                    'Am Nachmittag sind Füße größer - ideal zum Anprobieren!',
                    'Bei Sport-Schuhen eine halbe Größe größer wählen.'
                ]
            },
            kinder: {
                konfektion: [
                    'Kinderkleidung sollte immer etwas größer gekauft werden.',
                    'EU-Größen entsprechen der Körpergröße in cm.',
                    'Kinder wachsen schnell - lieber eine Größe größer.',
                    'Bei Online-Käufen die Altersempfehlung beachten.'
                ],
                hosen: [
                    'Kinderhosen sollten am Bund etwas Spielraum haben.',
                    'EU-Größen entsprechen der Körpergröße in cm.',
                    'Bei Stretch-Materialien eine Größe kleiner wählen.',
                    'Kinder wachsen schnell - lieber etwas größer kaufen.'
                ],
                schuhe: [
                    'Kinderschuhe sollten 1-1.5 cm länger sein als der Fuß.',
                    'Kinderfüße wachsen schnell - regelmäßig nachmessen!',
                    'Am Nachmittag sind Füße größer - ideal zum Anprobieren.',
                    'Zu kleine Schuhe können die Fußentwicklung beeinträchtigen.'
                ]
            }
        };

        // Current state
        let currentGroessenGender = 'damen';
        let currentGroessenCategory = 'konfektion';
        let currentGroessenSizeIndex = 4;

        /**
         * Set gender tab
         */
        function setGroessenGender(gender) {
            currentGroessenGender = gender;
            
            // Update tab styles
            ['damen', 'herren', 'kinder'].forEach(g => {
                const btn = document.getElementById(`groessen-gender-${g}`);
                if (g === gender) {
                    btn.classList.add('text-orange-200', 'border-orange-500', 'font-semibold');
                    btn.classList.remove('text-slate-400', 'border-transparent');
                } else {
                    btn.classList.add('text-slate-400', 'border-transparent');
                    btn.classList.remove('text-orange-200', 'border-orange-500', 'font-semibold');
                }
            });

            // Reset to first category and update
            setGroessenCategory('konfektion');
        }

        /**
         * Set category tab
         */
        function setGroessenCategory(category) {
            currentGroessenCategory = category;
            
            // Update tab styles
            ['konfektion', 'hosen', 'schuhe'].forEach(c => {
                const btn = document.getElementById(`groessen-category-${c}`);
                if (c === category) {
                    btn.classList.add('text-orange-200', 'bg-orange-600/30', 'border-orange-500/50', 'font-semibold');
                    btn.classList.remove('text-slate-400', 'bg-gray-700/30', 'border-gray-600/50');
                } else {
                    btn.classList.add('text-slate-400', 'bg-gray-700/30', 'border-gray-600/50');
                    btn.classList.remove('text-orange-200', 'bg-orange-600/30', 'border-orange-500/50', 'font-semibold');
                }
            });

            // Update size options
            updateGroessenSizeOptions();
        }

        /**
         * Update size options based on current gender/category
         */
        function updateGroessenSizeOptions() {
            const data = SIZE_DATA[currentGroessenGender]?.[currentGroessenCategory];
            if (!data) return;

            const baseUnit = document.getElementById('groessen-base-unit').value;
            const slider = document.getElementById('groessen-size-slider');
            const select = document.getElementById('groessen-size-select');

            // Update slider max
            slider.max = data.sizes.length - 1;
            slider.value = Math.min(currentGroessenSizeIndex, data.sizes.length - 1);
            currentGroessenSizeIndex = parseInt(slider.value);

            // Populate select dropdown
            select.innerHTML = '';
            data.sizes.forEach((size, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${baseUnit}: ${size[baseUnit]}`;
                if (index === currentGroessenSizeIndex) {
                    option.selected = true;
                }
                select.appendChild(option);
            });

            // Update display
            handleGroessenSizeChange();
        }

        /**
         * Handle size change (from slider or dropdown)
         */
        function handleGroessenSizeChange(event) {
            const slider = document.getElementById('groessen-size-slider');
            const select = document.getElementById('groessen-size-select');
            
            // Sync slider and select
            let value;
            if (event && event.target) {
                const source = event.target.id === 'groessen-size-slider' ? slider : select;
                value = parseInt(source.value);
            } else {
                // Called programmatically - use slider value
                value = parseInt(slider.value);
            }
            
            currentGroessenSizeIndex = value;
            slider.value = value;
            select.value = value;

            // Get converted sizes
            const result = getConvertedSizes(
                currentGroessenGender,
                currentGroessenCategory,
                currentGroessenSizeIndex,
                document.getElementById('groessen-base-unit').value
            );

            displayGroessenResults(result);
        }

        /**
         * Get converted sizes
         */
        function getConvertedSizes(gender, category, sizeIndex, baseUnit) {
            const data = SIZE_DATA[gender]?.[category];
            if (!data || !data.sizes[sizeIndex]) return null;

            const sizeData = data.sizes[sizeIndex];
            const baseValue = sizeData[baseUnit];
            
            // Get all conversions
            const conversions = [];
            const flags = {
                'EU': '🇪🇺',
                'US': '🇺🇸',
                'UK': '🇬🇧',
                'IT': '🇮🇹',
                'Int': '🌍'
            };

            Object.keys(sizeData).forEach(unit => {
                if (unit !== baseUnit) {
                    conversions.push({
                        flag: flags[unit] || '🌍',
                        unit: unit,
                        value: sizeData[unit]
                    });
                }
            });

            // Get measurement hint
            const measurementHint = data.measurements?.[baseValue] || '';

            return {
                base: { unit: baseUnit, value: baseValue },
                conversions: conversions,
                measurement_hint: measurementHint
            };
        }

        /**
         * Display results
         */
        function displayGroessenResults(result) {
            if (!result) {
                document.getElementById('groessen-results').classList.add('hidden');
                return;
            }

            const resultsDiv = document.getElementById('groessen-results');
            resultsDiv.classList.remove('hidden');

            // Display base size
            document.getElementById('groessen-base-display').textContent = 
                `${result.base.unit} ${result.base.value}`;

            // Display conversions grid
            const gridDiv = resultsDiv.querySelector('.grid');
            gridDiv.innerHTML = '';

            result.conversions.forEach(conv => {
                const card = document.createElement('div');
                card.className = 'bg-orange-900/30 rounded-lg p-4 border border-orange-500/30 text-center';
                card.innerHTML = `
                    <div class="text-2xl mb-2">${conv.flag}</div>
                    <div class="text-sm text-orange-200 mb-1">${conv.unit}</div>
                    <div class="text-xl font-bold text-white">${conv.value}</div>
                `;
                gridDiv.appendChild(card);
            });

            // Display measurement hint
            const hintDiv = document.getElementById('groessen-measurement-hint');
            const hintText = document.getElementById('groessen-hint-text');
            if (result.measurement_hint) {
                hintText.textContent = result.measurement_hint;
                hintDiv.classList.remove('hidden');
            } else {
                hintDiv.classList.add('hidden');
            }

            // Display smart tip
            const tips = SMART_TIPS[currentGroessenGender]?.[currentGroessenCategory] || [];
            if (tips.length > 0) {
                const randomTip = tips[Math.floor(Math.random() * tips.length)];
                document.getElementById('groessen-smart-tip').textContent = randomTip;
            }
        }

        /**
         * Initialize groessen converter when view is shown
         */
        function initializeGroessen() {
            setGroessenGender('damen');
            setGroessenCategory('konfektion');
        }

        /**
         * Benzinpreis Rechner Functions
         */

        // CO2 emission factors (kg CO2 per liter)
        const CO2_EMISSION_FACTORS = {
            benzin: 2.37,
            diesel: 2.65,
            elektro: 0 // Assuming grid mix, but can be adjusted
        };

        // Current mode
        let currentBenzinMode = 'reisekosten';

        /**
         * Set benzin calculator mode
         */
        function setBenzinMode(mode) {
            currentBenzinMode = mode;
            
            const reisekostenTab = document.getElementById('benzin-tab-reisekosten');
            const pendlerTab = document.getElementById('benzin-tab-pendler');
            const passengersGroup = document.getElementById('benzin-passengers-group');
            const commuteDaysGroup = document.getElementById('benzin-commute-days-group');
            const distanceHint = document.getElementById('benzin-distance-hint');

            if (mode === 'reisekosten') {
                reisekostenTab.classList.add('text-orange-200', 'border-orange-500', 'font-semibold');
                reisekostenTab.classList.remove('text-slate-400', 'border-transparent');
                pendlerTab.classList.add('text-slate-400', 'border-transparent');
                pendlerTab.classList.remove('text-orange-200', 'border-orange-500', 'font-semibold');
                passengersGroup.classList.remove('hidden');
                commuteDaysGroup.classList.add('hidden');
                distanceHint.textContent = '(einfach oder gesamt)';
            } else {
                pendlerTab.classList.add('text-orange-200', 'border-orange-500', 'font-semibold');
                pendlerTab.classList.remove('text-slate-400', 'border-transparent');
                reisekostenTab.classList.add('text-slate-400', 'border-transparent');
                reisekostenTab.classList.remove('text-orange-200', 'border-orange-500', 'font-semibold');
                passengersGroup.classList.add('hidden');
                commuteDaysGroup.classList.remove('hidden');
                distanceHint.textContent = '(einfache Strecke)';
            }

            handleBenzinCalculation();
        }

        /**
         * Calculate fuel costs
         */
        function calculateFuelCosts(inputs) {
            const {
                trip_distance_km,
                fuel_consumption_l_100km,
                fuel_price_per_liter,
                passengers = 1,
                fuel_type = 'benzin',
                commute_days = 0
            } = inputs;

            // Calculate total fuel needed
            const total_liters = (trip_distance_km / 100) * fuel_consumption_l_100km;
            
            // Calculate total cost
            const total_fuel_cost = total_liters * fuel_price_per_liter;
            
            // Calculate cost per person
            const cost_per_person = total_fuel_cost / passengers;
            
            // Calculate CO2 emissions
            const co2_factor = CO2_EMISSION_FACTORS[fuel_type] || 0;
            const co2_emitted_kg = total_liters * co2_factor;
            
            // Calculate Pendlerpauschale if in pendler mode
            let pendler_deduction_year = 0;
            if (commute_days > 0 && trip_distance_km > 0) {
                // First 20 km: 0.30€ per km, from 21st km: 0.38€ per km (one way)
                const first_20_km = Math.min(20, trip_distance_km);
                const remaining_km = Math.max(0, trip_distance_km - 20);
                const daily_deduction = (first_20_km * 0.30) + (remaining_km * 0.38);
                pendler_deduction_year = daily_deduction * commute_days;
            }
            
            // Calculate savings note for carpooling
            let savings_note = '';
            if (passengers > 1) {
                const total_savings = total_fuel_cost - cost_per_person;
                savings_note = `Fahrgemeinschaft spart ${total_savings.toFixed(2)} €!`;
            }

            return {
                total_fuel_cost: total_fuel_cost,
                cost_per_person: cost_per_person,
                co2_emitted_kg: co2_emitted_kg,
                pendler_deduction_year: pendler_deduction_year,
                savings_note: savings_note,
                total_liters: total_liters
            };
        }

        /**
         * Handle benzin calculation
         */
        function handleBenzinCalculation() {
            const distance = parseFloat(document.getElementById('benzin-distance').value);
            const consumption = parseFloat(document.getElementById('benzin-consumption').value);
            const price = parseFloat(document.getElementById('benzin-price').value);
            const fuelType = document.querySelector('input[name="benzin-fuel-type"]:checked').value;
            const passengers = currentBenzinMode === 'reisekosten' 
                ? parseInt(document.getElementById('benzin-passengers').value) 
                : 1;
            const commuteDays = currentBenzinMode === 'pendler'
                ? parseInt(document.getElementById('benzin-commute-days').value)
                : 0;

            if (isNaN(distance) || isNaN(consumption) || isNaN(price) || distance <= 0 || consumption <= 0 || price <= 0) {
                document.getElementById('benzin-results').classList.add('hidden');
                return;
            }

            const result = calculateFuelCosts({
                trip_distance_km: distance,
                fuel_consumption_l_100km: consumption,
                fuel_price_per_liter: price,
                passengers: passengers,
                fuel_type: fuelType,
                commute_days: commuteDays
            });

            displayBenzinResults(result, passengers, commuteDays);
        }

        /**
         * Display benzin results
         */
        function displayBenzinResults(result, passengers, commuteDays) {
            const resultsDiv = document.getElementById('benzin-results');
            resultsDiv.classList.remove('hidden');

            // Display total cost
            document.getElementById('benzin-total-cost').textContent = `${result.total_fuel_cost.toFixed(2)} €`;

            // Display cost per person (if multiple passengers)
            const perPersonCard = document.getElementById('benzin-per-person-card');
            if (passengers > 1 && currentBenzinMode === 'reisekosten') {
                perPersonCard.classList.remove('hidden');
                document.getElementById('benzin-cost-per-person').textContent = `${result.cost_per_person.toFixed(2)} €`;
                document.getElementById('benzin-savings-note').textContent = result.savings_note;
            } else {
                perPersonCard.classList.add('hidden');
            }

            // Display CO2 emissions
            const co2Card = document.getElementById('benzin-co2-card');
            const co2Icon = document.getElementById('benzin-co2-icon');
            const co2Value = document.getElementById('benzin-co2-value');
            
            if (result.co2_emitted_kg > 0) {
                co2Card.classList.remove('hidden');
                co2Value.textContent = `${result.co2_emitted_kg.toFixed(2)} kg`;
                
                // Color code CO2 icon (green for low, red for high)
                // Threshold: < 5 kg = green, 5-15 kg = yellow, > 15 kg = red
                if (result.co2_emitted_kg < 5) {
                    co2Icon.textContent = '🍃';
                    co2Icon.classList.remove('text-red-500');
                    co2Icon.classList.add('text-green-500');
                } else if (result.co2_emitted_kg < 15) {
                    co2Icon.textContent = '🍂';
                    co2Icon.classList.remove('text-green-500', 'text-red-500');
                    co2Icon.classList.add('text-yellow-500');
                } else {
                    co2Icon.textContent = '🔥';
                    co2Icon.classList.remove('text-green-500');
                    co2Icon.classList.add('text-red-500');
                }
            } else {
                co2Card.classList.add('hidden');
            }

            // Display Pendlerpauschale (if in pendler mode)
            const pendlerCard = document.getElementById('benzin-pendler-card');
            if (currentBenzinMode === 'pendler' && result.pendler_deduction_year > 0) {
                pendlerCard.classList.remove('hidden');
                document.getElementById('benzin-pendler-deduction').textContent = `${result.pendler_deduction_year.toFixed(2)} €`;
                
                const dailyDeduction = result.pendler_deduction_year / commuteDays;
                document.getElementById('benzin-pendler-note').textContent = 
                    `Täglich: ${dailyDeduction.toFixed(2)} € (0,30€ für erste 20 km, 0,38€ ab 21. km)`;
            } else {
                pendlerCard.classList.add('hidden');
            }
        }

        /**
         * Initialize benzin calculator when view is shown
         */
        function initializeBenzin() {
            setBenzinMode('reisekosten');
            handleBenzinCalculation();
        }

        /**
         * Altersrechner Functions
         */

        // German zodiac signs (Sternzeichen) with icons
        const ZODIAC_SIGNS = [
            { name: 'Wassermann', icon: '♒', start: [1, 20], end: [2, 18] },
            { name: 'Fische', icon: '♓', start: [2, 19], end: [3, 20] },
            { name: 'Widder', icon: '♈', start: [3, 21], end: [4, 19] },
            { name: 'Stier', icon: '♉', start: [4, 20], end: [5, 20] },
            { name: 'Zwillinge', icon: '♊', start: [5, 21], end: [6, 21] },
            { name: 'Krebs', icon: '♋', start: [6, 22], end: [7, 22] },
            { name: 'Löwe', icon: '♌', start: [7, 23], end: [8, 22] },
            { name: 'Jungfrau', icon: '♍', start: [8, 23], end: [9, 22] },
            { name: 'Waage', icon: '♎', start: [9, 23], end: [10, 23] },
            { name: 'Skorpion', icon: '♏', start: [10, 24], end: [11, 22] },
            { name: 'Schütze', icon: '♐', start: [11, 23], end: [12, 21] },
            { name: 'Steinbock', icon: '♑', start: [12, 22], end: [1, 19] }
        ];

        // German weekday names
        const WEEKDAYS = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];

        /**
         * Calculate precise age between two dates
         */
        function calculatePreciseAge(birthDate, targetDate) {
            let years = targetDate.getFullYear() - birthDate.getFullYear();
            let months = targetDate.getMonth() - birthDate.getMonth();
            let days = targetDate.getDate() - birthDate.getDate();
            let hours = targetDate.getHours() - birthDate.getHours();
            let minutes = targetDate.getMinutes() - birthDate.getMinutes();

            // Adjust for negative values
            if (minutes < 0) {
                minutes += 60;
                hours--;
            }
            if (hours < 0) {
                hours += 24;
                days--;
            }
            if (days < 0) {
                // Get days in previous month
                const prevMonth = new Date(targetDate.getFullYear(), targetDate.getMonth(), 0);
                days += prevMonth.getDate();
                months--;
            }
            if (months < 0) {
                months += 12;
                years--;
            }

            return { years, months, days, hours, minutes };
        }

        /**
         * Check if a year is a leap year
         */
        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        /**
         * Get days in a month
         */
        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        /**
         * Calculate total days between two dates (handling leap years)
         */
        function calculateTotalDays(birthDate, targetDate) {
            let totalDays = 0;
            let currentDate = new Date(birthDate);

            while (currentDate < targetDate) {
                totalDays++;
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return totalDays;
        }

        /**
         * Format date input automatically (adds dots after day and month)
         */
        function formatDateInput(input) {
            let value = input.value;
            
            // Remove all non-digit characters
            value = value.replace(/\D/g, '');
            
            // Limit to 8 digits (ddmmyyyy)
            if (value.length > 8) {
                value = value.substring(0, 8);
            }
            
            // Format: dd.mm.yyyy
            let formatted = '';
            if (value.length > 0) {
                formatted = value.substring(0, 2); // Day
                if (value.length > 2) {
                    formatted += '.' + value.substring(2, 4); // Month
                }
                if (value.length > 4) {
                    formatted += '.' + value.substring(4, 8); // Year
                }
            }
            
            // Update input value
            input.value = formatted;
        }

        /**
         * Parse German date format (dd.mm.yyyy)
         */
        function parseGermanDate(dateString) {
            if (!dateString || dateString.trim() === '') {
                return null;
            }

            // Remove whitespace
            dateString = dateString.trim();

            // Check format dd.mm.yyyy
            const parts = dateString.split('.');
            if (parts.length !== 3) {
                return null;
            }

            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);

            // Validate
            if (isNaN(day) || isNaN(month) || isNaN(year)) {
                return null;
            }

            if (day < 1 || day > 31 || month < 1 || month > 12 || year < 1900 || year > 2100) {
                return null;
            }

            // Create date (month is 0-indexed in JavaScript Date)
            const date = new Date(year, month - 1, day);
            
            // Verify the date is valid (handles invalid dates like 31.02.2020)
            if (date.getDate() !== day || date.getMonth() !== month - 1 || date.getFullYear() !== year) {
                return null;
            }

            return date;
        }

        /**
         * Get zodiac sign based on date
         */
        function getZodiacSign(month, day) {
            for (const sign of ZODIAC_SIGNS) {
                const [startMonth, startDay] = sign.start;
                const [endMonth, endDay] = sign.end;

                // Handle year wrap (Steinbock: Dec 22 - Jan 19)
                if (startMonth > endMonth) {
                    // Sign wraps around year boundary
                    if ((month === startMonth && day >= startDay) || 
                        (month === endMonth && day <= endDay) ||
                        (month === 12 && day >= startDay) ||
                        (month === 1 && day <= endDay)) {
                        return { name: sign.name, icon: sign.icon };
                    }
                } else {
                    // Normal case: sign within same year
                    if (month === startMonth && month === endMonth) {
                        // Same month range
                        if (day >= startDay && day <= endDay) {
                            return { name: sign.name, icon: sign.icon };
                        }
                    } else {
                        // Different months
                        if (month === startMonth && day >= startDay) {
                            return { name: sign.name, icon: sign.icon };
                        }
                        if (month === endMonth && day <= endDay) {
                            return { name: sign.name, icon: sign.icon };
                        }
                        if (month > startMonth && month < endMonth) {
                            return { name: sign.name, icon: sign.icon };
                        }
                    }
                }
            }
            return { name: 'Unbekannt', icon: '❓' };
        }

        /**
         * Calculate next birthday
         */
        function calculateNextBirthday(birthDate, targetDate) {
            const currentYear = targetDate.getFullYear();
            const birthMonth = birthDate.getMonth();
            const birthDay = birthDate.getDate();

            // Check if birthday already passed this year
            let nextBirthday = new Date(currentYear, birthMonth, birthDay);
            if (nextBirthday < targetDate) {
                nextBirthday = new Date(currentYear + 1, birthMonth, birthDay);
            }

            return nextBirthday;
        }

        /**
         * Calculate countdown to next birthday
         */
        function calculateCountdown(targetDate, nextBirthday) {
            const diff = nextBirthday - targetDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            return { days, hours, minutes };
        }

        /**
         * Format large numbers with thousand separators
         */
        function formatNumber(num) {
            return num.toLocaleString('de-DE');
        }

        /**
         * Calculate life statistics
         */
        function calculateLifeStats(birthDate, targetDate) {
            // Calculate precise age
            const age = calculatePreciseAge(birthDate, targetDate);
            const ageString = `${age.years} Jahre${age.months > 0 ? `, ${age.months} Monate` : ''}${age.days > 0 ? ` und ${age.days} Tage` : ''}`;
            const preciseAgeString = `${age.hours} Stunden und ${age.minutes} Minuten`;

            // Calculate total units
            const totalDays = calculateTotalDays(birthDate, targetDate);
            const totalWeeks = Math.floor(totalDays / 7);
            const totalHours = Math.floor((targetDate - birthDate) / (1000 * 60 * 60));
            const totalMinutes = Math.floor((targetDate - birthDate) / (1000 * 60));

            // Calculate biological stats
            const heartbeats = Math.floor(totalMinutes * 80); // Average 80 bpm
            const breaths = Math.floor(totalMinutes * 15); // Average 15 breaths per minute
            const hoursSlept = Math.floor(totalDays * 8); // 8 hours per day

            // Calculate next birthday
            const nextBirthday = calculateNextBirthday(birthDate, targetDate);
            const countdown = calculateCountdown(targetDate, nextBirthday);
            const countdownString = `${countdown.days} Tage, ${countdown.hours} Stunden und ${countdown.minutes} Minuten`;
            const nextBirthdayWeekday = WEEKDAYS[nextBirthday.getDay()];
            const nextBirthdayDateString = nextBirthday.toLocaleDateString('de-DE', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });

            // Get zodiac sign
            const zodiacData = getZodiacSign(birthDate.getMonth() + 1, birthDate.getDate());

            return {
                age_string: ageString,
                precise_age_string: preciseAgeString,
                next_birthday_countdown: countdownString,
                next_birthday_date: nextBirthdayDateString,
                next_birthday_weekday: nextBirthdayWeekday,
                zodiac: zodiacData.name,
                zodiac_icon: zodiacData.icon,
                stats: {
                    total_days: totalDays,
                    total_weeks: totalWeeks,
                    total_hours: totalHours,
                    heartbeats: heartbeats,
                    breaths: breaths,
                    hours_slept: hoursSlept
                }
            };
        }

        /**
         * Handle alter calculation
         */
        function handleAlterCalculation(event) {
            const birthDateInput = document.getElementById('alter-birth-date').value.trim();
            const birthTimeInput = document.getElementById('alter-birth-time').value;
            const targetDateInput = document.getElementById('alter-target-date').value.trim();

            // Check if birth date is provided
            if (!birthDateInput || birthDateInput === '') {
                document.getElementById('alter-results').classList.add('hidden');
                return;
            }

            // Parse birth date (German format dd.mm.yyyy)
            const birthDate = parseGermanDate(birthDateInput);
            if (!birthDate) {
                // Only show visual feedback when button is explicitly clicked
                if (event && event.type === 'click' && birthDateInput.length > 0) {
                    const inputField = document.getElementById('alter-birth-date');
                    inputField.classList.add('border-red-500');
                    setTimeout(() => {
                        inputField.classList.remove('border-red-500');
                    }, 2000);
                }
                document.getElementById('alter-results').classList.add('hidden');
                return;
            }

            // Add birth time if provided
            if (birthTimeInput) {
                const [hours, minutes] = birthTimeInput.split(':');
                birthDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            } else {
                birthDate.setHours(0, 0, 0, 0);
            }

            // Parse target date (default to now)
            let targetDate;
            if (targetDateInput && targetDateInput.trim() !== '') {
                targetDate = parseGermanDate(targetDateInput);
                if (!targetDate) {
                    // Show visual feedback if button was clicked
                    const isButtonClick = event && event.type === 'click';
                    if (isButtonClick) {
                        const inputField = document.getElementById('alter-target-date');
                        inputField.classList.add('border-red-500');
                        setTimeout(() => {
                            inputField.classList.remove('border-red-500');
                        }, 2000);
                    }
                    document.getElementById('alter-results').classList.add('hidden');
                    return;
                }
                targetDate.setHours(0, 0, 0, 0);
            } else {
                targetDate = new Date();
                targetDate.setHours(new Date().getHours(), new Date().getMinutes(), new Date().getSeconds(), 0);
            }

            // Validate dates
            if (birthDate > targetDate) {
                // Show visual feedback if button was clicked
                const isButtonClick = event && event.type === 'click';
                if (isButtonClick) {
                    const inputField = document.getElementById('alter-birth-date');
                    inputField.classList.add('border-red-500');
                    setTimeout(() => {
                        inputField.classList.remove('border-red-500');
                    }, 2000);
                }
                document.getElementById('alter-results').classList.add('hidden');
                return;
            }

            // Calculate stats
            const result = calculateLifeStats(birthDate, targetDate);
            displayAlterResults(result);
        }

        /**
         * Display alter results
         */
        function displayAlterResults(result) {
            const resultsDiv = document.getElementById('alter-results');
            resultsDiv.classList.remove('hidden');

            // Display age
            document.getElementById('alter-age-string').textContent = `Du bist ${result.age_string} alt.`;
            document.getElementById('alter-precise-age').textContent = result.precise_age_string;

            // Display zodiac with icon
            document.getElementById('alter-zodiac-icon').textContent = result.zodiac_icon;
            document.getElementById('alter-zodiac').textContent = result.zodiac;

            // Display next birthday
            document.getElementById('alter-next-birthday-date').textContent = result.next_birthday_date;
            document.getElementById('alter-next-birthday-countdown').textContent = `Noch ${result.next_birthday_countdown}`;
            document.getElementById('alter-next-birthday-weekday').textContent = `Wochentag: ${result.next_birthday_weekday}`;

            // Display stats with units
            document.getElementById('alter-total-days').textContent = `${formatNumber(result.stats.total_days)} Tage`;
            document.getElementById('alter-total-weeks').textContent = `${formatNumber(result.stats.total_weeks)} Wochen`;
            document.getElementById('alter-total-hours').textContent = `${formatNumber(result.stats.total_hours)} Stunden`;
            document.getElementById('alter-heartbeats').textContent = `${formatNumber(result.stats.heartbeats)} Schläge`;
            document.getElementById('alter-breaths').textContent = `${formatNumber(result.stats.breaths)} Atemzüge`;
            document.getElementById('alter-sleep-hours').textContent = `${formatNumber(result.stats.hours_slept)} Stunden`;
        }

        /**
         * Initialize alter calculator when view is shown
         */
        function initializeAlter() {
            // Clear all fields - they should be empty by default
            document.getElementById('alter-birth-date').value = '';
            document.getElementById('alter-birth-time').value = '';
            document.getElementById('alter-target-date').value = '';
            document.getElementById('alter-results').classList.add('hidden');
        }

        /**
         * Legal/Privacy View Functions
         */

        // Current legal tab
        let currentLegalTab = 'impressum';

        /**
         * Set legal tab
         */
        function setLegalTab(tab) {
            currentLegalTab = tab;
            
            // Update tab buttons
            const tabs = ['impressum', 'datenschutz', 'haftung'];
            tabs.forEach(t => {
                const tabBtn = document.getElementById(`legal-tab-${t}`);
                const content = document.getElementById(`legal-content-${t}`);
                
                if (t === tab) {
                    tabBtn.classList.add('text-gray-200', 'border-gray-400', 'font-semibold');
                    tabBtn.classList.remove('text-slate-400', 'border-transparent');
                    content.classList.remove('hidden');
                } else {
                    tabBtn.classList.add('text-slate-400', 'border-transparent');
                    tabBtn.classList.remove('text-gray-200', 'border-gray-400', 'font-semibold');
                    content.classList.add('hidden');
                }
            });
        }

        /**
         * Show legal page with specific tab
         */
        function showLegalPage(tab) {
            // Show the legal view
            showPage('legal');
            
            // Set the correct tab after a short delay to ensure DOM is ready
            setTimeout(() => {
                setLegalTab(tab);
            }, 100);
        }

        /**
         * Initialize legal view when shown
         */
        function initializeLegal() {
            // Default to impressum if no specific tab was requested
            if (!currentLegalTab) {
                currentLegalTab = 'impressum';
            }
            setLegalTab(currentLegalTab);
        }

        /**
         * Toggle tax rate container visibility based on include_tax selection
         */
        function toggleTaxRateContainer() {
            const includeTaxYes = document.getElementById('include_tax_yes');
            const taxRateContainer = document.getElementById('tax_rate_container');
            const taxRateInput = document.getElementById('tax_rate_percent');
            
            if (includeTaxYes.checked) {
                taxRateContainer.classList.remove('hidden');
                taxRateInput.required = true;
            } else {
                taxRateContainer.classList.add('hidden');
                taxRateInput.required = false;
            }
        }

        // Add event listeners for tax toggle
        document.getElementById('include_tax_yes').addEventListener('change', toggleTaxRateContainer);
        document.getElementById('include_tax_no').addEventListener('change', toggleTaxRateContainer);
        
        // Initialize on page load
        toggleTaxRateContainer();

        /**
         * Render charts for Zinsrechner results
         */
        let capitalGrowthChart = null;
        let depositsInterestChart = null;
        let taxImpactChart = null;

        function renderZinsCharts(result) {
            // Chart.js color scheme for dark theme
            const chartColors = {
                teal: 'rgba(20, 184, 166, 0.8)',
                green: 'rgba(34, 197, 94, 0.8)',
                red: 'rgba(239, 68, 68, 0.8)',
                yellow: 'rgba(234, 179, 8, 0.8)',
                purple: 'rgba(168, 85, 247, 0.8)',
                blue: 'rgba(59, 130, 246, 0.8)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };

            // Destroy existing charts if they exist
            if (capitalGrowthChart) capitalGrowthChart.destroy();
            if (depositsInterestChart) depositsInterestChart.destroy();
            if (taxImpactChart) taxImpactChart.destroy();

            const years = result.breakdown.map(d => `Jahr ${d.year}`);
            const capitalData = result.breakdown.map(d => d.end_capital);
            const depositsData = result.breakdown.map(d => d.deposits_year);
            const interestData = result.breakdown.map(d => d.interest_gross);
            const taxData = result.breakdown.map(d => d.tax_paid);
            const feesData = result.breakdown.map(d => d.fees_amount);

            // Capital Growth Chart
            const capitalGrowthCtx = document.getElementById('capital-growth-chart').getContext('2d');
            capitalGrowthChart = new Chart(capitalGrowthCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Endkapital',
                        data: capitalData,
                        borderColor: chartColors.teal,
                        backgroundColor: chartColors.teal.replace('0.8', '0.2'),
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });

            // Deposits vs Interest Chart
            const depositsInterestCtx = document.getElementById('deposits-interest-chart').getContext('2d');
            depositsInterestChart = new Chart(depositsInterestCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Einzahlungen',
                            data: depositsData,
                            backgroundColor: chartColors.blue,
                            borderColor: chartColors.blue.replace('0.8', '1'),
                            borderWidth: 1
                        },
                        {
                            label: 'Zinserträge',
                            data: interestData,
                            backgroundColor: chartColors.green,
                            borderColor: chartColors.green.replace('0.8', '1'),
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });

            // Tax Impact Chart (Stacked Area)
            const taxImpactCtx = document.getElementById('tax-impact-chart').getContext('2d');
            taxImpactChart = new Chart(taxImpactCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Brutto-Zinserträge',
                            data: interestData,
                            borderColor: chartColors.green,
                            backgroundColor: chartColors.green.replace('0.8', '0.3'),
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Steuern',
                            data: taxData,
                            borderColor: chartColors.red,
                            backgroundColor: chartColors.red.replace('0.8', '0.3'),
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Gebühren',
                            data: feesData,
                            borderColor: chartColors.yellow,
                            backgroundColor: chartColors.yellow.replace('0.8', '0.3'),
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });
        }

        /**
         * Chart variable for Aktien Rendite calculator
         */
        let aktienGrowthChart = null;

        /**
         * Render Aktien Rendite growth chart
         */
        function renderAktienChart(result) {
            const chartColors = {
                purple: 'rgba(168, 85, 247, 0.8)',
                purpleLight: 'rgba(168, 85, 247, 0.3)',
                purpleBorder: 'rgba(168, 85, 247, 1)',
                green: 'rgba(34, 197, 94, 0.8)',
                greenLight: 'rgba(34, 197, 94, 0.3)',
                greenBorder: 'rgba(34, 197, 94, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };

            // Destroy existing chart
            if (aktienGrowthChart) aktienGrowthChart.destroy();

            const years = result.annual_breakdown.map(d => `Jahr ${d.year}`);
            
            // Calculate cumulative deposits and final capital for each year
            const depositsCumulative = [];
            const capitalData = [];
            let cumulativeDeposits = 0;
            
            result.annual_breakdown.forEach(entry => {
                cumulativeDeposits += entry.deposits_year;
                depositsCumulative.push(cumulativeDeposits);
                capitalData.push(entry.end_value);
            });

            const ctx = document.getElementById('aktien-growth-chart').getContext('2d');
            aktienGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Einzahlungen (kumuliert)',
                            data: depositsCumulative,
                            borderColor: chartColors.greenBorder,
                            backgroundColor: chartColors.greenLight,
                            borderWidth: 2,
                            fill: false,
                            borderDash: [5, 5],
                            tension: 0.4
                        },
                        {
                            label: 'Endkapital (Netto nach Steuer)',
                            data: capitalData,
                            borderColor: chartColors.purpleBorder,
                            backgroundColor: chartColors.purpleLight,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: chartColors.textColor,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                usePointStyle: true,
                                padding: 15
                            },
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: chartColors.textColor,
                            bodyColor: chartColors.textColor,
                            borderColor: chartColors.purpleBorder,
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const formattedValue = value.toLocaleString('de-DE', {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    });
                                    return `${context.dataset.label}: ${formattedValue} €`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M €';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Betrag (€)',
                                color: chartColors.textColor,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        /**
         * Handle Zinsrechner Form Submission
         */
        document.getElementById('zins-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-zins-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('zins-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const initial_capital = parseFloat(document.getElementById('initial_capital').value) || 0;
                const monthly_rate = parseFloat(document.getElementById('monthly_rate').value) || 0;
                const interest_rate_pa = parseFloat(document.getElementById('interest_rate_pa').value) || 0;
                const duration_years = parseInt(document.getElementById('duration_years').value) || 0;
                const rate_increase_annual_percent = parseFloat(document.getElementById('rate_increase_annual_percent').value) || 0;
                const sparer_pauschbetrag_used = parseFloat(document.getElementById('sparer_pauschbetrag_used').value) || 0;
                const is_church_member = document.getElementById('zins_church_member').checked;
                const fees_percent_pa = parseFloat(document.getElementById('fees_percent_pa').value) || 0;
                const include_tax = document.getElementById('include_tax_yes').checked;
                const tax_rate_percent = include_tax ? (parseFloat(document.getElementById('tax_rate_percent').value) || 26.375) : 0;

                // Validation
                if (monthly_rate <= 0 && initial_capital <= 0) {
                    alert('Bitte geben Sie entweder ein Anfangskapital oder eine monatliche Sparrate ein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (interest_rate_pa < 0 || interest_rate_pa > 100) {
                    alert('Bitte geben Sie einen gültigen Zinssatz ein (0-100%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (duration_years < 1 || duration_years > 100) {
                    alert('Bitte geben Sie eine gültige Laufzeit ein (1-100 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }
                if (sparer_pauschbetrag_used < 0 || sparer_pauschbetrag_used > 1000) {
                    alert('Der Sparer-Pauschbetrag muss zwischen 0 und 1.000 € liegen.');
                    hideCalculatingOverlay();
                    return;
                }
                if (fees_percent_pa < 0 || fees_percent_pa > 10) {
                    alert('Die Gebühren müssen zwischen 0 und 10% liegen.');
                    hideCalculatingOverlay();
                    return;
                }
                if (include_tax && (tax_rate_percent < 0 || tax_rate_percent > 50)) {
                    alert('Der Steuersatz muss zwischen 0 und 50% liegen.');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateSavingsPlan({
                    initial_capital,
                    monthly_rate,
                    interest_rate_pa,
                    duration_years,
                    rate_increase_annual_percent,
                    sparer_pauschbetrag_used,
                    is_church_member,
                    fees_percent_pa,
                    include_tax,
                    tax_rate_percent
                });

                // Calculate net return percentage
                const net_return_percent = result.total_deposits > 0 
                    ? ((result.total_net_interest / result.total_deposits) * 100) 
                    : 0;

                // Display results
                document.getElementById('result-final-capital').textContent = result.final_capital.toFixed(2) + ' €';
                document.getElementById('result-total-deposits').textContent = result.total_deposits.toFixed(2) + ' €';
                document.getElementById('result-gross-interest').textContent = result.total_gross_interest.toFixed(2) + ' €';
                
                // Show/hide fees container
                const feesContainer = document.getElementById('result-fees-container');
                if (result.total_fees_deducted > 0) {
                    feesContainer.classList.remove('hidden');
                    document.getElementById('result-fees-deducted').textContent = '- ' + result.total_fees_deducted.toFixed(2) + ' €';
                } else {
                    feesContainer.classList.add('hidden');
                }
                
                document.getElementById('result-tax-deducted').textContent = '- ' + result.total_tax_deducted.toFixed(2) + ' €';
                document.getElementById('result-net-interest').textContent = result.total_net_interest.toFixed(2) + ' €';
                document.getElementById('result-net-return').textContent = net_return_percent.toFixed(2) + '%';

                // Display annual breakdown
                const breakdownContainer = document.getElementById('zins-breakdown');
                breakdownContainer.innerHTML = '';
                
                result.breakdown.forEach(yearData => {
                    const yearDiv = document.createElement('div');
                    yearDiv.className = 'bg-slate-800/50 rounded-lg p-3 border border-gray-700';
                    yearDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-semibold text-teal-400">Jahr ${yearData.year}</span>
                            <span class="text-sm text-slate-400">Endkapital: <span class="text-white font-semibold">${yearData.end_capital.toFixed(2)} €</span></span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-slate-400">
                            <div>Startkapital: <span class="text-slate-300">${yearData.start_capital.toFixed(2)} €</span></div>
                            <div>Monatliche Rate: <span class="text-slate-300">${yearData.monthly_rate.toFixed(2)} €</span></div>
                            <div>Einzahlungen: <span class="text-slate-300">${yearData.deposits_year.toFixed(2)} €</span></div>
                            <div>Zinserträge: <span class="text-green-400">${yearData.interest_gross.toFixed(2)} €</span></div>
                            ${yearData.fees_amount > 0 ? `<div>Gebühren: <span class="text-yellow-400">- ${yearData.fees_amount.toFixed(2)} €</span></div>` : ''}
                            ${yearData.tax_paid > 0 ? `<div>Steuern: <span class="text-red-400">- ${yearData.tax_paid.toFixed(2)} €</span></div>` : ''}
                        </div>
                    `;
                    breakdownContainer.appendChild(yearDiv);
                });

                // Render charts
                renderZinsCharts(result);

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('zins-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');

                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Handle Aktien Rendite Form Submission
         */
        document.getElementById('aktien-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-aktien-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('aktien-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const initial_investment = parseFloat(document.getElementById('aktien_initial_investment').value) || 0;
                const monthly_rate = parseFloat(document.getElementById('aktien_monthly_rate').value) || 0;
                const expected_return_pa = parseFloat(document.getElementById('aktien_expected_return_pa').value) || 0;
                const duration_years = parseInt(document.getElementById('aktien_duration_years').value) || 0;
                const sparer_pauschbetrag_used = parseFloat(document.getElementById('aktien_sparer_pauschbetrag_used').value) || 0;
                const is_church_member = document.getElementById('aktien_church_member').checked;

                // Validation
                if (initial_investment < 0) {
                    alert('Die Anfangsinvestition darf nicht negativ sein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (monthly_rate < 0) {
                    alert('Die monatliche Sparrate darf nicht negativ sein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (initial_investment === 0 && monthly_rate === 0) {
                    alert('Bitte geben Sie entweder eine Anfangsinvestition oder eine monatliche Sparrate ein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (expected_return_pa < 0 || expected_return_pa > 50) {
                    alert('Bitte geben Sie eine gültige erwartete Rendite ein (0-50%).');
                    hideCalculatingOverlay();
                    return;
                }
                if (duration_years < 1 || duration_years > 100) {
                    alert('Bitte geben Sie eine gültige Laufzeit ein (1-100 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }
                if (sparer_pauschbetrag_used < 0 || sparer_pauschbetrag_used > 1000) {
                    alert('Der Sparer-Pauschbetrag muss zwischen 0 und 1.000 € liegen.');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateStockReturn({
                    initial_investment,
                    monthly_rate,
                    expected_return_pa,
                    duration_years,
                    sparer_pauschbetrag_used,
                    is_church_member
                });

                // Display results
                document.getElementById('result-aktien-final-capital').textContent = 
                    result.final_capital.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-aktien-total-deposits').textContent = 
                    result.total_deposits.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-aktien-total-gain').textContent = 
                    '+' + result.total_net_gain.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-aktien-total-tax').textContent = 
                    '- ' + result.total_tax_paid.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-aktien-cagr').textContent = 
                    result.annualized_return_cagr.toFixed(2) + ' %';

                // Display annual breakdown
                const breakdownContainer = document.getElementById('aktien-breakdown');
                breakdownContainer.innerHTML = '';
                
                result.annual_breakdown.forEach(yearData => {
                    const yearDiv = document.createElement('div');
                    yearDiv.className = 'bg-slate-800/50 rounded-lg p-3 border border-gray-700';
                    yearDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-semibold text-purple-400">Jahr ${yearData.year}</span>
                            <span class="text-sm text-slate-400">Endkapital: <span class="text-white font-semibold">${yearData.end_value.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></span>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2 text-xs text-slate-400">
                            <div>Startwert: <span class="text-slate-300">${yearData.start_value.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></div>
                            <div>Einzahlungen: <span class="text-slate-300">${yearData.deposits_year.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></div>
                            <div>Gewinn (Brutto): <span class="text-green-400">+ ${yearData.gain_gross.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></div>
                            ${yearData.tax_paid > 0 ? `<div>Steuern: <span class="text-red-400">- ${yearData.tax_paid.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} €</span></div>` : '<div>Steuern: <span class="text-slate-300">0,00 €</span></div>'}
                        </div>
                    `;
                    breakdownContainer.appendChild(yearDiv);
                });

                // Render chart
                renderAktienChart(result);

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('aktien-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Handle BMI Form Submission
         */
        document.getElementById('bmi-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-bmi-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('bmi-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const weight_kg = parseFloat(document.getElementById('bmi_weight_kg').value) || 0;
                const height_cm = parseFloat(document.getElementById('bmi_height_cm').value) || 0;
                const age = parseInt(document.getElementById('bmi_age').value) || 0;
                const gender = document.getElementById('bmi_gender').value;

                // Validation
                if (weight_kg <= 0 || weight_kg > 300) {
                    alert('Bitte geben Sie ein gültiges Gewicht ein (1-300 kg).');
                    hideCalculatingOverlay();
                    return;
                }
                if (height_cm <= 0 || height_cm > 250) {
                    alert('Bitte geben Sie eine gültige Körpergröße ein (1-250 cm).');
                    hideCalculatingOverlay();
                    return;
                }
                if (age < 1 || age > 120) {
                    alert('Bitte geben Sie ein gültiges Alter ein (1-120 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateBMI({
                    weight_kg,
                    height_cm,
                    age,
                    gender
                });

                // Display results
                document.getElementById('result-bmi-value').textContent = result.bmi_value.toFixed(1);
                
                // Display badge with color
                const badge = document.getElementById('result-bmi-badge');
                badge.textContent = result.who_category;
                badge.className = 'inline-block px-4 py-2 rounded-full text-sm font-semibold ';
                if (result.color_code === 'blue') {
                    badge.className += 'bg-blue-600 text-white';
                } else if (result.color_code === 'green') {
                    badge.className += 'bg-green-600 text-white';
                } else if (result.color_code === 'orange') {
                    badge.className += 'bg-orange-600 text-white';
                } else {
                    badge.className += 'bg-red-600 text-white';
                }

                // Display WHO category and ideal range
                document.getElementById('result-bmi-who-category').textContent = result.who_category;
                document.getElementById('result-bmi-ideal-range').textContent = result.ideal_range_text;
                document.getElementById('result-bmi-feedback').textContent = result.health_feedback;

                // Update visual gauge marker position
                // BMI scale: 15 to 40+ (25 units range)
                // Position calculation: ((BMI - 15) / 25) * 100%
                const bmi_min = 15;
                const bmi_max = 40;
                const bmi_range = bmi_max - bmi_min;
                let marker_position = ((result.bmi_value - bmi_min) / bmi_range) * 100;
                
                // Clamp between 0% and 100%
                marker_position = Math.max(0, Math.min(100, marker_position));
                
                const marker = document.getElementById('bmi-marker');
                marker.style.left = marker_position + '%';

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('bmi-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Handle Kalorienrechner Form Submission
         */
        document.getElementById('kalorien-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-kalorien-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('kalorien-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const gender = document.getElementById('kalorien_gender').value;
                const weight_kg = parseFloat(document.getElementById('kalorien_weight_kg').value) || 0;
                const height_cm = parseFloat(document.getElementById('kalorien_height_cm').value) || 0;
                const age = parseInt(document.getElementById('kalorien_age').value) || 0;
                const pal_value = parseFloat(document.getElementById('kalorien_pal').value) || 1.45;
                const goal = document.getElementById('kalorien_goal').value;

                // Validation
                if (weight_kg <= 0 || weight_kg > 300) {
                    alert('Bitte geben Sie ein gültiges Gewicht ein (1-300 kg).');
                    hideCalculatingOverlay();
                    return;
                }
                if (height_cm <= 0 || height_cm > 250) {
                    alert('Bitte geben Sie eine gültige Körpergröße ein (1-250 cm).');
                    hideCalculatingOverlay();
                    return;
                }
                if (age < 1 || age > 120) {
                    alert('Bitte geben Sie ein gültiges Alter ein (1-120 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateCalories({
                    gender,
                    weight_kg,
                    height_cm,
                    age,
                    pal_value,
                    goal
                });

                // Display results
                document.getElementById('result-kalorien-bmr').textContent = result.bmr_kcal.toLocaleString('de-DE') + ' kcal';
                document.getElementById('result-kalorien-tdee').textContent = result.tdee_kcal.toLocaleString('de-DE') + ' kcal';
                document.getElementById('result-kalorien-target').textContent = result.target_kcal.toLocaleString('de-DE') + ' kcal';
                
                // Display macros
                document.getElementById('result-kalorien-carbs').textContent = result.macros.carbs_g + ' g';
                document.getElementById('result-kalorien-protein').textContent = result.macros.protein_g + ' g';
                document.getElementById('result-kalorien-fat').textContent = result.macros.fat_g + ' g';
                
                // Display PAL description
                document.getElementById('pal-description-text').textContent = result.pal_description;

                // Update visual stacked bar chart
                const max_kcal = result.tdee_kcal;
                const bmr_percent = (result.bmr_kcal / max_kcal) * 100;
                const activity_percent = (result.activity_kcal / max_kcal) * 100;
                
                const barBmr = document.getElementById('bar-bmr');
                const barActivity = document.getElementById('bar-activity');
                const barBmrLabel = document.getElementById('bar-bmr-label');
                const barActivityLabel = document.getElementById('bar-activity-label');
                
                // Set BMR bar (base)
                barBmr.style.width = bmr_percent + '%';
                barBmr.style.left = '0%';
                barBmrLabel.textContent = result.bmr_kcal.toLocaleString('de-DE') + ' kcal';
                
                // Set Activity bar (stacked on top of BMR)
                barActivity.style.width = activity_percent + '%';
                barActivity.style.left = bmr_percent + '%';
                barActivityLabel.textContent = '+' + result.activity_kcal.toLocaleString('de-DE') + ' kcal';

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('kalorien-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Handle Promillerechner Form Submission
         */
        document.getElementById('promille-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-promille-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('promille-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const gender = document.getElementById('promille_gender').value;
                const weight_kg = parseFloat(document.getElementById('promille_weight_kg').value) || 0;
                const time_since_first_drink = parseFloat(document.getElementById('promille_time_hours').value) || 0;

                // Validation
                if (weight_kg <= 0 || weight_kg > 200) {
                    alert('Bitte geben Sie ein gültiges Gewicht ein (1-200 kg).');
                    hideCalculatingOverlay();
                    return;
                }
                if (time_since_first_drink < 0 || time_since_first_drink > 24) {
                    alert('Bitte geben Sie eine gültige Zeit ein (0-24 Stunden).');
                    hideCalculatingOverlay();
                    return;
                }
                if (drinkList.length === 0) {
                    alert('Bitte fügen Sie mindestens ein Getränk hinzu.');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculatePromille({
                    gender,
                    weight_kg,
                    drink_list: drinkList,
                    time_since_first_drink
                });

                // Display results
                document.getElementById('result-promille-value').textContent = result.promille_value.toFixed(2) + ' ‰';
                
                if (result.time_to_sober > 0) {
                    document.getElementById('result-time-to-sober').textContent = 
                        `Geschätzte Zeit bis 0,0‰: ${result.time_to_sober} ${result.time_to_sober === 1 ? 'Stunde' : 'Stunden'}`;
                } else {
                    document.getElementById('result-time-to-sober').textContent = 'Kein Alkohol im Blut';
                }

                // Display legal status
                document.getElementById('legal-status-auto-text').textContent = result.legal_status_auto;
                document.getElementById('legal-status-bike-text').textContent = result.legal_status_bike;

                // Update border colors based on warning
                const autoStatusDiv = document.getElementById('legal-status-auto');
                const bikeStatusDiv = document.getElementById('legal-status-bike');
                
                if (result.warning_color === 'red') {
                    autoStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-red-600';
                    bikeStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-red-600';
                } else if (result.warning_color === 'orange') {
                    autoStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-orange-500';
                    bikeStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-orange-500';
                } else {
                    autoStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-yellow-500';
                    bikeStatusDiv.className = 'bg-slate-800/50 rounded-lg p-4 border-2 border-yellow-500';
                }

                // Display warnings
                const warningsContainer = document.getElementById('legal-warnings');
                warningsContainer.innerHTML = '';
                
                if (result.warnings.length > 0) {
                    result.warnings.forEach(warning => {
                        const warningDiv = document.createElement('div');
                        let bgColor = 'bg-yellow-900/30';
                        let borderColor = 'border-yellow-500/50';
                        let textColor = 'text-yellow-300';
                        
                        if (warning.color === 'red') {
                            bgColor = 'bg-red-900/30';
                            borderColor = 'border-red-500/50';
                            textColor = 'text-red-300';
                        } else if (warning.color === 'orange') {
                            bgColor = 'bg-orange-900/30';
                            borderColor = 'border-orange-500/50';
                            textColor = 'text-orange-300';
                        }
                        
                        warningDiv.className = `${bgColor} ${borderColor} border rounded-lg p-3 ${textColor} text-sm font-medium`;
                        warningDiv.textContent = warning.text;
                        warningsContainer.appendChild(warningDiv);
                    });
                }

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('promille-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Währungsrechner - Currency Converter
         * Exchange rates storage (base: EUR)
         * Comprehensive list of all world currencies with approximate rates
         */
        let exchangeRates = {
            "EUR": 1.0,
            "USD": 1.085,
            "AED": 3.98,
            "AFN": 77.5,
            "ALL": 104.0,
            "AMD": 428.0,
            "ANG": 1.96,
            "AOA": 920.0,
            "ARS": 950.0,
            "AUD": 1.65,
            "AWG": 1.96,
            "AZN": 1.85,
            "BAM": 1.96,
            "BBD": 2.17,
            "BDT": 119.0,
            "BGN": 1.96,
            "BHD": 0.409,
            "BIF": 3100.0,
            "BMD": 1.085,
            "BND": 1.46,
            "BOB": 7.50,
            "BRL": 5.40,
            "BSD": 1.085,
            "BTN": 90.5,
            "BWP": 14.8,
            "BYN": 3.55,
            "BZD": 2.17,
            "CAD": 1.47,
            "CDF": 2980.0,
            "CHF": 0.96,
            "CLP": 1030.0,
            "CNY": 7.85,
            "COP": 4200.0,
            "CRC": 560.0,
            "CUP": 28.5,
            "CVE": 110.25,
            "CZK": 25.0,
            "DJF": 193.0,
            "DKK": 7.46,
            "DOP": 64.0,
            "DZD": 146.0,
            "EGP": 52.0,
            "ERN": 16.3,
            "ETB": 61.5,
            "FJD": 2.43,
            "FKP": 0.86,
            "GBP": 0.86,
            "GEL": 2.95,
            "GHS": 14.5,
            "GIP": 0.86,
            "GMD": 73.5,
            "GNF": 9320.0,
            "GTQ": 8.50,
            "GYD": 227.0,
            "HKD": 8.50,
            "HNL": 26.8,
            "HRK": 7.57,
            "HTG": 143.0,
            "HUF": 390.0,
            "IDR": 17100.0,
            "ILS": 4.05,
            "INR": 90.5,
            "IQD": 1420.0,
            "IRR": 45750.0,
            "ISK": 151.0,
            "JMD": 169.0,
            "JOD": 0.769,
            "JPY": 160.0,
            "KES": 138.0,
            "KGS": 96.5,
            "KHR": 4440.0,
            "KMF": 493.0,
            "KPW": 960.0,
            "KRW": 1450.0,
            "KWD": 0.334,
            "KYD": 0.904,
            "KZT": 483.0,
            "LAK": 23000.0,
            "LBP": 16300.0,
            "LKR": 327.0,
            "LRD": 208.0,
            "LSL": 20.3,
            "LYD": 5.25,
            "MAD": 10.9,
            "MDL": 19.2,
            "MGA": 4900.0,
            "MKD": 61.5,
            "MMK": 2280.0,
            "MNT": 3790.0,
            "MOP": 8.75,
            "MRU": 43.0,
            "MUR": 49.5,
            "MVR": 16.7,
            "MWK": 1850.0,
            "MXN": 18.2,
            "MYR": 5.10,
            "MZN": 69.0,
            "NAD": 20.3,
            "NGN": 1620.0,
            "NIO": 39.8,
            "NOK": 11.5,
            "NPR": 145.0,
            "NZD": 1.80,
            "OMR": 0.418,
            "PAB": 1.085,
            "PEN": 4.05,
            "PGK": 4.15,
            "PHP": 61.0,
            "PKR": 302.0,
            "PLN": 4.32,
            "PYG": 7950.0,
            "QAR": 3.95,
            "RON": 4.97,
            "RSD": 117.0,
            "RUB": 99.5,
            "RWF": 1390.0,
            "SAR": 4.07,
            "SBD": 9.15,
            "SCR": 14.5,
            "SDG": 520.0,
            "SEK": 11.5,
            "SGD": 1.46,
            "SHP": 0.86,
            "SLE": 24.5,
            "SOS": 620.0,
            "SRD": 42.0,
            "SSP": 1650.0,
            "STN": 24.5,
            "SYP": 13900.0,
            "SZL": 20.3,
            "THB": 39.5,
            "TJS": 11.8,
            "TMT": 3.80,
            "TND": 3.38,
            "TOP": 2.58,
            "TRY": 34.5,
            "TTD": 7.35,
            "TVD": 1.65,
            "TWD": 34.8,
            "TZS": 2700.0,
            "UAH": 40.5,
            "UGX": 4050.0,
            "UYU": 42.5,
            "UZS": 13400.0,
            "VES": 39.5,
            "VND": 26700.0,
            "VUV": 129.0,
            "WST": 3.00,
            "XAF": 655.957,
            "XCD": 2.93,
            "XOF": 655.957,
            "XPF": 119.33,
            "YER": 271.0,
            "ZAR": 20.3,
            "ZMW": 28.5,
            "ZWL": 3495.0
        };

        /**
         * Simulate fetching exchange rates from an API
         * This function simulates an async API call with a loading delay
         */
        async function fetchAndSetRates() {
            const loadingDiv = document.getElementById('waehrung-loading');
            const calculatorDiv = document.getElementById('waehrung-calculator');
            
            // Show loading indicator
            loadingDiv.classList.remove('hidden');
            calculatorDiv.classList.add('hidden');
            
            try {
                // Simulate API delay (1-2 seconds)
                await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200));
                
                // Simulate fetching rates (in a real app, this would be a real API call)
                // Add slight random variation to simulate "live" rates
                const variation = 0.02; // 2% max variation
                const baseRates = {
                    "EUR": 1.0,
                    "USD": 1.085,
                    "AED": 3.98,
                    "AFN": 77.5,
                    "ALL": 104.0,
                    "AMD": 428.0,
                    "ANG": 1.96,
                    "AOA": 920.0,
                    "ARS": 950.0,
                    "AUD": 1.65,
                    "AWG": 1.96,
                    "AZN": 1.85,
                    "BAM": 1.96,
                    "BBD": 2.17,
                    "BDT": 119.0,
                    "BGN": 1.96,
                    "BHD": 0.409,
                    "BIF": 3100.0,
                    "BMD": 1.085,
                    "BND": 1.46,
                    "BOB": 7.50,
                    "BRL": 5.40,
                    "BSD": 1.085,
                    "BTN": 90.5,
                    "BWP": 14.8,
                    "BYN": 3.55,
                    "BZD": 2.17,
                    "CAD": 1.47,
                    "CDF": 2980.0,
                    "CHF": 0.96,
                    "CLP": 1030.0,
                    "CNY": 7.85,
                    "COP": 4200.0,
                    "CRC": 560.0,
                    "CUP": 28.5,
                    "CVE": 110.25,
                    "CZK": 25.0,
                    "DJF": 193.0,
                    "DKK": 7.46,
                    "DOP": 64.0,
                    "DZD": 146.0,
                    "EGP": 52.0,
                    "ERN": 16.3,
                    "ETB": 61.5,
                    "FJD": 2.43,
                    "FKP": 0.86,
                    "GBP": 0.86,
                    "GEL": 2.95,
                    "GHS": 14.5,
                    "GIP": 0.86,
                    "GMD": 73.5,
                    "GNF": 9320.0,
                    "GTQ": 8.50,
                    "GYD": 227.0,
                    "HKD": 8.50,
                    "HNL": 26.8,
                    "HRK": 7.57,
                    "HTG": 143.0,
                    "HUF": 390.0,
                    "IDR": 17100.0,
                    "ILS": 4.05,
                    "INR": 90.5,
                    "IQD": 1420.0,
                    "IRR": 45750.0,
                    "ISK": 151.0,
                    "JMD": 169.0,
                    "JOD": 0.769,
                    "JPY": 160.0,
                    "KES": 138.0,
                    "KGS": 96.5,
                    "KHR": 4440.0,
                    "KMF": 493.0,
                    "KPW": 960.0,
                    "KRW": 1450.0,
                    "KWD": 0.334,
                    "KYD": 0.904,
                    "KZT": 483.0,
                    "LAK": 23000.0,
                    "LBP": 16300.0,
                    "LKR": 327.0,
                    "LRD": 208.0,
                    "LSL": 20.3,
                    "LYD": 5.25,
                    "MAD": 10.9,
                    "MDL": 19.2,
                    "MGA": 4900.0,
                    "MKD": 61.5,
                    "MMK": 2280.0,
                    "MNT": 3790.0,
                    "MOP": 8.75,
                    "MRU": 43.0,
                    "MUR": 49.5,
                    "MVR": 16.7,
                    "MWK": 1850.0,
                    "MXN": 18.2,
                    "MYR": 5.10,
                    "MZN": 69.0,
                    "NAD": 20.3,
                    "NGN": 1620.0,
                    "NIO": 39.8,
                    "NOK": 11.5,
                    "NPR": 145.0,
                    "NZD": 1.80,
                    "OMR": 0.418,
                    "PAB": 1.085,
                    "PEN": 4.05,
                    "PGK": 4.15,
                    "PHP": 61.0,
                    "PKR": 302.0,
                    "PLN": 4.32,
                    "PYG": 7950.0,
                    "QAR": 3.95,
                    "RON": 4.97,
                    "RSD": 117.0,
                    "RUB": 99.5,
                    "RWF": 1390.0,
                    "SAR": 4.07,
                    "SBD": 9.15,
                    "SCR": 14.5,
                    "SDG": 520.0,
                    "SEK": 11.5,
                    "SGD": 1.46,
                    "SHP": 0.86,
                    "SLE": 24.5,
                    "SOS": 620.0,
                    "SRD": 42.0,
                    "SSP": 1650.0,
                    "STN": 24.5,
                    "SYP": 13900.0,
                    "SZL": 20.3,
                    "THB": 39.5,
                    "TJS": 11.8,
                    "TMT": 3.80,
                    "TND": 3.38,
                    "TOP": 2.58,
                    "TRY": 34.5,
                    "TTD": 7.35,
                    "TVD": 1.65,
                    "TWD": 34.8,
                    "TZS": 2700.0,
                    "UAH": 40.5,
                    "UGX": 4050.0,
                    "UYU": 42.5,
                    "UZS": 13400.0,
                    "VES": 39.5,
                    "VND": 26700.0,
                    "VUV": 129.0,
                    "WST": 3.00,
                    "XAF": 655.957,
                    "XCD": 2.93,
                    "XOF": 655.957,
                    "XPF": 119.33,
                    "YER": 271.0,
                    "ZAR": 20.3,
                    "ZMW": 28.5,
                    "ZWL": 3495.0
                };
                
                // Apply variation to all currencies except EUR
                exchangeRates = { "EUR": 1.0 };
                Object.keys(baseRates).forEach(currency => {
                    if (currency !== "EUR") {
                        exchangeRates[currency] = baseRates[currency] * (1 + (Math.random() - 0.5) * variation);
                    }
                });
                
                // Round to reasonable decimal places based on currency magnitude
                Object.keys(exchangeRates).forEach(currency => {
                    const rate = exchangeRates[currency];
                    if (currency === "EUR") {
                        exchangeRates[currency] = 1.0;
                    } else if (rate >= 1000) {
                        // Large currencies (IDR, VND, etc.) - round to whole numbers
                        exchangeRates[currency] = Math.round(rate);
                    } else if (rate >= 100) {
                        // Medium currencies (JPY, TRY, etc.) - round to 1 decimal
                        exchangeRates[currency] = Math.round(rate * 10) / 10;
                    } else if (rate >= 10) {
                        // Small currencies - round to 2 decimals
                        exchangeRates[currency] = Math.round(rate * 100) / 100;
                    } else if (rate >= 1) {
                        // Decimal currencies - round to 3 decimals
                        exchangeRates[currency] = Math.round(rate * 1000) / 1000;
                    } else {
                        // Very small currencies (BHD, KWD, etc.) - round to 3 decimals
                        exchangeRates[currency] = Math.round(rate * 1000) / 1000;
                    }
                });
                
                // Hide loading, show calculator
                loadingDiv.classList.add('hidden');
                calculatorDiv.classList.remove('hidden');
                
                // Trigger initial calculation and chart render
                const fromCurrency = document.getElementById('from-currency').value;
                const toCurrency = document.getElementById('to-currency').value;
                updateCurrencyConversion();
                renderCurrencyHistoryChart(fromCurrency, toCurrency);
                
            } catch (error) {
                console.error('Error fetching exchange rates:', error);
                // On error, still show calculator with cached rates
                loadingDiv.classList.add('hidden');
                calculatorDiv.classList.remove('hidden');
                updateCurrencyConversion();
            }
        }

        /**
         * Convert currency from one to another
         */
        function convertCurrency(amount, fromCurrency, toCurrency) {
            if (!exchangeRates[fromCurrency] || !exchangeRates[toCurrency]) {
                return 0;
            }
            
            // Convert to EUR first (base currency), then to target
            const amountInEUR = amount / exchangeRates[fromCurrency];
            const convertedAmount = amountInEUR * exchangeRates[toCurrency];
            
            return convertedAmount;
        }

        /**
         * Update the currency conversion and display
         */
        function updateCurrencyConversion() {
            const fromAmount = parseFloat(document.getElementById('from-amount').value) || 0;
            const fromCurrency = document.getElementById('from-currency').value;
            const toCurrency = document.getElementById('to-currency').value;
            
            if (fromAmount <= 0) {
                document.getElementById('to-amount').value = '0.00';
                updateRateDisplay(fromCurrency, toCurrency);
                return;
            }
            
            // Perform conversion
            const convertedAmount = convertCurrency(fromAmount, fromCurrency, toCurrency);
            
            // Format output based on currency
            // High-value currencies (>= 1000) typically don't need decimals
            // Medium-high currencies (>= 100) use 1-2 decimals
            // Standard currencies use 2 decimals
            const highValueCurrencies = ['JPY', 'KRW', 'IDR', 'VND', 'LAK', 'LBP', 'UGX', 'UZS', 'IRR', 'IQD', 'KHR', 'CLP', 'COP', 'PYG'];
            const mediumHighCurrencies = ['TRY', 'PLN', 'UAH', 'LKR', 'BDT', 'KES', 'PKR', 'EGP', 'TZS'];
            
            let formattedAmount;
            if (highValueCurrencies.includes(toCurrency)) {
                // Round to whole numbers for very high-value currencies
                formattedAmount = Math.round(convertedAmount).toLocaleString('de-DE', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            } else if (mediumHighCurrencies.includes(toCurrency)) {
                // 1 decimal for medium-high currencies
                formattedAmount = convertedAmount.toLocaleString('de-DE', {
                    minimumFractionDigits: 1,
                    maximumFractionDigits: 1
                });
            } else {
                // Standard 2 decimal formatting
                formattedAmount = convertedAmount.toLocaleString('de-DE', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
            
            document.getElementById('to-amount').value = formattedAmount;
            updateRateDisplay(fromCurrency, toCurrency);
            // Update historical chart
            renderCurrencyHistoryChart(fromCurrency, toCurrency);
        }

        /**
         * Update the exchange rate display text
         */
        function updateRateDisplay(fromCurrency, toCurrency) {
            const rateText = document.getElementById('rate-text');
            
            if (fromCurrency === toCurrency) {
                rateText.textContent = 'Gleiche Währung ausgewählt';
                return;
            }
            
            // Calculate and display the rate
            const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            
            // Format rate display based on currency magnitude
            const highValueCurrencies = ['JPY', 'KRW', 'IDR', 'VND', 'LAK', 'LBP', 'UGX', 'UZS', 'IRR', 'IQD', 'KHR', 'CLP', 'COP', 'PYG'];
            const mediumHighCurrencies = ['TRY', 'PLN', 'UAH', 'LKR', 'BDT', 'KES', 'PKR', 'EGP', 'TZS'];
            
            let formattedRate;
            if (highValueCurrencies.includes(toCurrency)) {
                formattedRate = rate.toFixed(0); // Whole numbers for very high rates
            } else if (mediumHighCurrencies.includes(toCurrency)) {
                formattedRate = rate.toFixed(2); // 2 decimals for medium-high rates
            } else if (rate >= 10) {
                formattedRate = rate.toFixed(3); // 3 decimals for rates >= 10
            } else if (rate >= 1) {
                formattedRate = rate.toFixed(4); // 4 decimals for rates between 1-10
            } else {
                formattedRate = rate.toFixed(4); // 4 decimals for rates < 1
            }
            
            rateText.textContent = `Aktueller Kurs: 1 ${fromCurrency} = ${formattedRate} ${toCurrency}`;
        }

        /**
         * Swap currencies function
         */
        function swapCurrencies() {
            const fromCurrencySelect = document.getElementById('from-currency');
            const toCurrencySelect = document.getElementById('to-currency');
            const fromAmountInput = document.getElementById('from-amount');
            const toAmountInput = document.getElementById('to-amount');
            
            // Swap currency selections
            const tempCurrency = fromCurrencySelect.value;
            fromCurrencySelect.value = toCurrencySelect.value;
            toCurrencySelect.value = tempCurrency;
            
            // Swap amounts - convert formatted number back to plain number
            const toAmountValue = toAmountInput.value.replace(/\./g, '').replace(',', '.') || 0;
            const fromAmountValue = parseFloat(fromAmountInput.value) || 0;
            
            fromAmountInput.value = toAmountValue > 0 ? toAmountValue : fromAmountValue;
            // to-amount will be calculated automatically
            
            // Recalculate
            updateCurrencyConversion();
        }

        /**
         * Initialize Währungsrechner
         */
        function initializeWaehrung() {
            // Fetch fresh rates when view is opened
            fetchAndSetRates();
        }

        /**
         * Currency History Chart
         */
        let currencyHistoryChart = null;

        /**
         * Generate 1-year historical data for currency pair
         */
        function generateHistoricalData(fromCurrency, toCurrency) {
            const currentRate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            const data = [];
            const labels = [];
            const today = new Date();
            
            // Generate data points for each month (12 months back)
            for (let i = 11; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthLabel = date.toLocaleDateString('de-DE', { month: 'short', year: '2-digit' });
                labels.push(monthLabel);
                
                // Simulate historical rate with realistic variation
                // Start from a slightly different base and add trend + volatility
                const monthsAgo = i;
                const trend = (Math.random() - 0.5) * 0.1; // Small overall trend
                const volatility = (Math.random() - 0.5) * 0.15; // Monthly volatility
                const historicalVariation = 1 + (trend * (11 - monthsAgo) / 11) + volatility;
                const historicalRate = currentRate * historicalVariation;
                
                data.push(Math.max(0.0001, historicalRate)); // Ensure positive values
            }
            
            return { labels, data };
        }

        /**
         * Render or update the currency history chart
         */
        function renderCurrencyHistoryChart(fromCurrency, toCurrency) {
            const chartCanvas = document.getElementById('currency-history-chart');
            if (!chartCanvas) return;
            
            const ctx = chartCanvas.getContext('2d');
            const { labels, data } = generateHistoricalData(fromCurrency, toCurrency);
            
            // Destroy existing chart if it exists
            if (currencyHistoryChart) {
                currencyHistoryChart.destroy();
            }
            
            // Chart.js color scheme for purple theme
            const chartColors = {
                purple: 'rgba(168, 85, 247, 0.8)',
                purpleLight: 'rgba(168, 85, 247, 0.3)',
                purpleBorder: 'rgba(168, 85, 247, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };
            
            currencyHistoryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${fromCurrency}/${toCurrency}`,
                        data: data,
                        borderColor: chartColors.purpleBorder,
                        backgroundColor: chartColors.purpleLight,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 5,
                        pointBackgroundColor: chartColors.purpleBorder,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: chartColors.textColor,
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            },
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: chartColors.textColor,
                            bodyColor: chartColors.textColor,
                            borderColor: chartColors.purpleBorder,
                            borderWidth: 1,
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    const rate = context.parsed.y;
                                    let formattedRate;
                                    
                                    // Format rate based on magnitude
                                    if (rate >= 1000) {
                                        formattedRate = rate.toFixed(0);
                                    } else if (rate >= 100) {
                                        formattedRate = rate.toFixed(1);
                                    } else if (rate >= 10) {
                                        formattedRate = rate.toFixed(2);
                                    } else {
                                        formattedRate = rate.toFixed(4);
                                    }
                                    
                                    return `1 ${fromCurrency} = ${formattedRate} ${toCurrency}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    // Format y-axis labels based on value
                                    if (value >= 1000) {
                                        return value.toFixed(0);
                                    } else if (value >= 100) {
                                        return value.toFixed(1);
                                    } else if (value >= 10) {
                                        return value.toFixed(2);
                                    } else {
                                        return value.toFixed(3);
                                    }
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: chartColors.gridColor,
                                drawBorder: false
                            },
                            ticks: {
                                color: chartColors.textColor,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        /**
         * Setup Währungsrechner event listeners
         */
        document.addEventListener('DOMContentLoaded', function() {
            const fromAmountInput = document.getElementById('from-amount');
            const fromCurrencySelect = document.getElementById('from-currency');
            const toCurrencySelect = document.getElementById('to-currency');
            const swapBtn = document.getElementById('swap-currencies-btn');
            const waehrungForm = document.getElementById('waehrung-form');
            
            // Real-time conversion on input change
            if (fromAmountInput) {
                fromAmountInput.addEventListener('input', updateCurrencyConversion);
            }
            
            // Real-time conversion on currency change
            if (fromCurrencySelect) {
                fromCurrencySelect.addEventListener('change', updateCurrencyConversion);
            }
            
            if (toCurrencySelect) {
                toCurrencySelect.addEventListener('change', updateCurrencyConversion);
            }
            
            // Swap button
            if (swapBtn) {
                swapBtn.addEventListener('click', swapCurrencies);
            }
            
            // Form submission (refresh rates)
            if (waehrungForm) {
                waehrungForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const calculateBtn = document.getElementById('calculate-waehrung-btn');
                    triggerSignatureAnimation(calculateBtn);
                    fetchAndSetRates();
                });
            }
        });

        // Make functions available globally for reuse across all calculators
        window.showPage = showPage;
        window.togglePKVFields = togglePKVFields;
        window.triggerSignatureAnimation = triggerSignatureAnimation;
        window.showCalculatingOverlay = showCalculatingOverlay;
        window.hideCalculatingOverlay = hideCalculatingOverlay;
        // Loan calculator function
        window.calculateLoan = calculateLoan;
        // Mortgage calculator function
        window.calculateMortgage = calculateMortgage;
        // Zinsrechner function
        window.calculateSavingsPlan = calculateSavingsPlan;
        // Geschwindigkeitsumrechner functions
        window.calculateSpeed = calculateSpeed;
        window.handleSpeedInput = handleSpeedInput;
        window.setSpeedScenario = setSpeedScenario;
        window.swapSpeedUnits = swapSpeedUnits;
        window.initializeSpeed = initializeSpeed;
        // Flächenrechner functions
        window.setFlaecheMode = setFlaecheMode;
        window.handleFlaecheConvert = handleFlaecheConvert;
        window.swapFlaecheUnits = swapFlaecheUnits;
        window.handleFlaecheGeometry = handleFlaecheGeometry;
        window.initializeFlaeche = initializeFlaeche;
        // Kleidergrößen Umrechner functions
        window.setGroessenGender = setGroessenGender;
        window.setGroessenCategory = setGroessenCategory;
        window.updateGroessenSizeOptions = updateGroessenSizeOptions;
        window.handleGroessenSizeChange = handleGroessenSizeChange;
        window.getConvertedSizes = getConvertedSizes;
        window.initializeGroessen = initializeGroessen;
        // Benzinpreis Rechner functions
        window.setBenzinMode = setBenzinMode;
        window.calculateFuelCosts = calculateFuelCosts;
        window.handleBenzinCalculation = handleBenzinCalculation;
        window.initializeBenzin = initializeBenzin;
        // Altersrechner functions
        window.formatDateInput = formatDateInput;
        window.calculateLifeStats = calculateLifeStats;
        window.handleAlterCalculation = handleAlterCalculation;
        window.initializeAlter = initializeAlter;
        // Legal/Privacy functions
        window.setLegalTab = setLegalTab;
        window.showLegalPage = showLegalPage;
        window.initializeLegal = initializeLegal;
        // Währungsrechner functions
        window.fetchAndSetRates = fetchAndSetRates;
        window.initializeWaehrung = initializeWaehrung;
        // Inflationsrechner functions
        window.calculateInflation = calculateInflation;
        window.setInflationMode = setInflationMode;
        window.initializeInflation = initializeInflation;
        window.updateHistoricalRate = updateHistoricalRate;
        // Aktien Rendite function
        window.calculateStockReturn = calculateStockReturn;
        // BMI Calculator function
        window.calculateBMI = calculateBMI;
        // Calorie Calculator function
        window.calculateCalories = calculateCalories;
        // Promille Calculator functions
        window.calculatePromille = calculatePromille;
        window.addDrinkPreset = addDrinkPreset;
        window.addCustomDrink = addCustomDrink;
        window.removeDrink = removeDrink;
        window.renderDrinkList = renderDrinkList;
        // Unit Converter functions
        window.calculateUnits = calculateUnits;
        window.updateUnitsForCategory = updateUnitsForCategory;
        window.convertUnits = convertUnits;
        window.swapUnits = swapUnits;
        window.updateQuickChips = updateQuickChips;
        window.initializeUnits = initializeUnits;

        /**
         * Inflationsrechner Functions
         */
        
        /**
         * Historical German Inflation Data (Annual rates in %)
         */
        const GERMAN_HISTORIC_INFLATION = {
            2024: 2.3,
            2023: 5.9,
            2022: 6.9,
            2021: 3.1,
            2020: 0.4,
            2019: 1.4,
            2018: 1.9,
            2017: 1.8,
            2016: 0.5,
            2015: 0.2,
            2014: 0.9,
            2013: 1.5,
            2012: 2.0,
            2011: 2.1,
            2010: 1.1,
            2009: 0.4,
            2008: 2.6,
            2007: 2.3,
            2006: 1.7,
            2005: 1.9,
            2004: 1.8,
            2003: 1.1,
            2002: 1.4,
            2001: 2.0,
            2000: 2.0
        };

        /**
         * Inflation mode state
         */
        let inflationMode = 'manual';

        /**
         * Set inflation calculation mode
         */
        function setInflationMode(mode) {
            inflationMode = mode;
            
            const btnManual = document.getElementById('mode-manual');
            const btnHistorical = document.getElementById('mode-historical');
            const manualContainer = document.getElementById('manual-inflation-container');
            const historicalContainer = document.getElementById('historical-inflation-container');
            
            if (mode === 'manual') {
                btnManual.className = 'mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-purple-600 text-white glow-purple';
                btnHistorical.className = 'mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-gray-700 text-slate-300 hover:bg-gray-600';
                manualContainer.classList.remove('hidden');
                historicalContainer.classList.add('hidden');
            } else {
                btnManual.className = 'mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-gray-700 text-slate-300 hover:bg-gray-600';
                btnHistorical.className = 'mode-btn px-4 py-3 rounded-lg font-semibold transition-all touch-target bg-purple-600 text-white glow-purple';
                manualContainer.classList.add('hidden');
                historicalContainer.classList.remove('hidden');
                
                // Calculate and display average rate
                updateHistoricalRate();
            }
        }

        /**
         * Calculate average inflation rate from historical data
         */
        function calculateAverageHistoricalRate(startYear, endYear) {
            const rates = [];
            for (let year = startYear; year <= endYear; year++) {
                if (GERMAN_HISTORIC_INFLATION[year] !== undefined) {
                    rates.push(GERMAN_HISTORIC_INFLATION[year]);
                }
            }
            
            if (rates.length === 0) return null;
            
            const sum = rates.reduce((a, b) => a + b, 0);
            return sum / rates.length;
        }

        /**
         * Update historical rate display
         */
        function updateHistoricalRate() {
            const startYear = parseInt(document.getElementById('start_year').value);
            const endYear = parseInt(document.getElementById('end_year').value);
            
            if (startYear && endYear && startYear <= endYear) {
                const avgRate = calculateAverageHistoricalRate(startYear, endYear);
                if (avgRate !== null) {
                    document.getElementById('avg-rate-display').textContent = avgRate.toFixed(2);
                } else {
                    document.getElementById('avg-rate-display').textContent = '--';
                }
            }
        }

        /**
         * Initialize historical year dropdowns
         */
        function initializeInflationHistoricalYears() {
            const startYearSelect = document.getElementById('start_year');
            const endYearSelect = document.getElementById('end_year');
            
            const years = Object.keys(GERMAN_HISTORIC_INFLATION).map(y => parseInt(y)).sort((a, b) => b - a);
            
            // Populate start year dropdown
            startYearSelect.innerHTML = '<option value="">Jahr wählen</option>';
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === 2020) option.selected = true; // Default to 2020
                startYearSelect.appendChild(option);
            });
            
            // Populate end year dropdown
            endYearSelect.innerHTML = '<option value="">Jahr wählen</option>';
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === 2024) option.selected = true; // Default to 2024
                endYearSelect.appendChild(option);
            });
            
            // Add change listeners
            startYearSelect.addEventListener('change', updateHistoricalRate);
            endYearSelect.addEventListener('change', updateHistoricalRate);
            
            // Initial calculation
            updateHistoricalRate();
        }

        /**
         * Calculate inflation effects
         */
        function calculateInflation(inputs) {
            const {
                initial_amount_euro,
                duration_years,
                annual_inflation_rate_percent
            } = inputs;

            const rate = annual_inflation_rate_percent / 100;
            const factor = Math.pow(1 + rate, duration_years);
            
            // Future Price: What the initial amount will cost
            const future_price = initial_amount_euro * factor;
            
            // Future Purchasing Power: What the initial amount will be worth
            const future_purchasing_power = initial_amount_euro / factor;
            
            // Price increase (absolute)
            const price_increase = future_price - initial_amount_euro;
            
            // Purchasing power loss (absolute)
            const purchasing_power_loss = initial_amount_euro - future_purchasing_power;
            
            // Generate yearly data for chart
            const yearly_data = [];
            for (let year = 0; year <= duration_years; year++) {
                const year_factor = Math.pow(1 + rate, year);
                yearly_data.push({
                    year: year,
                    initial_value: initial_amount_euro,
                    future_price: initial_amount_euro * year_factor,
                    future_purchasing_power: initial_amount_euro / year_factor
                });
            }
            
            return {
                future_price: Math.round(future_price * 100) / 100,
                future_purchasing_power: Math.round(future_purchasing_power * 100) / 100,
                price_increase: Math.round(price_increase * 100) / 100,
                purchasing_power_loss: Math.round(purchasing_power_loss * 100) / 100,
                yearly_data: yearly_data
            };
        }

        /**
         * Chart variable for inflation calculator
         */
        let inflationChart = null;

        /**
         * Render inflation chart
         */
        function renderInflationChart(result) {
            const chartColors = {
                purple: 'rgba(147, 51, 234, 0.8)',
                purpleLight: 'rgba(147, 51, 234, 0.3)',
                purpleBorder: 'rgba(147, 51, 234, 1)',
                yellow: 'rgba(234, 179, 8, 0.8)',
                yellowLight: 'rgba(234, 179, 8, 0.3)',
                yellowBorder: 'rgba(234, 179, 8, 1)',
                gridColor: 'rgba(107, 114, 128, 0.3)',
                textColor: 'rgba(229, 231, 235, 1)'
            };

            // Destroy existing chart
            if (inflationChart) inflationChart.destroy();

            const years = result.yearly_data.map(d => `Jahr ${d.year}`);
            const initialValues = result.yearly_data.map(d => d.initial_value);
            const futurePrices = result.yearly_data.map(d => d.future_price);
            const futurePurchasingPower = result.yearly_data.map(d => d.future_purchasing_power);

            const ctx = document.getElementById('inflation-chart').getContext('2d');
            inflationChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Ursprünglicher Betrag',
                            data: initialValues,
                            borderColor: chartColors.purpleBorder,
                            backgroundColor: chartColors.purpleLight,
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        },
                        {
                            label: 'Zukünftiger Preis',
                            data: futurePrices,
                            borderColor: chartColors.purpleBorder,
                            backgroundColor: chartColors.purpleLight,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Zukünftige Kaufkraft',
                            data: futurePurchasingPower,
                            borderColor: chartColors.yellowBorder,
                            backgroundColor: chartColors.yellowLight,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: chartColors.textColor }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: chartColors.gridColor },
                            ticks: { 
                                color: chartColors.textColor,
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return (value / 1000000).toFixed(1) + 'M €';
                                    } else if (value >= 1000) {
                                        return (value / 1000).toFixed(0) + 'k €';
                                    }
                                    return value.toLocaleString('de-DE') + ' €';
                                }
                            }
                        },
                        x: {
                            grid: { color: chartColors.gridColor },
                            ticks: { color: chartColors.textColor }
                        }
                    }
                }
            });
        }

        /**
         * Handle Inflation Form Submission
         */
        document.getElementById('inflation-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get button and trigger signature animation
            const calculateBtn = document.getElementById('calculate-inflation-btn');
            triggerSignatureAnimation(calculateBtn);
            
            // Show calculating overlay
            showCalculatingOverlay();
            
            // Hide previous results
            document.getElementById('inflation-result').classList.add('hidden');
            
            setTimeout(() => {
                // Get form values
                const initial_amount_euro = parseFloat(document.getElementById('initial_amount_euro').value) || 0;
                const duration_years = parseInt(document.getElementById('duration_years').value) || 0;
                
                let annual_inflation_rate_percent;
                
                if (inflationMode === 'historical') {
                    const startYear = parseInt(document.getElementById('start_year').value);
                    const endYear = parseInt(document.getElementById('end_year').value);
                    
                    if (!startYear || !endYear || startYear > endYear) {
                        alert('Bitte wählen Sie gültige Start- und Endjahre.');
                        hideCalculatingOverlay();
                        return;
                    }
                    
                    const avgRate = calculateAverageHistoricalRate(startYear, endYear);
                    if (avgRate === null) {
                        alert('Keine historischen Daten für den ausgewählten Zeitraum verfügbar.');
                        hideCalculatingOverlay();
                        return;
                    }
                    annual_inflation_rate_percent = avgRate;
                } else {
                    annual_inflation_rate_percent = parseFloat(document.getElementById('annual_inflation_rate_percent').value) || 0;
                }

                // Validation
                if (initial_amount_euro <= 0) {
                    alert('Bitte geben Sie einen gültigen Geldbetrag ein.');
                    hideCalculatingOverlay();
                    return;
                }
                if (duration_years < 1 || duration_years > 100) {
                    alert('Bitte geben Sie eine gültige Laufzeit ein (1-100 Jahre).');
                    hideCalculatingOverlay();
                    return;
                }
                if (annual_inflation_rate_percent < 0 || annual_inflation_rate_percent > 50) {
                    alert('Bitte geben Sie eine gültige Inflationsrate ein (0-50%).');
                    hideCalculatingOverlay();
                    return;
                }

                // Calculate
                const result = calculateInflation({
                    initial_amount_euro,
                    duration_years,
                    annual_inflation_rate_percent
                });

                // Display results
                document.getElementById('result-future-price').textContent = result.future_price.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-future-purchasing-power').textContent = result.future_purchasing_power.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-price-increase').textContent = '+' + result.price_increase.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';
                document.getElementById('result-purchasing-power-loss').textContent = '-' + result.purchasing_power_loss.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';

                // Render chart
                renderInflationChart(result);

                // Hide calculating overlay
                hideCalculatingOverlay();

                // Show results with fade-in animation
                const resultDiv = document.getElementById('inflation-result');
                resultDiv.classList.remove('hidden');
                resultDiv.classList.add('result-fade-in');
                
                // Scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }, 1000);
        });

        /**
         * Initialize inflation calculator
         */
        function initializeInflation() {
            setInflationMode('manual');
            initializeInflationHistoricalYears();
        }

        // Initialize: Show dashboard on load
        window.addEventListener('DOMContentLoaded', function() {
            showPage('dashboard');
            document.querySelector('main').style.paddingTop = '0';
        });
    </script>

    <!-- Firebase Initialization Script -->
    <script type="module">
        // Firebase configuration will be added here
        // Using environment variables for security
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        
        // Firebase configuration (to be filled with actual values)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        // const app = initializeApp(firebaseConfig);
        // Uncomment when Firebase credentials are available
        
        console.log('Firebase module loaded (initialization pending configuration)');
    </script>

</body>
</html>

